{
  "name": "pokerinput-mcp-final",
  "version": "3.0.4",
  "description": "本番環境対応 YAML-based radiation shielding calculation input file management tool with complete MCP support and production features - Division Structured",
  "author": "yoshihiro hirao",
  "license": "ISC",
  "homepage": "http://localhost:3020",
  "repository": {
    "type": "git",
    "url": "https://github.com/Hirao-Y/pokerinput-mcp-final"
  },
  "mcp_version": "1.0.0",
  "server": {
    "name": "pokerinput-mcp-final-server",
    "version": "4.0.3",
    "description": "Complete MCP Server FINAL - Division Structured Version",
    "port": 3020,
    "features": [
      "全20のMCPメソッド完全実装",
      "実際のYAMLファイル更新",
      "自動バックアップ機能",
      "完全なエラーハンドリング",
      "JSON-RPC 2.0完全対応",
      "詳細パラメータ検証",
      "条件分岐パラメータ対応",
      "線源geometry構造化対応",
      "線源division構造化対応"
    ]
  },
  "endpoints": {
    "jsonrpc": "/mcp",
    "root": "/",
    "health": "/health"
  },
  "capabilities": {
    "real_data_update": true,
    "automatic_backup": true,
    "error_handling": "complete",
    "validation": "comprehensive",
    "production_ready": true,
    "parameter_validation": "enhanced",
    "conditional_parameters": true,
    "structured_geometry": true,
    "structured_division": true
  },
  "tools": [
    {
      "name": "pokerinput_proposeSource",
      "description": "新しい線源を提案します",
      "parameters": {
        "name": {
          "type": "string",
          "description": "線源の名前（一意である必要があります）",
          "required": true,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "maxLength": 50
        },
        "type": {
          "type": "string",
          "description": "線源タイプ",
          "required": true,
          "enum": ["POINT", "SPH", "RCC", "RPP", "BOX"]
        },
        "position": {
          "type": "string",
          "description": "線源の位置（x y z形式）、typeがPOINTの場合のみ必須",
          "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
        },
        "inventory": {
          "type": "array",
          "description": "核種と放射能の組の配列",
          "required": true,
          "minItems": 1,
          "items": {
            "type": "object",
            "properties": {
              "nuclide": {
                "type": "string",
                "description": "核種名",
                "pattern": "^[A-Za-z0-9-]+$"
              },
              "radioactivity": {
                "type": "number",
                "description": "放射能（単位Bq）",
                "minimum": 0.001,
                "maximum": 1e15
              }
            },
            "required": ["nuclide", "radioactivity"],
            "additionalProperties": false
          }
        },
        "geometry": {
          "type": "object",
          "description": "線源形状パラメータ（typeがPOINT以外の場合に必須）",
          "oneOf": [
            {
              "title": "BOX線源形状",
              "properties": {
                "vertex": {
                  "type": "string",
                  "description": "頂点座標（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_1": {
                  "type": "string",
                  "description": "エッジ1ベクトル（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_2": {
                  "type": "string",
                  "description": "エッジ2ベクトル（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_3": {
                  "type": "string",
                  "description": "エッジ3ベクトル（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                }
              },
              "required": ["vertex", "edge_1", "edge_2", "edge_3"],
              "additionalProperties": false
            },
            {
              "title": "RPP線源形状",
              "properties": {
                "min": {
                  "type": "string",
                  "description": "最小座標（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "max": {
                  "type": "string",
                  "description": "最大座標（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                }
              },
              "required": ["min", "max"],
              "additionalProperties": false
            },
            {
              "title": "SPH線源形状",
              "properties": {
                "center": {
                  "type": "string",
                  "description": "中心座標（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "radius": {
                  "type": "number",
                  "description": "半径",
                  "minimum": 0.001
                }
              },
              "required": ["center", "radius"],
              "additionalProperties": false
            },
            {
              "title": "RCC線源形状",
              "properties": {
                "bottom_center": {
                  "type": "string",
                  "description": "底面中心座標（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "height_vector": {
                  "type": "string",
                  "description": "高さベクトル（x y z形式）",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "radius": {
                  "type": "number",
                  "description": "半径",
                  "minimum": 0.001
                }
              },
              "required": ["bottom_center", "height_vector", "radius"],
              "additionalProperties": false
            }
          ],
          "transform": {
            "type": "string",
            "description": "適用する変換名"
          }
        },
        "division": {
          "type": "object",
          "description": "線源の領域分割パラメータ（typeがPOINT以外の場合に必須）",
          "oneOf": [
            {
              "title": "BOX線源分割",
              "properties": {
                "edge_1": {
                  "$ref": "#/definitions/division_axis"
                },
                "edge_2": {
                  "$ref": "#/definitions/division_axis"
                },
                "edge_3": {
                  "$ref": "#/definitions/division_axis"
                }
              },
              "required": ["edge_1", "edge_2", "edge_3"],
              "additionalProperties": false
            },
            {
              "title": "RPP線源分割",
              "properties": {
                "edge_1": {
                  "$ref": "#/definitions/division_axis"
                },
                "edge_2": {
                  "$ref": "#/definitions/division_axis"
                },
                "edge_3": {
                  "$ref": "#/definitions/division_axis"
                }
              },
              "required": ["edge_1", "edge_2", "edge_3"],
              "additionalProperties": false
            },
            {
              "title": "SPH線源分割",
              "properties": {
                "r": {
                  "$ref": "#/definitions/division_axis"
                },
                "theta": {
                  "$ref": "#/definitions/division_axis"
                },
                "phi": {
                  "$ref": "#/definitions/division_axis"
                }
              },
              "required": ["r", "theta", "phi"],
              "additionalProperties": false
            },
            {
              "title": "RCC線源分割",
              "properties": {
                "r": {
                  "$ref": "#/definitions/division_axis"
                },
                "phi": {
                  "$ref": "#/definitions/division_axis"
                },
                "z": {
                  "$ref": "#/definitions/division_axis"
                }
              },
              "required": ["r", "phi", "z"],
              "additionalProperties": false
            }
          ]
        },
        "cutoff_rate": {
          "type": "number",
          "description": "放出率カットオフ",
          "minimum": 0.0001,
          "maximum": 1.0,
          "default": 0.0001
        }
      },
      "conditional_requirements": {
        "POINT": ["name", "type", "position", "inventory"],
        "SPH": ["name", "type", "geometry", "division", "inventory"],
        "RCC": ["name", "type", "geometry", "division", "inventory"],
        "RPP": ["name", "type", "geometry", "division", "inventory"],
        "BOX": ["name", "type", "geometry", "division", "inventory"]
      }
    },
    {
      "name": "pokerinput_updateSource",
      "description": "既存線源のパラメータを更新します",
      "parameters": {
        "name": {
          "type": "string",
          "description": "更新する線源の名前",
          "required": true,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "maxLength": 50
        },
        "type": {
          "type": "string",
          "description": "新しい線源のタイプ",
          "enum": ["POINT", "SPH", "RCC", "RPP", "BOX"]
        },
        "geometry": {
          "type": "object",
          "description": "新しい線源形状パラメータ",
          "oneOf": [
            {
              "title": "BOX線源形状",
              "properties": {
                "vertex": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_1": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_2": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "edge_3": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                }
              },
              "required": ["vertex", "edge_1", "edge_2", "edge_3"]
            },
            {
              "title": "RPP線源形状",
              "properties": {
                "min": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "max": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                }
              },
              "required": ["min", "max"]
            },
            {
              "title": "SPH線源形状",
              "properties": {
                "center": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "radius": {
                  "type": "number",
                  "minimum": 0.001
                }
              },
              "required": ["center", "radius"]
            },
            {
              "title": "RCC線源形状",
              "properties": {
                "bottom_center": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "height_vector": {
                  "type": "string",
                  "pattern": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$"
                },
                "radius": {
                  "type": "number",
                  "minimum": 0.001
                }
              },
              "required": ["bottom_center", "height_vector", "radius"]
            }
          ],
          "transform": {
            "type": "string",
            "description": "適用する変換名"
          }
        },
        "division": {
          "type": "object",
          "description": "新しい線源の領域分割パラメータ",
          "oneOf": [
            {
              "title": "BOX線源分割",
              "properties": {
                "edge_1": { "$ref": "#/definitions/division_axis" },
                "edge_2": { "$ref": "#/definitions/division_axis" },
                "edge_3": { "$ref": "#/definitions/division_axis" }
              },
              "required": ["edge_1", "edge_2", "edge_3"]
            },
            {
              "title": "RPP線源分割",
              "properties": {
                "edge_1": { "$ref": "#/definitions/division_axis" },
                "edge_2": { "$ref": "#/definitions/division_axis" },
                "edge_3": { "$ref": "#/definitions/division_axis" }
              },
              "required": ["edge_1", "edge_2", "edge_3"]
            },
            {
              "title": "SPH線源分割",
              "properties": {
                "r": { "$ref": "#/definitions/division_axis" },
                "theta": { "$ref": "#/definitions/division_axis" },
                "phi": { "$ref": "#/definitions/division_axis" }
              },
              "required": ["r", "theta", "phi"]
            },
            {
              "title": "RCC線源分割",
              "properties": {
                "r": { "$ref": "#/definitions/division_axis" },
                "phi": { "$ref": "#/definitions/division_axis" },
                "z": { "$ref": "#/definitions/division_axis" }
              },
              "required": ["r", "phi", "z"]
            }
          ]
        }
      }
    },
    {
      "name": "pokerinput_deleteSource",
      "description": "線源を削除します",
      "parameters": {
        "name": {
          "type": "string",
          "description": "削除する線源の名前",
          "required": true,
          "pattern": "^[a-zA-Z0-9_-]+$",
          "maxLength": 50
        }
      }
    },
    {
      "name": "pokerinput_applyChanges",
      "description": "全ての保留中の変更を実際のYAMLファイルに適用します。自動的にバックアップが作成されます。",
      "parameters": {
        "force": {
          "type": "boolean",
          "description": "強制適用フラグ（警告を無視）",
          "default": false
        },
        "backup_comment": {
          "type": "string",
          "description": "バックアップのコメント",
          "maxLength": 200
        }
      }
    }
  ],
  "definitions": {
    "division_axis": {
      "type": "object",
      "description": "分割軸の設定",
      "properties": {
        "type": {
          "type": "string",
          "description": "分割タイプ",
          "enum": ["UNIFORM", "GAUSS_FIRST", "GAUSS_LAST", "GAUSS_BOTH", "GAUSS_CENTER"],
          "default": "UNIFORM"
        },
        "number": {
          "type": "integer",
          "description": "分割数",
          "minimum": 1,
          "maximum": 100
        },
        "min": {
          "type": "number",
          "description": "分割開始位置（0.0～1.0）",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 0.0
        },
        "max": {
          "type": "number",
          "description": "分割終了位置（0.0～1.0）",
          "minimum": 0.0,
          "maximum": 1.0,
          "default": 1.0
        }
      },
      "required": ["type", "number"],
      "additionalProperties": false
    }
  },
  "validation_enhanced": {
    "coordinate_patterns": {
      "xyz_format": "^-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?\\s+-?\\d+(\\.\\d+)?$",
      "range_limits": {
        "coordinate_max": 1000000,
        "coordinate_min": -1000000
      }
    },
    "physics_constraints": {
      "radius_min": 0.001,
      "density_max": 30.0,
      "radioactivity_max": 1e15
    },
    "name_constraints": {
      "max_length": 50,
      "allowed_chars": "^[a-zA-Z0-9_-]+$"
    },
    "division_constraints": {
      "division_types": ["UNIFORM", "GAUSS_FIRST", "GAUSS_LAST", "GAUSS_BOTH", "GAUSS_CENTER"],
      "number_limits": {
        "min": 1,
        "max": 100
      },
      "range_validation": "min must be less than max",
      "default_values": {
        "BOX_defaults": {"type": "UNIFORM", "number": 3},
        "RPP_defaults": {"type": "UNIFORM", "number": 3},
        "SPH_defaults": {"r": {"type": "GAUSS_LAST", "number": 9}, "theta": {"type": "UNIFORM", "number": 18}, "phi": {"type": "UNIFORM", "number": 18}},
        "RCC_defaults": {"r": {"type": "GAUSS_LAST", "number": 9}, "phi": {"type": "UNIFORM", "number": 18}, "z": {"type": "UNIFORM", "number": 18}}
      }
    }
  },
  "error_handling_detailed": {
    "json_rpc_compliant": true,
    "custom_error_codes": {
      "-32001": "Body not found",
      "-32002": "Zone not found", 
      "-32003": "Duplicate name",
      "-32004": "Invalid body type",
      "-32005": "Dependency exists",
      "-32006": "File access error",
      "-32007": "Validation error",
      "-32008": "Backup error",
      "-32009": "Physics constraint violation",
      "-32010": "Coordinate format error",
      "-32011": "Parameter type mismatch",
      "-32012": "Required parameter missing",
      "-32013": "Invalid parameter combination",
      "-32014": "Geometry validation error",
      "-32015": "Source type mismatch",
      "-32016": "Division validation error",
      "-32017": "Division type invalid",
      "-32018": "Division range error"
    },
    "error_context": {
      "include_parameter_name": true,
      "include_expected_format": true,
      "include_correction_hint": true,
      "include_valid_values": true,
      "include_division_examples": true
    },
    "standard_error_codes": {
      "-32600": "Invalid Request",
      "-32601": "Method not found",
      "-32602": "Invalid params",
      "-32603": "Internal error",
      "-32000": "Server error"
    }
  },
  "conditional_parameter_rules": {
    "source_types_enhanced": {
      "POINT": {
        "required": ["name", "type", "position", "inventory"],
        "optional": ["cutoff_rate"],
        "forbidden": ["geometry", "division"],
        "validation": "position must be valid xyz coordinates"
      },
      "SPH": {
        "required": ["name", "type", "geometry", "division", "inventory"],
        "optional": ["cutoff_rate"],
        "forbidden": ["position"],
        "geometry_structure": {
          "type": "object",
          "required_properties": ["center", "radius"]
        },
        "division_structure": {
          "type": "object",
          "required_axes": ["r", "theta", "phi"],
          "coordinate_system": "spherical"
        }
      },
      "RCC": {
        "required": ["name", "type", "geometry", "division", "inventory"],
        "optional": ["cutoff_rate"],
        "forbidden": ["position"],
        "geometry_structure": {
          "type": "object",
          "required_properties": ["bottom_center", "height_vector", "radius"]
        },
        "division_structure": {
          "type": "object",
          "required_axes": ["r", "phi", "z"],
          "coordinate_system": "cylindrical"
        }
      },
      "RPP": {
        "required": ["name", "type", "geometry", "division", "inventory"],
        "optional": ["cutoff_rate"],
        "forbidden": ["position"],
        "geometry_structure": {
          "type": "object",
          "required_properties": ["min", "max"]
        },
        "division_structure": {
          "type": "object",
          "required_axes": ["edge_1", "edge_2", "edge_3"],
          "coordinate_system": "cartesian"
        }
      },
      "BOX": {
        "required": ["name", "type", "geometry", "division", "inventory"],
        "optional": ["cutoff_rate"],
        "forbidden": ["position"],
        "geometry_structure": {
          "type": "object",
          "required_properties": ["vertex", "edge_1", "edge_2", "edge_3"]
        },
        "division_structure": {
          "type": "object",
          "required_axes": ["edge_1", "edge_2", "edge_3"],
          "coordinate_system": "cartesian"
        }
      }
    }
  },
  "data_files": {
    "input": "tasks/pokerinputs.yaml",
    "pending_changes": "tasks/pending_changes.json",
    "backup_directory": "backups/"
  },
  "backup_features": {
    "automatic_backup": true,
    "timestamp_format": "ISO_8601",
    "retention_policy": "最新10個のバックアップを保持",
    "cleanup_automatic": true
  },
  "production_features": {
    "real_yaml_updates": true,
    "transaction_safety": true,
    "graceful_shutdown": true,
    "memory_management": "optimized",
    "performance": "production_ready"
  }
}