<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸš¨ tutorialStepsèª­ã¿è¾¼ã¿å¤±æ•— ç·Šæ€¥ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ </title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #fff5f5; }
        .critical-panel { margin: 15px 0; padding: 20px; background: white; border-radius: 8px; border: 3px solid #e53e3e; }
        .result-panel { margin: 10px 0; padding: 12px; border-radius: 6px; }
        .error { background: #fed7d7; border: 1px solid #fc8181; color: #742a2a; }
        .success { background: #c6f6d5; border: 1px solid #68d391; color: #22543d; }
        .warning { background: #faf089; border: 1px solid #f6e05e; color: #744210; }
        .info { background: #bee3f8; border: 1px solid #90cdf4; color: #2a4365; }
        .critical { background: #fed7d7; border: 2px solid #e53e3e; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        button { padding: 12px 20px; margin: 8px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; }
        .btn-critical { background: #e53e3e; color: white; font-size: 16px; }
        .btn-fix { background: #38a169; color: white; }
        .btn-test { background: #3182ce; color: white; }
        pre { background: #2d3748; color: #e2e8f0; padding: 15px; border-radius: 6px; overflow-x: auto; font-size: 11px; white-space: pre-wrap; }
    </style>
</head>
<body>
    <h1>ğŸš¨ tutorialStepsèª­ã¿è¾¼ã¿å¤±æ•— ç·Šæ€¥ä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ </h1>
    
    <div class="critical-panel">
        <h2>âš ï¸ ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ã‚¨ãƒ©ãƒ¼: tutorialStepsãŒåˆ©ç”¨ã§ãã¾ã›ã‚“</h2>
        <p><strong>å•é¡Œ:</strong> steps.jsonã®èª­ã¿è¾¼ã¿å¤±æ•—ã¾ãŸã¯Tutorialã‚¯ãƒ©ã‚¹åˆæœŸåŒ–å•é¡Œ</p>
        <p><strong>å½±éŸ¿:</strong> ã™ã¹ã¦ã®ã‚¹ãƒ†ãƒƒãƒ—é€²è¡ŒãŒä¸å¯èƒ½</p>
        
        <button onclick="emergencyDataCheck()" class="btn-critical">ğŸ” ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç·Šæ€¥ç¢ºèª</button>
        <button onclick="directStepsLoad()" class="btn-fix">ğŸ“‚ steps.jsonç›´æ¥èª­ã¿è¾¼ã¿</button>
        <button onclick="tutorialRebuild()" class="btn-fix">ğŸ”„ Tutorialå®Œå…¨å†æ§‹ç¯‰</button>
        <button onclick="manualDataInjection()" class="btn-test">âš¡ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿æ³¨å…¥</button>
    </div>

    <div id="diagnosticResults"></div>

    <script src="physics-validator.js"></script>
    <script src="cross-section-visualizer.js"></script>
    <script src="tutorial.js"></script>

    <script>
        let resultsDiv = document.getElementById('diagnosticResults');

        function addResult(title, type, message, details = '') {
            const resultDiv = document.createElement('div');
            resultDiv.className = `result-panel ${type}`;
            resultDiv.innerHTML = `
                <h3>${getIcon(type)} ${title}</h3>
                <p><strong>çµæœ:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
                <small>ç¢ºèªæ™‚åˆ»: ${new Date().toLocaleTimeString()}</small>
            `;
            resultsDiv.appendChild(resultDiv);
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function getIcon(type) {
            switch(type) {
                case 'success': return 'âœ…';
                case 'error': return 'âŒ';
                case 'warning': return 'âš ï¸';
                case 'critical': return 'ğŸš¨';
                default: return 'â„¹ï¸';
            }
        }

        async function emergencyDataCheck() {
            resultsDiv.innerHTML = '';
            console.log('ğŸš¨ ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ç·Šæ€¥ç¢ºèªé–‹å§‹...');

            // 1. window.tutorialã®å­˜åœ¨ç¢ºèª
            checkTutorialObject();
            
            // 2. steps.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®ç›´æ¥ç¢ºèª
            await checkStepsJsonFile();
            
            // 3. ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèª
            await checkNetworkStatus();
            
            // 4. ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ³ç¢ºèª
            checkCacheStatus();
            
            // 5. JavaScriptèª­ã¿è¾¼ã¿çŠ¶æ³ç¢ºèª
            checkScriptLoadStatus();
        }

        function checkTutorialObject() {
            try {
                console.log('ğŸ” window.tutorialç¢ºèªé–‹å§‹...');
                
                const tutorialInfo = {
                    exists: !!window.tutorial,
                    type: typeof window.tutorial,
                    constructor: window.tutorial?.constructor?.name,
                    hasTutorialSteps: !!window.tutorial?.tutorialSteps,
                    tutorialStepsType: typeof window.tutorial?.tutorialSteps,
                    tutorialStepsLength: window.tutorial?.tutorialSteps?.length,
                    currentStep: window.tutorial?.currentStep,
                    totalSteps: window.tutorial?.totalSteps,
                    hasLoadTutorialData: typeof window.tutorial?.loadTutorialData === 'function'
                };

                if (window.tutorial) {
                    if (window.tutorial.tutorialSteps && Array.isArray(window.tutorial.tutorialSteps)) {
                        addResult('Tutorial ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª', 'success',
                            'Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å­˜åœ¨ã—ã€tutorialStepsã‚‚åˆ©ç”¨å¯èƒ½ã§ã™',
                            `è©³ç´°:\n${JSON.stringify(tutorialInfo, null, 2)}`
                        );
                    } else {
                        addResult('Tutorial ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª', 'warning',
                            'Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯å­˜åœ¨ã—ã¾ã™ãŒã€tutorialStepsãŒæœªåˆæœŸåŒ–ã§ã™',
                            `è©³ç´°:\n${JSON.stringify(tutorialInfo, null, 2)}`
                        );
                    }
                } else {
                    addResult('Tutorial ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª', 'critical',
                        'window.tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“',
                        `è©³ç´°:\n${JSON.stringify(tutorialInfo, null, 2)}`
                    );
                }

            } catch (error) {
                addResult('Tutorial ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç¢ºèª', 'error', 
                    `ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`, 
                    error.stack
                );
            }
        }

        async function checkStepsJsonFile() {
            try {
                console.log('ğŸ“‚ steps.jsonç›´æ¥ç¢ºèªé–‹å§‹...');
                
                const startTime = Date.now();
                const response = await fetch('steps.json');
                const loadTime = Date.now() - startTime;
                
                const fileInfo = {
                    status: response.status,
                    statusText: response.statusText,
                    ok: response.ok,
                    headers: {
                        contentType: response.headers.get('Content-Type'),
                        contentLength: response.headers.get('Content-Length'),
                        lastModified: response.headers.get('Last-Modified')
                    },
                    loadTimeMs: loadTime,
                    url: response.url
                };

                if (response.ok) {
                    const rawText = await response.text();
                    
                    let jsonParseInfo = {};
                    try {
                        const jsonData = JSON.parse(rawText);
                        jsonParseInfo = {
                            parseSuccess: true,
                            isArray: Array.isArray(jsonData),
                            length: Array.isArray(jsonData) ? jsonData.length : 'N/A',
                            firstItem: Array.isArray(jsonData) && jsonData.length > 0 ? {
                                step: jsonData[0]?.step,
                                title: jsonData[0]?.title?.substring(0, 30)
                            } : null,
                            allStepNumbers: Array.isArray(jsonData) ? jsonData.map(s => s?.step) : []
                        };
                    } catch (parseError) {
                        jsonParseInfo = {
                            parseSuccess: false,
                            parseError: parseError.message,
                            rawTextLength: rawText.length,
                            rawTextPreview: rawText.substring(0, 100)
                        };
                    }

                    addResult('steps.json ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª', 
                        jsonParseInfo.parseSuccess ? 'success' : 'error',
                        jsonParseInfo.parseSuccess ? 
                            `steps.jsonãƒ•ã‚¡ã‚¤ãƒ«ã¯æ­£å¸¸ã«èª­ã¿è¾¼ã‚ã¾ã™ï¼ˆ${jsonParseInfo.length}ã‚¹ãƒ†ãƒƒãƒ—ï¼‰` :
                            'steps.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã¯ã§ãã¾ã™ãŒJSONè§£æã«å¤±æ•—',
                        `ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:\n${JSON.stringify(fileInfo, null, 2)}\n\nJSONè§£æ:\n${JSON.stringify(jsonParseInfo, null, 2)}`
                    );

                } else {
                    addResult('steps.json ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª', 'error',
                        `steps.jsonãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${response.status} ${response.statusText}`,
                        `ãƒ•ã‚¡ã‚¤ãƒ«æƒ…å ±:\n${JSON.stringify(fileInfo, null, 2)}`
                    );
                }

            } catch (error) {
                addResult('steps.json ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª', 'critical',
                    `steps.jsonèª­ã¿è¾¼ã¿ã§ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        async function checkNetworkStatus() {
            try {
                console.log('ğŸŒ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèªé–‹å§‹...');
                
                const networkInfo = {
                    onLine: navigator.onLine,
                    connection: navigator.connection ? {
                        effectiveType: navigator.connection.effectiveType,
                        downlink: navigator.connection.downlink,
                        rtt: navigator.connection.rtt
                    } : 'ãƒ‡ãƒ¼ã‚¿ãªã—'
                };

                // ç°¡å˜ãªæ¥ç¶šãƒ†ã‚¹ãƒˆ
                const testUrls = [
                    'steps.json',
                    'tutorial.js',
                    'index.html'
                ];

                const testResults = [];
                for (const url of testUrls) {
                    try {
                        const startTime = Date.now();
                        const response = await fetch(url, { method: 'HEAD' });
                        const loadTime = Date.now() - startTime;
                        
                        testResults.push({
                            url: url,
                            success: response.ok,
                            status: response.status,
                            loadTimeMs: loadTime
                        });
                    } catch (error) {
                        testResults.push({
                            url: url,
                            success: false,
                            error: error.message
                        });
                    }
                }

                const allTestsPassed = testResults.every(t => t.success);

                addResult('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèª', 
                    allTestsPassed ? 'success' : 'warning',
                    allTestsPassed ? 
                        'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã¯æ­£å¸¸ã§ã™' : 
                        'ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶šã«å•é¡ŒãŒã‚ã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™',
                    `ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æƒ…å ±:\n${JSON.stringify(networkInfo, null, 2)}\n\næ¥ç¶šãƒ†ã‚¹ãƒˆ:\n${JSON.stringify(testResults, null, 2)}`
                );

            } catch (error) {
                addResult('ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯çŠ¶æ³ç¢ºèª', 'error',
                    `ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        function checkCacheStatus() {
            try {
                console.log('ğŸ’¾ ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ³ç¢ºèªé–‹å§‹...');
                
                const cacheInfo = {
                    performance: performance ? {
                        navigation: performance.navigation ? {
                            type: performance.navigation.type,
                            redirectCount: performance.navigation.redirectCount
                        } : 'ãƒ‡ãƒ¼ã‚¿ãªã—',
                        timing: performance.timing ? {
                            domainLookupStart: performance.timing.domainLookupStart,
                            connectStart: performance.timing.connectStart,
                            requestStart: performance.timing.requestStart,
                            responseStart: performance.timing.responseStart,
                            domContentLoadedEventStart: performance.timing.domContentLoadedEventStart
                        } : 'ãƒ‡ãƒ¼ã‚¿ãªã—'
                    } : 'Performance APIãªã—',
                    localStorage: {
                        available: typeof Storage !== 'undefined',
                        itemsCount: localStorage ? localStorage.length : 'N/A'
                    },
                    sessionStorage: {
                        available: typeof sessionStorage !== 'undefined',
                        itemsCount: sessionStorage ? sessionStorage.length : 'N/A'
                    }
                };

                addResult('ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ³ç¢ºèª', 'info',
                    'ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸çŠ¶æ³ã‚’ç¢ºèªã—ã¾ã—ãŸ',
                    `ã‚­ãƒ£ãƒƒã‚·ãƒ¥æƒ…å ±:\n${JSON.stringify(cacheInfo, null, 2)}`
                );

            } catch (error) {
                addResult('ã‚­ãƒ£ãƒƒã‚·ãƒ¥çŠ¶æ³ç¢ºèª', 'warning',
                    `ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        function checkScriptLoadStatus() {
            try {
                console.log('ğŸ“œ JavaScriptèª­ã¿è¾¼ã¿çŠ¶æ³ç¢ºèªé–‹å§‹...');
                
                const scripts = document.querySelectorAll('script');
                const scriptInfo = Array.from(scripts).map(script => ({
                    src: script.src || 'inline',
                    type: script.type || 'text/javascript',
                    loaded: script.src ? 'unknown' : 'inline'
                }));

                const requiredClasses = [
                    { name: 'Tutorial', exists: typeof Tutorial !== 'undefined' },
                    { name: 'PhysicsValidator', exists: typeof PhysicsValidator !== 'undefined' },
                    { name: 'CrossSectionVisualizer', exists: typeof CrossSectionVisualizer !== 'undefined' }
                ];

                const loadStatus = {
                    totalScripts: scripts.length,
                    scriptDetails: scriptInfo,
                    requiredClasses: requiredClasses,
                    tutorialJsLoaded: scriptInfo.some(s => s.src.includes('tutorial.js')),
                    allRequiredClassesAvailable: requiredClasses.every(c => c.exists)
                };

                addResult('JavaScriptèª­ã¿è¾¼ã¿çŠ¶æ³', 
                    loadStatus.allRequiredClassesAvailable ? 'success' : 'warning',
                    loadStatus.allRequiredClassesAvailable ? 
                        'JavaScriptèª­ã¿è¾¼ã¿ã¯æ­£å¸¸ã§ã™' : 
                        'å¿…è¦ãªJavaScriptã‚¯ãƒ©ã‚¹ã®ä¸€éƒ¨ãŒèª­ã¿è¾¼ã¾ã‚Œã¦ã„ã¾ã›ã‚“',
                    `èª­ã¿è¾¼ã¿çŠ¶æ³:\n${JSON.stringify(loadStatus, null, 2)}`
                );

            } catch (error) {
                addResult('JavaScriptèª­ã¿è¾¼ã¿çŠ¶æ³', 'error',
                    `JavaScriptç¢ºèªã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        async function directStepsLoad() {
            console.log('ğŸ“‚ steps.jsonç›´æ¥èª­ã¿è¾¼ã¿é–‹å§‹...');
            
            try {
                const response = await fetch('steps.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const stepsData = await response.json();
                
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ä¿å­˜
                window.emergencyStepsData = stepsData;
                
                const loadInfo = {
                    success: true,
                    dataLength: stepsData.length,
                    stepNumbers: stepsData.map(s => s?.step),
                    allStepsValid: stepsData.every(s => s.step && s.title && s.template),
                    step1: stepsData.find(s => s.step === 1)?.title,
                    step4: stepsData.find(s => s.step === 4)?.title
                };

                addResult('ç›´æ¥èª­ã¿è¾¼ã¿', 'success',
                    `steps.jsonã®ç›´æ¥èª­ã¿è¾¼ã¿ã«æˆåŠŸã—ã¾ã—ãŸï¼ˆ${stepsData.length}ã‚¹ãƒ†ãƒƒãƒ—ï¼‰`,
                    `èª­ã¿è¾¼ã¿çµæœ:\n${JSON.stringify(loadInfo, null, 2)}\n\nãƒ‡ãƒ¼ã‚¿ã¯window.emergencyStepsDataã«ä¿å­˜ã•ã‚Œã¾ã—ãŸ`
                );

                // Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«æ³¨å…¥
                if (window.tutorial) {
                    window.tutorial.tutorialSteps = stepsData;
                    addResult('ãƒ‡ãƒ¼ã‚¿æ³¨å…¥', 'success',
                        'tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«ãƒ‡ãƒ¼ã‚¿ã‚’æ³¨å…¥ã—ã¾ã—ãŸ',
                        `tutorial.tutorialSteps.length: ${window.tutorial.tutorialSteps.length}`
                    );
                }

            } catch (error) {
                addResult('ç›´æ¥èª­ã¿è¾¼ã¿', 'error',
                    `ç›´æ¥èª­ã¿è¾¼ã¿ã«å¤±æ•—: ${error.message}`,
                    error.stack
                );
            }
        }

        function tutorialRebuild() {
            console.log('ğŸ”„ Tutorialå®Œå…¨å†æ§‹ç¯‰é–‹å§‹...');
            
            try {
                // æ—¢å­˜ã®tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªã‚¢
                if (window.tutorial) {
                    delete window.tutorial;
                }
                
                // Tutorialã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                if (typeof Tutorial === 'undefined') {
                    addResult('Tutorialå†æ§‹ç¯‰', 'error',
                        'Tutorialã‚¯ãƒ©ã‚¹ãŒåˆ©ç”¨ã§ãã¾ã›ã‚“ã€‚tutorial.jsã®èª­ã¿è¾¼ã¿ã‚’ç¢ºèªã—ã¦ãã ã•ã„'
                    );
                    return;
                }
                
                // æ–°ã—ã„Tutorialã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ
                window.tutorial = new Tutorial();
                
                setTimeout(async () => {
                    try {
                        // ãƒ‡ãƒ¼ã‚¿ã‚’å¼·åˆ¶èª­ã¿è¾¼ã¿
                        await window.tutorial.loadTutorialData();
                        
                        const rebuildResult = {
                            tutorialExists: !!window.tutorial,
                            tutorialStepsExists: !!window.tutorial.tutorialSteps,
                            tutorialStepsLength: window.tutorial.tutorialSteps?.length,
                            currentStep: window.tutorial.currentStep,
                            totalSteps: window.tutorial.totalSteps,
                            initializationComplete: true
                        };

                        if (window.tutorial.tutorialSteps && window.tutorial.tutorialSteps.length > 0) {
                            addResult('Tutorialå†æ§‹ç¯‰', 'success',
                                'Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å®Œå…¨å†æ§‹ç¯‰ã«æˆåŠŸã—ã¾ã—ãŸ',
                                `å†æ§‹ç¯‰çµæœ:\n${JSON.stringify(rebuildResult, null, 2)}`
                            );
                            
                            // åˆæœŸåŒ–ã‚‚å®Ÿè¡Œ
                            window.tutorial.initializeFirstStep();
                            
                            addResult('åˆæœŸåŒ–å®Ÿè¡Œ', 'success', 'Step 1ã®åˆæœŸåŒ–ãŒå®Œäº†ã—ã¾ã—ãŸ');
                            
                        } else {
                            addResult('Tutorialå†æ§‹ç¯‰', 'warning',
                                'Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯ä½œæˆã•ã‚Œã¾ã—ãŸãŒã€ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã«å•é¡ŒãŒã‚ã‚Šã¾ã™',
                                `å†æ§‹ç¯‰çµæœ:\n${JSON.stringify(rebuildResult, null, 2)}`
                            );
                        }

                    } catch (error) {
                        addResult('Tutorialå†æ§‹ç¯‰', 'error',
                            `ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                            error.stack
                        );
                    }
                }, 1000);

            } catch (error) {
                addResult('Tutorialå†æ§‹ç¯‰', 'error',
                    `å†æ§‹ç¯‰ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        function manualDataInjection() {
            console.log('âš¡ æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿æ³¨å…¥é–‹å§‹...');
            
            const manualStepsData = [
                {
                    "step": 1,
                    "title": "åŸºæœ¬çš„ãªCo-60ç·šæºã®ä½œæˆ",
                    "physics_background": "Co-60ã¯åŒ»ç™‚ç”¨Î³ç·šæºã¨ã—ã¦åºƒãä½¿ç”¨ã•ã‚Œã¦ãŠã‚Šã€1.17MeVã¨1.33MeVã®ç‰¹æ€§Î³ç·šã‚’æ”¾å‡ºã—ã¾ã™ã€‚",
                    "instructions": "åŒ»ç™‚ç”¨Co-60ç·šæºã‚’åŸç‚¹ï¼ˆ0,0,0ï¼‰ã«é…ç½®ã™ã‚‹JSONãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚",
                    "template": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"pokerinput_proposeSource\",\n  \"params\": {\n    \"name\": \"co60_medical\",\n    \"type\": \"POINT\",\n    \"position\": \"0 0 0\",\n    \"inventory\": [\n      {\n        \"nuclide\": \"Co60\",\n        \"radioactivity\": 37000000000\n      }\n    ]\n  }\n}",
                    "achievement": "ç·šæºä½œæˆãƒã‚¹ã‚¿ãƒ¼",
                    "completion_message": "ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼Co-60ç·šæºã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚",
                    "next_step_preview": "æ¬¡ã¯ã€ã“ã®ç·šæºã‚’é®è”½ã™ã‚‹ãŸã‚ã®ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆçƒæ®»ã‚’ä½œæˆã—ã¾ã™ã€‚"
                },
                {
                    "step": 2,
                    "title": "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆé®è”½ä½“ã®ä½œæˆ",
                    "physics_background": "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆã¯æ”¾å°„ç·šé®è”½æã¨ã—ã¦æœ€ã‚‚ä¸€èˆ¬çš„ãªææ–™ã§ã™ã€‚",
                    "instructions": "ç·šæºã‚’å›²ã‚€ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆçƒæ®»ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚",
                    "template": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"pokerinput_proposeBody\",\n  \"params\": {\n    \"name\": \"concrete_shield\",\n    \"type\": \"SPH\",\n    \"center\": \"0 0 0\",\n    \"radius\": 50\n  }\n}",
                    "achievement": "é®è”½è¨­è¨ˆã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢",
                    "completion_message": "å„ªç§€ã§ã™ï¼ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆé®è”½ä½“ã®ä½œæˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚",
                    "next_step_preview": "æ¬¡ã¯ã€é®è”½åŠ¹æœã‚’æ¸¬å®šã™ã‚‹ãŸã‚ã®æ¤œå‡ºå™¨ã‚’é…ç½®ã—ã¾ã™ã€‚"
                },
                {
                    "step": 3,
                    "title": "ç·šé‡ç‡æ¤œå‡ºå™¨ã®é…ç½®",
                    "physics_background": "ç·šé‡ç‡ã¯è·é›¢ã®äºŒä¹—ã«åæ¯”ä¾‹ã—ã¦æ¸›å°‘ã—ã¾ã™ã€‚",
                    "instructions": "é®è”½ä½“ã®å¤–å´ã«æ¤œå‡ºå™¨ã‚’é…ç½®ã—ã€ç·šé‡ç‡ã®ç©ºé–“åˆ†å¸ƒã‚’æ¸¬å®šã—ã¾ã™ã€‚",
                    "template": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"pokerinput_proposeDetector\",\n  \"params\": {\n    \"name\": \"dose_survey\",\n    \"origin\": \"60 0 0\",\n    \"grid\": [\n      {\n        \"edge\": \"10 0 0\",\n        \"number\": 10\n      }\n    ]\n  }\n}",
                    "achievement": "ç·šé‡æ¸¬å®šã‚¹ãƒšã‚·ãƒ£ãƒªã‚¹ãƒˆ",
                    "completion_message": "ç´ æ™´ã‚‰ã—ã„ã§ã™ï¼æ¤œå‡ºå™¨é…ç½®ãŒå®Œäº†ã—ã¾ã—ãŸã€‚",
                    "next_step_preview": "æ¬¡ã¯ã€ã‚ˆã‚ŠåŠ¹æœçš„ãªé‰›é®è”½ä½“ã‚’è¿½åŠ ã—ã¦è¤‡åˆé®è”½ã‚’å­¦ç¿’ã—ã¾ã™ã€‚"
                },
                {
                    "step": 4,
                    "title": "è¤‡åˆé®è”½ã®æœ€é©åŒ–è¨­è¨ˆ",
                    "physics_background": "é‰›ï¼ˆå¯†åº¦11.3 g/cmÂ³ï¼‰ã¯Î³ç·šé®è”½ã«æ¥µã‚ã¦åŠ¹æœçš„ã§ã™ã€‚",
                    "instructions": "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆçƒã®å†…å´ã«è–„ã„é‰›å±¤ã‚’è¿½åŠ ã—ã¦è¤‡åˆé®è”½ã‚’ä½œæˆã—ã¾ã™ã€‚",
                    "template": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"pokerinput_proposeBody\",\n  \"params\": {\n    \"name\": \"lead_inner_shield\",\n    \"type\": \"SPH\",\n    \"center\": \"0 0 0\",\n    \"radius\": 18\n  }\n}",
                    "achievement": "é®è”½æœ€é©åŒ–ãƒã‚¹ã‚¿ãƒ¼",
                    "completion_message": "å“è¶Šã—ãŸæˆæœã§ã™ï¼è¤‡åˆé®è”½ã®è¨­è¨ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚",
                    "next_step_preview": "æœ€å¾Œã«ã€å…¨ã¦ã®å¤‰æ›´ã‚’YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«é©ç”¨ã—ã¾ã™ã€‚"
                },
                {
                    "step": 5,
                    "title": "å®Ÿç”¨çµ±åˆã¨ãƒ‡ãƒ¼ã‚¿ç®¡ç†",
                    "physics_background": "è¨­è¨ˆã—ãŸé®è”½ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Ÿéš›ã®è¨ˆç®—ã§ä½¿ç”¨ã™ã‚‹ã«ã¯ã€YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚",
                    "instructions": "ã“ã‚Œã¾ã§ä½œæˆã—ãŸå…¨ã¦ã®è¦ç´ ã‚’YAMLãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã—ã¾ã™ã€‚",
                    "template": "{\n  \"jsonrpc\": \"2.0\",\n  \"method\": \"pokerinput_applyChanges\",\n  \"params\": {\n    \"backup_comment\": \"Interactive Tutorial Completion - Co60 shielding design\"\n  }\n}",
                    "achievement": "æ”¾å°„ç·šé®è”½ç ”ç©¶ãƒã‚¹ã‚¿ãƒ¼",
                    "completion_message": "ğŸ‰ ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ï¼ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚’å®Œå…¨åˆ¶è¦‡ã•ã‚Œã¾ã—ãŸã€‚"
                }
            ];

            try {
                // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°ã¨ã—ã¦ä¿å­˜
                window.manualStepsData = manualStepsData;
                
                // Tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã™ã‚‹å ´åˆã¯æ³¨å…¥
                if (window.tutorial) {
                    window.tutorial.tutorialSteps = manualStepsData;
                    window.tutorial.totalSteps = 5;
                    
                    // Step 1ã«åˆæœŸåŒ–
                    window.tutorial.currentStep = 1;
                    window.tutorial.updateStepContent();
                    window.tutorial.resetCode();
                    window.tutorial.updateProgress();
                    
                    addResult('æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿æ³¨å…¥', 'success',
                        'ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸã‚¹ãƒ†ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®æ³¨å…¥ã«æˆåŠŸã—ã¾ã—ãŸ',
                        `æ³¨å…¥çµæœ:\n- tutorialSteps.length: ${window.tutorial.tutorialSteps.length}\n- currentStep: ${window.tutorial.currentStep}\n- totalSteps: ${window.tutorial.totalSteps}`
                    );
                    
                } else {
                    addResult('æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿æ³¨å…¥', 'warning',
                        'ãƒ‡ãƒ¼ã‚¿ã¯æ³¨å…¥ã•ã‚Œã¾ã—ãŸãŒã€tutorialã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒå­˜åœ¨ã—ã¾ã›ã‚“',
                        'ãƒ‡ãƒ¼ã‚¿ã¯window.manualStepsDataã«ä¿å­˜ã•ã‚Œã¾ã—ãŸ'
                    );
                }

            } catch (error) {
                addResult('æ‰‹å‹•ãƒ‡ãƒ¼ã‚¿æ³¨å…¥', 'error',
                    `æ‰‹å‹•æ³¨å…¥ã‚¨ãƒ©ãƒ¼: ${error.message}`,
                    error.stack
                );
            }
        }

        // åˆæœŸçŠ¶æ…‹ç¢ºèª
        window.addEventListener('load', () => {
            setTimeout(() => {
                addResult('ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–', 'info', 
                    'tutorialStepsä¿®å¾©ã‚·ã‚¹ãƒ†ãƒ ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ',
                    `window.tutorialå­˜åœ¨: ${!!window.tutorial}\ntutorialStepså­˜åœ¨: ${!!window.tutorial?.tutorialSteps}`
                );
            }, 1000);
        });
    </script>
</body>
</html>