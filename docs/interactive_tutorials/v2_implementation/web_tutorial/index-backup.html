<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🎮 Poker MCP インタラクティブ入門 v2.0</title>
    <link rel="stylesheet" href="assets/styles.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/themes/prism-tomorrow.min.css" rel="stylesheet" />
</head>
<body>
    <div class="tutorial-header">
        <div class="header-content">
            <h1>🎮 Poker MCP インタラクティブ入門 v2.0</h1>
            <div class="header-controls">
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                        <span class="progress-text" id="progressText">Step 1 / 5</span>
                    </div>
                </div>
                <div class="header-buttons">
                    <button id="toggleVisualization" class="header-btn">🎨 可視化</button>
                    <button id="showPhysicsAnalysis" class="header-btn">🔬 物理解析</button>
                </div>
            </div>
        </div>
    </div>

    <div class="tutorial-container">
        <!-- 指導パネル -->
        <div class="instruction-panel">
            <div class="step-header">
                <span class="step-badge" id="stepBadge">Step 1</span>
                <h2 id="stepTitle">基本的なCo-60線源の作成</h2>
            </div>
            
            <div class="physics-context">
                <h3>🔬 物理的背景</h3>
                <p id="physicsExplanation">
                    Co-60は医療用γ線源として広く使用されており、1.17MeVと1.33MeVの特性γ線を放出します。
                    この実習では、典型的な医療施設で使用される37GBq（1Ci）のCo-60点線源をモデル化します。
                </p>
            </div>
            
            <div class="instruction-content">
                <h3>📋 実習内容</h3>
                <p id="stepInstructions">
                    医療用Co-60線源を原点（0,0,0）に配置するJSONリクエストを作成してください。
                    右側のテンプレートを参考に、必要な部分を補完してください。
                </p>
                
                <div class="learning-objectives">
                    <h4>💡 学習目標</h4>
                    <ul id="learningObjectives">
                        <li>JSON-RPC 2.0形式の理解</li>
                        <li>pokerinput_proposeSourceメソッドの基本構造</li>
                        <li>放射能単位（Bq）の実際の値</li>
                        <li>POINT型線源の座標指定方法</li>
                    </ul>
                </div>
            </div>

            <div class="hint-section" id="hintSection" style="display: none;">
                <h3>💡 ヒント</h3>
                <div id="hintContent"></div>
            </div>

            <!-- 物理解析パネル -->
            <div class="physics-analysis" id="physicsAnalysis" style="display: none;">
                <h3>🔬 物理解析</h3>
                <div id="physicsAnalysisContent"></div>
            </div>
        </div>

        <!-- コードエディタパネル -->
        <div class="code-panel">
            <div class="panel-header">
                <h3>✏️ JSONエディタ</h3>
                <div class="editor-controls">
                    <button id="executeBtn" class="execute-btn">🚀 実行</button>
                    <button id="resetBtn" class="reset-btn">🔄 リセット</button>
                    <button id="hintBtn" class="hint-btn">💡 ヒント</button>
                </div>
            </div>
            
            <div class="code-editor-container">
                <pre><code class="language-json" id="codeEditor" contenteditable="true" spellcheck="false"></code></pre>
            </div>
            
            <div class="code-status" id="codeStatus">
                <span class="status-indicator" id="statusIndicator">⏳ 待機中</span>
                <span id="statusMessage">JSONを編集して実行してください</span>
            </div>

            <!-- 2D可視化パネル -->
            <div class="visualization-panel" id="visualizationPanel" style="display: none;">
                <div class="visualization-header">
                    <h4>🎨 2D断面図</h4>
                    <button class="close-btn" onclick="document.getElementById('visualizationPanel').style.display='none'">×</button>
                </div>
                <canvas id="geometryCanvas" width="400" height="300"></canvas>
                <div class="visualization-controls">
                    <button onclick="window.tutorial?.visualizer.render()">🔄 更新</button>
                    <button onclick="window.tutorial?.visualizer.animateRadiation()">⚡ 放射線表示</button>
                </div>
            </div>
        </div>

        <!-- 結果パネル -->
        <div class="result-panel">
            <div class="panel-header">
                <h3>📊 実行結果</h3>
                <div class="result-controls">
                    <button id="prevBtn" class="prev-btn" disabled>◀️ 前のステップ</button>
                    <button id="nextBtn" class="next-btn" disabled>▶️ 次のステップ</button>
                </div>
            </div>
            
            <div class="result-content">
                <div class="result-display" id="resultDisplay">
                    <div class="placeholder-message">
                        <p>💡 JSONを実行すると結果がここに表示されます</p>
                        <p>成功すると次のステップに進めます</p>
                    </div>
                </div>
                
                <div class="validation-feedback" id="validationFeedback" style="display: none;">
                    <h4>✅ 検証結果</h4>
                    <div id="validationDetails"></div>
                </div>

                <!-- 実行履歴表示 -->
                <div class="execution-history" id="executionHistory" style="display: none;">
                    <h4>📜 実行履歴</h4>
                    <div class="history-list" id="historyList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- 完了モーダル -->
    <div class="modal-overlay" id="modalOverlay" style="display: none;">
        <div class="completion-modal">
            <div class="modal-header">
                <h2>🎉 ステップ完了！</h2>
            </div>
            <div class="modal-content">
                <div class="achievement-badge">
                    <span class="badge-icon">🏆</span>
                    <span id="achievementText">線源作成マスター</span>
                </div>
                <p id="completionMessage">素晴らしいです！Co-60線源の作成が完了しました。</p>
                <div class="next-preview">
                    <h4>📖 次のステップ</h4>
                    <div id="nextStepPreview">コンクリート遮蔽体の作成を学習します</div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="continueBtn" class="continue-btn">続ける</button>
            </div>
        </div>
    </div>

    <!-- 進捗統計モーダル（全完了時） -->
    <div class="stats-modal" id="statsModal" style="display: none;">
        <div class="stats-content">
            <h2>📊 学習統計</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-number" id="totalTime">--</span>
                    <span class="stat-label">学習時間</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="stepsCompleted">5</span>
                    <span class="stat-label">完了ステップ</span>
                </div>
                <div class="stat-item">
                    <span class="stat-number" id="accuracy">--</span>
                    <span class="stat-label">正答率</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ローディングオーバーレイ -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>物理計算中...</p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.24.1/components/prism-json.min.js"></script>
    <script src="physics-validator.js"></script>
    <script src="cross-section-visualizer.js"></script>
    <script src="tutorial.js"></script>
</body>
</html>