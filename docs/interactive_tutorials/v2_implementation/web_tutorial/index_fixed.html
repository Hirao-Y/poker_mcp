<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¨ Poker MCP 3Då¯è¦–åŒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</title>
    <link rel="stylesheet" href="assets/styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ æ”¾å°„ç·šé®è”½è¨ˆç®— 3Då¯è¦–åŒ–ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«</h1>
            <p>Co-60ç·šæºã‚’ä½¿ç”¨ã—ãŸåŒ»ç™‚æ–½è¨­é®è”½è¨­è¨ˆã®å­¦ç¿’</p>
        </header>

        <main>
            <!-- ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
            <div class="progress-container">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <span class="progress-text" id="progressText">Step 1 / 5</span>
            </div>

            <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            <div class="content-area" id="contentArea">
                <!-- å‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
            </div>

            <!-- å¯è¦–åŒ–ã‚¨ãƒªã‚¢ -->
            <div class="visualization-area">
                <div class="viz-header">
                    <h4>ğŸ¨ 3D å¯è¦–åŒ–</h4>
                    <div class="viz-controls">
                        <button id="toggle3DVisualization" class="viz-btn">ğŸ¯ 3Dè¡¨ç¤º</button>
                        <button id="show3DControls" class="viz-btn">âš™ï¸ è¨­å®š</button>
                        <button id="capture3DScreenshot" class="viz-btn">ğŸ“· ç”»é¢ä¿å­˜</button>
                        <button id="show3DDiagnostic" class="viz-btn">ğŸ” è¨ºæ–­</button>
                        <button id="runDeepDiagnostic" class="viz-btn">ğŸ”¬ è©³ç´°è¨ºæ–­</button>
                        <button id="fixIssues" class="viz-btn">ğŸ”§ ä¿®æ­£å®Ÿè¡Œ</button>
                    </div>
                </div>
                
                <canvas id="geometryCanvas" width="400" height="300">
                    ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯Canvasè¦ç´ ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚
                </canvas>
                
                <div id="visualizationMessage" class="viz-message">
                    3Då¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿ä¸­...
                </div>
                
                <div id="visualizationFallback" class="viz-fallback" style="display: none;">
                    ğŸ¨ 2Dè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ï¼ˆWebGLæœªå¯¾å¿œç’°å¢ƒï¼‰
                </div>
            </div>

            <!-- JSONå…¥åŠ›ã‚¨ãƒªã‚¢ -->
            <div class="input-section">
                <h3>ğŸ“ JSON-RPC 2.0 å…¥åŠ›</h3>
                <textarea id="jsonInput" placeholder="JSON-RPC 2.0 ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„..." rows="8"></textarea>
                <div class="button-group">
                    <button id="executeJson" class="primary-btn">ğŸš€ å®Ÿè¡Œ</button>
                    <button id="clearJson" class="secondary-btn">ğŸ—‘ï¸ ã‚¯ãƒªã‚¢</button>
                    <button id="validateJson" class="secondary-btn">âœ… æ¤œè¨¼</button>
                </div>
            </div>

            <!-- çµæœè¡¨ç¤ºã‚¨ãƒªã‚¢ -->
            <div class="output-section">
                <h3>ğŸ“Š å®Ÿè¡Œçµæœ</h3>
                <pre id="jsonOutput" class="output-content">çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...</pre>
            </div>

            <!-- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ -->
            <div class="navigation">
                <button id="prevStep" class="nav-btn secondary-btn" disabled>â¬…ï¸ å‰ã®ã‚¹ãƒ†ãƒƒãƒ—</button>
                <button id="nextStep" class="nav-btn primary-btn">æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ— â¡ï¸</button>
                <button id="resetTutorial" class="nav-btn secondary-btn">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
        </main>

        <footer>
            <p>ğŸ“ Poker MCP Tutorial System v2.0 - æ”¾å°„ç·šé®è”½è¨ˆç®—å­¦ç¿’ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ </p>
        </footer>
    </div>

    <!-- ã‚¨ãƒ©ãƒ¼ä¿®æ­£ç”¨ã®çµ±åˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ -->
    <script>
        // å³åº§ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ 
        console.log('ğŸ”§ çµ±åˆä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ é–‹å§‹...');
        
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°åˆæœŸåŒ–
        window.tutorial = null;
        window.tutorialCore = null;
        window.tutorialUI = null;
        
        // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
        window.addEventListener('error', function(e) {
            console.error('ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¨ãƒ©ãƒ¼:', e.error);
        });
        
        // ç°¡æ˜“TutorialCoreã‚¯ãƒ©ã‚¹ï¼ˆå¿…è¦æœ€å°é™ï¼‰
        class SimpleTutorialCore {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 5;
                this.steps = [
                    {
                        title: "Step 1: Co-60ç·šæºã®è¨­å®š",
                        content: "åŒ»ç™‚ç”¨Co-60ç·šæºã‚’åŸç‚¹ã«é…ç½®ã—ã¾ã™ã€‚",
                        jsonTemplate: `{
  "jsonrpc": "2.0",
  "method": "pokerinput_proposeSource",
  "params": {
    "name": "co60_medical",
    "type": "POINT",
    "position": "0 0 0",
    "inventory": [
      {
        "nuclide": "Co60",
        "radioactivity": 37000000000
      }
    ]
  },
  "id": 1
}`
                    },
                    {
                        title: "Step 2: ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆé®è”½ä½“",
                        content: "ã‚³ãƒ³ã‚¯ãƒªãƒ¼ãƒˆçƒå½¢é®è”½ä½“ã‚’è¿½åŠ ã—ã¾ã™ã€‚",
                        jsonTemplate: `{
  "jsonrpc": "2.0", 
  "method": "pokerinput_proposeBody",
  "params": {
    "name": "concrete_shield",
    "type": "SPH",
    "center": "0 0 0",
    "radius": 50
  },
  "id": 2
}`
                    },
                    {
                        title: "Step 3: æ¤œå‡ºå™¨é…ç½®", 
                        content: "ç·šé‡ç‡æ¸¬å®šç”¨æ¤œå‡ºå™¨ã‚’é…ç½®ã—ã¾ã™ã€‚",
                        jsonTemplate: `{
  "jsonrpc": "2.0",
  "method": "pokerinput_proposeDetector", 
  "params": {
    "name": "dose_survey",
    "origin": "60 0 0",
    "grid": [{"edge": "10 0 0", "number": 10}]
  },
  "id": 3
}`
                    },
                    {
                        title: "Step 4: é‰›é®è”½è¿½åŠ ",
                        content: "å†…å´ã«é‰›é®è”½çƒã‚’è¿½åŠ ã—ã¾ã™ã€‚",
                        jsonTemplate: `{
  "jsonrpc": "2.0",
  "method": "pokerinput_proposeBody",
  "params": {
    "name": "lead_inner_shield", 
    "type": "SPH",
    "center": "0 0 0",
    "radius": 18
  },
  "id": 4
}`
                    },
                    {
                        title: "Step 5: å®Œæˆãƒ»ä¿å­˜",
                        content: "è¨­è¨ˆã‚’å®Œæˆã•ã›ã€ä¿å­˜ã—ã¾ã™ã€‚",
                        jsonTemplate: `{
  "jsonrpc": "2.0",
  "method": "pokerinput_applyChanges", 
  "params": {
    "backup_comment": "Medical Co-60 shielding design completed"
  },
  "id": 5
}`
                    }
                ];
                console.log('âœ… SimpleTutorialCoreåˆæœŸåŒ–å®Œäº†');
            }
            
            getCurrentStep() {
                return this.steps[this.currentStep - 1];
            }
            
            updateStepContent() {
                return this.getCurrentStep();
            }
            
            nextStep() {
                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.updateUI();
                    return true;
                }
                return false;
            }
            
            prevStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateUI();
                    return true;
                }
                return false;
            }
            
            updateUI() {
                const step = this.getCurrentStep();
                
                // ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹æ›´æ–°
                const progressFill = document.getElementById('progressFill');
                const progressText = document.getElementById('progressText');
                if (progressFill) {
                    progressFill.style.width = `${(this.currentStep / this.totalSteps) * 100}%`;
                }
                if (progressText) {
                    progressText.textContent = `Step ${this.currentStep} / ${this.totalSteps}`;
                }
                
                // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ›´æ–°
                const contentArea = document.getElementById('contentArea');
                if (contentArea && step) {
                    contentArea.innerHTML = `
                        <div class="step-content">
                            <h2>${step.title}</h2>
                            <p>${step.content}</p>
                        </div>
                    `;
                }
                
                // JSONå…¥åŠ›æ›´æ–°
                const jsonInput = document.getElementById('jsonInput');
                if (jsonInput && step.jsonTemplate) {
                    jsonInput.value = step.jsonTemplate;
                }
                
                // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³æ›´æ–°
                const prevBtn = document.getElementById('prevStep');
                const nextBtn = document.getElementById('nextStep');
                if (prevBtn) {
                    prevBtn.disabled = this.currentStep === 1;
                }
                if (nextBtn) {
                    nextBtn.disabled = this.currentStep === this.totalSteps;
                }
                
                console.log(`ğŸ“ Step ${this.currentStep} ã«æ›´æ–°`);
            }
        }
        
        // ç°¡æ˜“å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ ï¼ˆCanvas 2Dï¼‰
        class Simple2DVisualizer {
            constructor(canvasId) {
                this.canvasId = canvasId;
                this.canvas = document.getElementById(canvasId);
                this.ctx = null;
                this.sources = [];
                this.shields = [];
                this.detectors = [];
                
                if (this.canvas) {
                    this.ctx = this.canvas.getContext('2d');
                    this.setupCanvas();
                    this.showMessage('2Då¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†', 'success');
                    console.log('âœ… 2Då¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†');
                } else {
                    console.error('âŒ Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            }
            
            setupCanvas() {
                this.canvas.width = this.canvas.clientWidth;
                this.canvas.height = this.canvas.clientHeight;
                this.render();
            }
            
            addRadiationSource(name, position, nuclide, activity) {
                this.sources.push({ name, position, nuclide, activity });
                this.render();
                console.log(`ğŸ“ ç·šæºè¿½åŠ : ${name} (${nuclide})`);
            }
            
            addShield(name, type, parameters, material) {
                this.shields.push({ name, type, parameters, material });
                this.render();
                console.log(`ğŸ›¡ï¸ é®è”½ä½“è¿½åŠ : ${name} (${material})`);
            }
            
            addDetector(name, origin, grid) {
                this.detectors.push({ name, origin, grid });
                this.render();
                console.log(`ğŸ” æ¤œå‡ºå™¨è¿½åŠ : ${name}`);
            }
            
            render() {
                if (!this.ctx) return;
                
                const width = this.canvas.width;
                const height = this.canvas.height;
                const centerX = width / 2;
                const centerY = height / 2;
                
                // èƒŒæ™¯ã‚¯ãƒªã‚¢
                this.ctx.clearRect(0, 0, width, height);
                this.ctx.fillStyle = '#f0f8ff';
                this.ctx.fillRect(0, 0, width, height);
                
                // ã‚°ãƒªãƒƒãƒ‰
                this.drawGrid(width, height);
                
                // é®è”½ä½“æç”»
                this.shields.forEach(shield => this.drawShield(shield, centerX, centerY));
                
                // ç·šæºæç”»
                this.sources.forEach(source => this.drawSource(source, centerX, centerY));
                
                // æ¤œå‡ºå™¨æç”»
                this.detectors.forEach(detector => this.drawDetector(detector, centerX, centerY));
                
                // æƒ…å ±è¡¨ç¤º
                this.drawInfo();
            }
            
            drawGrid(width, height) {
                this.ctx.strokeStyle = '#ddd';
                this.ctx.lineWidth = 1;
                for (let i = 0; i <= width; i += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(i, 0);
                    this.ctx.lineTo(i, height);
                    this.ctx.stroke();
                }
                for (let i = 0; i <= height; i += 20) {
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, i);
                    this.ctx.lineTo(width, i);
                    this.ctx.stroke();
                }
            }
            
            drawSource(source, centerX, centerY) {
                this.ctx.fillStyle = '#ff0000';
                this.ctx.beginPath();
                this.ctx.arc(centerX, centerY, 8, 0, 2 * Math.PI);
                this.ctx.fill();
                
                this.ctx.fillStyle = '#ffffff';
                this.ctx.font = '12px Arial';
                this.ctx.textAlign = 'center';
                this.ctx.fillText(source.nuclide || 'Source', centerX, centerY + 4);
            }
            
            drawShield(shield, centerX, centerY) {
                this.ctx.strokeStyle = shield.material === 'LEAD' ? '#333' : '#888';
                this.ctx.lineWidth = shield.material === 'LEAD' ? 2 : 3;
                this.ctx.setLineDash([5, 5]);
                
                if (shield.type === 'SPH') {
                    this.ctx.beginPath();
                    this.ctx.arc(centerX, centerY, shield.parameters.radius || 50, 0, 2 * Math.PI);
                    this.ctx.stroke();
                    
                    // ãƒ©ãƒ™ãƒ«
                    this.ctx.fillStyle = shield.material === 'LEAD' ? '#333' : '#666';
                    this.ctx.font = '10px Arial';
                    this.ctx.textAlign = 'left';
                    this.ctx.setLineDash([]);
                    this.ctx.fillText(
                        `${shield.material} (${shield.name})`,
                        centerX + (shield.parameters.radius || 50) + 5,
                        centerY - (shield.parameters.radius || 50) + 15
                    );
                }
            }
            
            drawDetector(detector, centerX, centerY) {
                for (let i = 0; i < 5; i++) {
                    const x = centerX + 80 + i * 15;
                    const y = centerY;
                    
                    this.ctx.fillStyle = '#00ff00';
                    this.ctx.fillRect(x - 3, y - 3, 6, 6);
                }
                
                this.ctx.fillStyle = '#006600';
                this.ctx.font = '10px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText('Detectors', centerX + 80, centerY - 15);
            }
            
            drawInfo() {
                this.ctx.fillStyle = '#000';
                this.ctx.font = 'bold 14px Arial';
                this.ctx.textAlign = 'left';
                this.ctx.fillText('2Dè¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰', 10, 25);
                
                this.ctx.font = '12px Arial';
                this.ctx.fillText(`ç·šæº: ${this.sources.length}å€‹`, 10, 45);
                this.ctx.fillText(`é®è”½ä½“: ${this.shields.length}å€‹`, 10, 60);
                this.ctx.fillText(`æ¤œå‡ºå™¨: ${this.detectors.length}å€‹`, 10, 75);
            }
            
            clearAll() {
                this.sources = [];
                this.shields = [];
                this.detectors = [];
                this.render();
                console.log('ğŸ—‘ï¸ å¯è¦–åŒ–è¦ç´ ã‚’ã‚¯ãƒªã‚¢');
            }
            
            showMessage(message, type = 'info') {
                const messageElement = document.getElementById('visualizationMessage');
                if (messageElement) {
                    messageElement.textContent = message;
                    messageElement.style.display = 'block';
                    
                    switch (type) {
                        case 'success':
                            messageElement.style.color = '#28a745';
                            messageElement.style.backgroundColor = 'rgba(40, 167, 69, 0.1)';
                            break;
                        case 'error':
                            messageElement.style.color = '#dc3545';
                            messageElement.style.backgroundColor = 'rgba(220, 53, 69, 0.1)';
                            break;
                        default:
                            messageElement.style.color = '#0056b3';
                            messageElement.style.backgroundColor = 'rgba(0, 123, 255, 0.1)';
                    }
                }
            }
        }
        
        // ãƒ¡ã‚¤ãƒ³åˆæœŸåŒ–
        function initializeTutorial() {
            console.log('ğŸš€ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«åˆæœŸåŒ–é–‹å§‹...');
            
            try {
                // ã‚³ã‚¢ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
                window.tutorialCore = new SimpleTutorialCore();
                
                // å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–
                window.visualizer = new Simple2DVisualizer('geometryCanvas');
                
                // UIã‚¤ãƒ™ãƒ³ãƒˆè¨­å®š
                setupEventListeners();
                
                // åˆæœŸè¡¨ç¤º
                window.tutorialCore.updateUI();
                
                console.log('âœ… ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«åˆæœŸåŒ–å®Œäº†');
                
                // æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                if (window.visualizer) {
                    window.visualizer.showMessage('ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚·ã‚¹ãƒ†ãƒ åˆæœŸåŒ–å®Œäº†ï¼ˆ2Dãƒ¢ãƒ¼ãƒ‰ï¼‰', 'success');
                }
                
            } catch (error) {
                console.error('âŒ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼:', error);
                const messageElement = document.getElementById('visualizationMessage');
                if (messageElement) {
                    messageElement.textContent = `åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                    messageElement.style.color = '#dc3545';
                }
            }
        }
        
        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¨­å®š
        function setupEventListeners() {
            // ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
            document.getElementById('nextStep')?.addEventListener('click', () => {
                if (window.tutorialCore?.nextStep()) {
                    updateVisualizationForCurrentStep();
                }
            });
            
            document.getElementById('prevStep')?.addEventListener('click', () => {
                if (window.tutorialCore?.prevStep()) {
                    updateVisualizationForCurrentStep();
                }
            });
            
            document.getElementById('resetTutorial')?.addEventListener('click', () => {
                window.tutorialCore.currentStep = 1;
                window.tutorialCore.updateUI();
                window.visualizer?.clearAll();
                updateVisualizationForCurrentStep();
            });
            
            // JSONå®Ÿè¡Œãƒœã‚¿ãƒ³
            document.getElementById('executeJson')?.addEventListener('click', () => {
                executeJsonRpc();
            });
            
            document.getElementById('clearJson')?.addEventListener('click', () => {
                document.getElementById('jsonInput').value = '';
                document.getElementById('jsonOutput').textContent = 'çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...';
            });
            
            document.getElementById('validateJson')?.addEventListener('click', () => {
                validateJsonInput();
            });
            
            // å¯è¦–åŒ–ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³
            document.getElementById('toggle3DVisualization')?.addEventListener('click', () => {
                alert('3Dæ©Ÿèƒ½ã¯ç¾åœ¨2Dãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å‹•ä½œä¸­ã§ã™ã€‚\nåŸºæœ¬æ©Ÿèƒ½ã¯æ­£å¸¸ã«å‹•ä½œã—ã¾ã™ã€‚');
            });
            
            document.getElementById('runDeepDiagnostic')?.addEventListener('click', () => {
                showDiagnosticInfo();
            });
            
            document.getElementById('fixIssues')?.addEventListener('click', () => {
                attemptAutoFix();
            });
        }
        
        // ã‚¹ãƒ†ãƒƒãƒ—ã«å¿œã˜ãŸå¯è¦–åŒ–æ›´æ–°
        function updateVisualizationForCurrentStep() {
            if (!window.visualizer || !window.tutorialCore) return;
            
            const step = window.tutorialCore.currentStep;
            
            // æ®µéšçš„ã«è¦ç´ ã‚’è¿½åŠ 
            if (step >= 1) {
                window.visualizer.addRadiationSource('co60_medical', [0, 0, 0], 'Co60', 37000000000);
            }
            
            if (step >= 2) {
                window.visualizer.addShield('concrete_shield', 'SPH', { radius: 50 }, 'CONCRETE');
            }
            
            if (step >= 3) {
                window.visualizer.addDetector('dose_survey', [60, 0, 0], [{ edge: [10, 0, 0], number: 10 }]);
            }
            
            if (step >= 4) {
                window.visualizer.addShield('lead_inner_shield', 'SPH', { radius: 18 }, 'LEAD');
            }
        }
        
        // JSON-RPCå®Ÿè¡Œï¼ˆã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰
        function executeJsonRpc() {
            const jsonInput = document.getElementById('jsonInput');
            const jsonOutput = document.getElementById('jsonOutput');
            
            try {
                const request = JSON.parse(jsonInput.value);
                
                // ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å¿œç­”
                const response = {
                    jsonrpc: "2.0",
                    result: {
                        success: true,
                        message: `${request.method} ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸ`,
                        timestamp: new Date().toISOString()
                    },
                    id: request.id
                };
                
                jsonOutput.textContent = JSON.stringify(response, null, 2);
                jsonOutput.style.color = '#28a745';
                
                // å¯è¦–åŒ–æ›´æ–°
                updateVisualizationFromJson(request);
                
            } catch (error) {
                const errorResponse = {
                    jsonrpc: "2.0",
                    error: {
                        code: -32700,
                        message: "Parse error",
                        data: error.message
                    },
                    id: null
                };
                
                jsonOutput.textContent = JSON.stringify(errorResponse, null, 2);
                jsonOutput.style.color = '#dc3545';
            }
        }
        
        // JSONæ¤œè¨¼
        function validateJsonInput() {
            const jsonInput = document.getElementById('jsonInput');
            const jsonOutput = document.getElementById('jsonOutput');
            
            try {
                const parsed = JSON.parse(jsonInput.value);
                
                if (parsed.jsonrpc !== "2.0") {
                    throw new Error("JSON-RPC 2.0ã§ã¯ã‚ã‚Šã¾ã›ã‚“");
                }
                
                if (!parsed.method) {
                    throw new Error("methodãŒæŒ‡å®šã•ã‚Œã¦ã„ã¾ã›ã‚“");
                }
                
                jsonOutput.textContent = 'âœ… JSONå½¢å¼ã¯æ­£ã—ã„ã§ã™';
                jsonOutput.style.color = '#28a745';
                
            } catch (error) {
                jsonOutput.textContent = `âŒ JSONæ¤œè¨¼ã‚¨ãƒ©ãƒ¼: ${error.message}`;
                jsonOutput.style.color = '#dc3545';
            }
        }
        
        // JSONã‹ã‚‰å¯è¦–åŒ–æ›´æ–°
        function updateVisualizationFromJson(request) {
            if (!window.visualizer) return;
            
            const method = request.method;
            const params = request.params;
            
            if (method === 'pokerinput_proposeSource' && params) {
                window.visualizer.addRadiationSource(
                    params.name,
                    params.position?.split(' ').map(Number) || [0, 0, 0],
                    params.inventory?.[0]?.nuclide || 'Unknown',
                    params.inventory?.[0]?.radioactivity || 0
                );
            } else if (method === 'pokerinput_proposeBody' && params) {
                const center = params.center?.split(' ').map(Number) || [0, 0, 0];
                window.visualizer.addShield(
                    params.name,
                    params.type,
                    { center, radius: params.radius },
                    'CONCRETE'
                );
            } else if (method === 'pokerinput_proposeDetector' && params) {
                const origin = params.origin?.split(' ').map(Number) || [0, 0, 0];
                window.visualizer.addDetector(params.name, origin, params.grid || []);
            }
        }
        
        // è¨ºæ–­æƒ…å ±è¡¨ç¤º
        function showDiagnosticInfo() {
            const info = `
=== ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­æƒ…å ± ===

âœ… å®Ÿè¡Œç’°å¢ƒ: ${window.location.protocol}//${window.location.host}
âœ… ãƒ–ãƒ©ã‚¦ã‚¶: ${navigator.userAgent.split(' ')[0]}
âœ… Canvasè¦ç´ : ${document.getElementById('geometryCanvas') ? 'å­˜åœ¨' : 'è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“'}
âœ… 2Dã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: ${document.getElementById('geometryCanvas')?.getContext('2d') ? 'åˆ©ç”¨å¯èƒ½' : 'åˆ©ç”¨ä¸å¯'}
âœ… WebGLã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ: ${document.getElementById('geometryCanvas')?.getContext('webgl') ? 'åˆ©ç”¨å¯èƒ½' : 'åˆ©ç”¨ä¸å¯'}

ğŸ“Š ç¾åœ¨ã®çŠ¶æ…‹:
â€¢ ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚³ã‚¢: ${window.tutorialCore ? 'å‹•ä½œä¸­' : 'æœªåˆæœŸåŒ–'}
â€¢ 2Då¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ : ${window.visualizer ? 'å‹•ä½œä¸­' : 'æœªåˆæœŸåŒ–'}
â€¢ ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—: ${window.tutorialCore?.currentStep || 'Unknown'}

âš ï¸ åˆ¶é™äº‹é …:
â€¢ file://ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§ã®å®Ÿè¡Œã«ã‚ˆã‚Šã€3Dæ©Ÿèƒ½ã¯2Dãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§å‹•ä½œ
â€¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ©Ÿèƒ½ï¼ˆCDNèª­ã¿è¾¼ã¿ï¼‰ãŒåˆ¶é™ã•ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™
â€¢ HTTPã‚µãƒ¼ãƒãƒ¼ã§ã®å®Ÿè¡Œã‚’æ¨å¥¨ã—ã¾ã™

ğŸ”§ æ¨å¥¨å¯¾å‡¦æ³•:
1. Pythonã§ãƒ­ãƒ¼ã‚«ãƒ«ã‚µãƒ¼ãƒãƒ¼èµ·å‹•: python -m http.server 8000
2. ã‚¢ã‚¯ã‚»ã‚¹: http://localhost:8000
3. ã¾ãŸã¯æœ€æ–°ãƒ–ãƒ©ã‚¦ã‚¶ã§file://åˆ¶é™ã‚’ç„¡åŠ¹åŒ–
            `;
            
            alert(info);
        }
        
        // è‡ªå‹•ä¿®æ­£è©¦è¡Œ
        function attemptAutoFix() {
            console.log('ğŸ”§ è‡ªå‹•ä¿®æ­£ã‚’è©¦è¡Œä¸­...');
            
            // Canvasè¦ç´ ãƒã‚§ãƒƒã‚¯ãƒ»ä¿®æ­£
            let canvas = document.getElementById('geometryCanvas');
            if (!canvas) {
                alert('âŒ Canvasè¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚HTMLãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            // ã‚µã‚¤ã‚ºä¿®æ­£
            if (canvas.clientWidth === 0 || canvas.clientHeight === 0) {
                canvas.style.width = '400px';
                canvas.style.height = '300px';
                console.log('ğŸ”§ Canvasè¡¨ç¤ºã‚µã‚¤ã‚ºã‚’ä¿®æ­£');
            }
            
            // å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ å†åˆæœŸåŒ–
            if (!window.visualizer) {
                window.visualizer = new Simple2DVisualizer('geometryCanvas');
            }
            
            // ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—ã«å¿œã˜ãŸè¡¨ç¤ºæ›´æ–°
            updateVisualizationForCurrentStep();
            
            alert('âœ… è‡ªå‹•ä¿®æ­£ã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚\nåŸºæœ¬æ©Ÿèƒ½ãŒæ­£å¸¸ã«å‹•ä½œã™ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚');
        }
        
        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿å®Œäº†æ™‚ã«åˆæœŸåŒ–
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeTutorial);
        } else {
            initializeTutorial();
        }
        
        console.log('ğŸ”§ çµ±åˆä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ èª­ã¿è¾¼ã¿å®Œäº†');
    </script>
</body>
</html>
