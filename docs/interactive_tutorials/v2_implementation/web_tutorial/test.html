<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ğŸ”§ Poker MCP ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - å‹•ä½œãƒ†ã‚¹ãƒˆ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #b8daff; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ Poker MCP ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ« - å‹•ä½œãƒ†ã‚¹ãƒˆ</h1>
    
    <div class="test-section info">
        <h2>ğŸ“‹ ãƒ†ã‚¹ãƒˆé …ç›®</h2>
        <button onclick="testStepsJson()">steps.jsonèª­ã¿è¾¼ã¿ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testTutorialClass()">ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¯ãƒ©ã‚¹ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testVisualization()">å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="testPhysicsValidator()">ç‰©ç†æ¤œè¨¼ãƒ†ã‚¹ãƒˆ</button>
        <button onclick="runAllTests()">ğŸš€ å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ</button>
    </div>

    <div id="testResults"></div>

    <script src="physics-validator.js"></script>
    <script src="cross-section-visualizer.js"></script>
    <script src="tutorial.js"></script>
    
    <script>
        function logResult(title, success, message, details = '') {
            const resultsDiv = document.getElementById('testResults');
            const testDiv = document.createElement('div');
            testDiv.className = `test-section ${success ? 'success' : 'error'}`;
            testDiv.innerHTML = `
                <h3>${success ? 'âœ…' : 'âŒ'} ${title}</h3>
                <p><strong>çµæœ:</strong> ${message}</p>
                ${details ? `<pre>${details}</pre>` : ''}
            `;
            resultsDiv.appendChild(testDiv);
        }

        async function testStepsJson() {
            try {
                const response = await fetch('steps.json');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                
                if (!Array.isArray(data) || data.length === 0) {
                    throw new Error('steps.jsonã®å½¢å¼ãŒä¸æ­£ã§ã™ï¼ˆé…åˆ—ã§ãªã„ã‹ç©ºã§ã™ï¼‰');
                }
                
                // å„ã‚¹ãƒ†ãƒƒãƒ—ã®å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãƒã‚§ãƒƒã‚¯
                const requiredFields = ['step', 'title', 'template'];
                for (let i = 0; i < data.length; i++) {
                    const step = data[i];
                    for (const field of requiredFields) {
                        if (!step[field]) {
                            throw new Error(`Step ${i + 1} ã«å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ '${field}' ãŒã‚ã‚Šã¾ã›ã‚“`);
                        }
                    }
                    
                    // ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆãŒJSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹å¯èƒ½ã‹ãƒã‚§ãƒƒã‚¯
                    try {
                        JSON.parse(step.template);
                    } catch (e) {
                        throw new Error(`Step ${i + 1} ã®templateãŒç„¡åŠ¹ãªJSON: ${e.message}`);
                    }
                }
                
                logResult('steps.jsonèª­ã¿è¾¼ã¿', true, 
                    `${data.length}ã‚¹ãƒ†ãƒƒãƒ—ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ­£å¸¸ã«èª­ã¿è¾¼ã¿ã¾ã—ãŸ`,
                    `ã‚¹ãƒ†ãƒƒãƒ—: ${data.map(s => s.title).join(', ')}`
                );
                
            } catch (error) {
                logResult('steps.jsonèª­ã¿è¾¼ã¿', false, error.message);
            }
        }

        function testTutorialClass() {
            try {
                // ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof PokerMCPTutorial === 'undefined') {
                    throw new Error('PokerMCPTutorialã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                // å¿…è¦ãªãƒ¡ã‚½ãƒƒãƒ‰ã®å­˜åœ¨ç¢ºèª
                const requiredMethods = [
                    'initializeElements', 'loadTutorialData', 'updateStepContent', 
                    'resetCode', 'executeCode', 'validateJSON'
                ];
                
                const proto = PokerMCPTutorial.prototype;
                const missingMethods = requiredMethods.filter(method => typeof proto[method] !== 'function');
                
                if (missingMethods.length > 0) {
                    throw new Error(`å¿…é ˆãƒ¡ã‚½ãƒƒãƒ‰ãŒä¸è¶³: ${missingMethods.join(', ')}`);
                }
                
                logResult('ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¯ãƒ©ã‚¹', true, 
                    'PokerMCPTutorialã‚¯ãƒ©ã‚¹ã¯æ­£å¸¸ã«å®šç¾©ã•ã‚Œã¦ã„ã¾ã™',
                    `åˆ©ç”¨å¯èƒ½ãƒ¡ã‚½ãƒƒãƒ‰: ${requiredMethods.join(', ')}`
                );
                
            } catch (error) {
                logResult('ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¯ãƒ©ã‚¹', false, error.message);
            }
        }

        function testVisualization() {
            try {
                // ã‚­ãƒ£ãƒ³ãƒã‚¹è¦ç´ ã‚’ä½œæˆ
                const canvas = document.createElement('canvas');
                canvas.id = 'testCanvas';
                canvas.width = 400;
                canvas.height = 300;
                document.body.appendChild(canvas);
                
                // CrossSectionVisualizerã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–ãƒ†ã‚¹ãƒˆ
                if (typeof CrossSectionVisualizer === 'undefined') {
                    throw new Error('CrossSectionVisualizerã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const visualizer = new CrossSectionVisualizer('testCanvas');
                
                // åŸºæœ¬çš„ãªæç”»ãƒ¡ã‚½ãƒƒãƒ‰ãƒ†ã‚¹ãƒˆ
                visualizer.clear();
                visualizer.addSource('test_source', '0 0 0', 1e10, 'Co60');
                visualizer.addSphere('test_sphere', '0 0 0', 50, 'CONCRETE');
                visualizer.render();
                
                // ã‚­ãƒ£ãƒ³ãƒã‚¹ã‚’ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
                document.body.removeChild(canvas);
                
                logResult('å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ ', true, 
                    'CrossSectionVisualizerã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™',
                    'ç·šæºè¿½åŠ ã€çƒä½“è¿½åŠ ã€æç”»ãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸ'
                );
                
            } catch (error) {
                logResult('å¯è¦–åŒ–ã‚·ã‚¹ãƒ†ãƒ ', false, error.message);
            }
        }

        function testPhysicsValidator() {
            try {
                if (typeof PhysicsValidator === 'undefined') {
                    throw new Error('PhysicsValidatorã‚¯ãƒ©ã‚¹ãŒå®šç¾©ã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
                
                const validator = new PhysicsValidator();
                
                // ç·šæºå¼·åº¦æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
                const sourceValidation = validator.validateSourceStrength('Co60', 3.7e10);
                if (!sourceValidation || typeof sourceValidation.isValid === 'undefined') {
                    throw new Error('validateSourceStrengthãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ãªçµæœã‚’è¿”ã—ã¾ã›ã‚“');
                }
                
                // é®è”½åšã•æ¤œè¨¼ãƒ†ã‚¹ãƒˆ
                const shieldValidation = validator.validateShieldingThickness('CONCRETE', 50, 3.7e10, 'Co60');
                if (!shieldValidation || typeof shieldValidation.isValid === 'undefined') {
                    throw new Error('validateShieldingThicknessãƒ¡ã‚½ãƒƒãƒ‰ãŒæ­£å¸¸ãªçµæœã‚’è¿”ã—ã¾ã›ã‚“');
                }
                
                logResult('ç‰©ç†æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ', true, 
                    'PhysicsValidatorã¯æ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã™',
                    `Co60ç·šæºæ¤œè¨¼: ${sourceValidation.isValid ? 'å¦¥å½“' : 'ä¸é©åˆ‡'}\né®è”½åšã•æ¤œè¨¼: ${shieldValidation.isValid ? 'å¦¥å½“' : 'ä¸é©åˆ‡'}`
                );
                
            } catch (error) {
                logResult('ç‰©ç†æ¤œè¨¼ã‚·ã‚¹ãƒ†ãƒ ', false, error.message);
            }
        }

        async function runAllTests() {
            document.getElementById('testResults').innerHTML = '';
            
            console.log('ğŸš€ å…¨ãƒ†ã‚¹ãƒˆé–‹å§‹...');
            
            await testStepsJson();
            testTutorialClass();
            testVisualization();
            testPhysicsValidator();
            
            // çµ±åˆãƒ†ã‚¹ãƒˆ
            try {
                if (window.tutorial) {
                    logResult('çµ±åˆãƒ†ã‚¹ãƒˆ', true, 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ­£å¸¸ã«ä½œæˆã•ã‚Œã¦ã„ã¾ã™');
                } else {
                    logResult('çµ±åˆãƒ†ã‚¹ãƒˆ', false, 'ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã•ã‚Œã¦ã„ã¾ã›ã‚“');
                }
            } catch (error) {
                logResult('çµ±åˆãƒ†ã‚¹ãƒˆ', false, error.message);
            }
            
            console.log('âœ… å…¨ãƒ†ã‚¹ãƒˆå®Œäº†');
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«åŸºæœ¬ãƒã‚§ãƒƒã‚¯
        window.addEventListener('load', () => {
            setTimeout(() => {
                const basicInfo = {
                    tutorial: !!window.tutorial,
                    steps: window.tutorial?.tutorialSteps?.length || 0,
                    currentStep: window.tutorial?.currentStep || 0
                };
                
                console.log('ğŸ“Š åŸºæœ¬æƒ…å ±:', basicInfo);
                
                if (basicInfo.tutorial && basicInfo.steps > 0) {
                    logResult('åˆæœŸåŒ–ç¢ºèª', true, 
                        `ãƒãƒ¥ãƒ¼ãƒˆãƒªã‚¢ãƒ«ãŒæ­£å¸¸ã«åˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸ`,
                        `ã‚¹ãƒ†ãƒƒãƒ—æ•°: ${basicInfo.steps}, ç¾åœ¨ã®ã‚¹ãƒ†ãƒƒãƒ—: ${basicInfo.currentStep}`
                    );
                }
            }, 1000);
        });
    </script>
</body>
</html>