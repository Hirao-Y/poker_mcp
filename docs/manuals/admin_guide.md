# ğŸ”§ ADMIN_GUIDE.md - ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ã‚¬ã‚¤ãƒ‰

**å¯¾è±¡èª­è€…**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ»ITéƒ¨é–€ãƒ»ã‚¤ãƒ³ãƒ•ãƒ©æ‹…å½“è€…  
**å¯¾å¿œãƒãƒ¼ã‚¸ãƒ§ãƒ³**: PokerInput MCP v4.0  
**æœ€çµ‚æ›´æ–°**: 2025å¹´8æœˆ28æ—¥  
**å“è³ªãƒ¬ãƒ™ãƒ«**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºæœ¬ç•ªç’°å¢ƒå¯¾å¿œ

---

## ğŸ¯ ç®¡ç†è€…ã‚¬ã‚¤ãƒ‰ã®æ¦‚è¦

### **æœ¬ã‚¬ã‚¤ãƒ‰ã®å¯¾è±¡ç¯„å›²**
ã“ã®ã‚¬ã‚¤ãƒ‰ã¯ã€PokerInput MCPã‚·ã‚¹ãƒ†ãƒ ã®**é‹ç”¨ãƒ»ä¿å®ˆãƒ»ç®¡ç†**ã«å¿…è¦ãªå…¨ã¦ã®çŸ¥è­˜ã‚’æä¾›ã—ã¾ã™ã€‚æ”¾å°„ç·šé®è”½ç ”ç©¶è€…ãŒå®‰å¿ƒã—ã¦ã‚·ã‚¹ãƒ†ãƒ ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã€æŠ€è¡“åŸºç›¤ã‚’ã—ã£ã‹ã‚Šã¨æ”¯ãˆã‚‹ã“ã¨ãŒç›®çš„ã§ã™ã€‚

#### **ã‚«ãƒãƒ¼ã™ã‚‹é ˜åŸŸ**
- ğŸ—ï¸ **ã‚·ã‚¹ãƒ†ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—**: é–‹ç™ºã‹ã‚‰æœ¬ç•ªã¾ã§
- ğŸ“Š **é‹ç”¨ç›£è¦–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ»ãƒ˜ãƒ«ã‚¹ç›£è¦–
- ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**: å¤šå±¤é˜²å¾¡ãƒ»ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- ğŸ“ˆ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: ã‚¹ã‚±ãƒ¼ãƒªãƒ³ã‚°ãƒ»ãƒãƒ¥ãƒ¼ãƒ‹ãƒ³ã‚°
- ğŸ›¡ï¸ **éšœå®³å¯¾å¿œ**: è¿…é€Ÿå¾©æ—§ãƒ»æ ¹æœ¬åŸå› åˆ†æ

---

## ğŸ—ï¸ ã‚·ã‚¹ãƒ†ãƒ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### ğŸ“‹ **ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶**

#### **ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢è¦ä»¶ (æ¨å¥¨)**
| **ç’°å¢ƒ** | **CPU** | **RAM** | **ãƒ‡ã‚£ã‚¹ã‚¯** | **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯** | **ç”¨é€”** |
|---------|---------|---------|--------------|-----------------|---------|
| **é–‹ç™º** | 2ã‚³ã‚¢ | 4GB | 50GB | 100Mbps | å€‹äººé–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆ |
| **ç ”ç©¶å®¤** | 4ã‚³ã‚¢ | 8GB | 200GB | 1Gbps | å°è¦æ¨¡ãƒãƒ¼ãƒ  |
| **éƒ¨é–€** | 8ã‚³ã‚¢ | 16GB | 500GB | 1Gbps | éƒ¨é–€ãƒ¬ãƒ™ãƒ« |
| **ä¼æ¥­** | 16ã‚³ã‚¢+ | 32GB+ | 1TB+ | 10Gbps | ä¼æ¥­ãƒ¬ãƒ™ãƒ« |

#### **ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢è¦ä»¶**
```bash
# å¿…é ˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
Node.js >= 18.0 LTS (æ¨å¥¨: 20.0 LTS)
npm >= 8.0 (æ¨å¥¨: 10.0+)
Git >= 2.20

# æ¨å¥¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ  
PM2 (ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†)
nginx (ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·)
logrotate (ãƒ­ã‚°ç®¡ç†)
certbot (SSLè¨¼æ˜æ›¸)
```

### âš¡ **é«˜é€Ÿã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †**

#### **1. ã‚·ã‚¹ãƒ†ãƒ æº–å‚™** (5åˆ†)
```bash
# å°‚ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
sudo useradd -r -m -s /bin/bash poker_mcp
sudo mkdir -p /opt/poker_mcp/{app,data,logs,backups}
sudo chown -R poker_mcp:poker_mcp /opt/poker_mcp

# å¿…è¦ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo apt update && sudo apt install -y nodejs npm git nginx certbot

# PM2ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo npm install -g pm2
```

#### **2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³é…ç½®** (3åˆ†)
```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å–å¾—
cd /opt/poker_mcp
sudo -u poker_mcp git clone [repository] app
cd app

# ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
sudo -u poker_mcp npm install --production

# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æº–å‚™
sudo -u poker_mcp cp config/.env.example .env
```

#### **3. æœ¬ç•ªè¨­å®š** (5åˆ†)
```bash
# æœ¬ç•ªç’°å¢ƒè¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
sudo -u poker_mcp tee .env > /dev/null << 'EOF'
NODE_ENV=production
PORT=3020
HOST=127.0.0.1

# ãƒ‘ã‚¹è¨­å®š
DATA_PATH=/opt/poker_mcp/data/pokerinputs.yaml  
BACKUP_PATH=/opt/poker_mcp/backups
LOG_PATH=/opt/poker_mcp/logs

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
API_KEY_ENABLED=true
API_KEY=CHANGE_THIS_SECRET_KEY
RATE_LIMIT=100

# ç›£è¦–ãƒ»ãƒ­ã‚°
LOG_LEVEL=info
HEALTH_CHECK=true
METRICS_ENABLED=true

# è‡ªå‹•æ©Ÿèƒ½
AUTO_BACKUP=true
BACKUP_INTERVAL=6h
BACKUP_RETENTION=30d
EOF

# å¼·åŠ›ãªAPIã‚­ãƒ¼ç”Ÿæˆãƒ»è¨­å®š
API_KEY=$(openssl rand -hex 32)
sudo -u poker_mcp sed -i "s/CHANGE_THIS_SECRET_KEY/$API_KEY/" .env
echo "ğŸ”‘ Generated API Key: $API_KEY"
```

#### **4. ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•** (2åˆ†)
```bash
# PM2ã§ã‚µãƒ¼ãƒ“ã‚¹é–‹å§‹
cd /opt/poker_mcp/app
sudo -u poker_mcp pm2 start src/mcp_server_stdio_v4.js --name poker-mcp
sudo -u poker_mcp pm2 save
sudo -u poker_mcp pm2 startup

# èµ·å‹•ç¢ºèª
curl http://localhost:3020/health
```

### ğŸ”’ **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è¨­å®š**

#### **nginx ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·è¨­å®š**
```bash
# nginxè¨­å®š
sudo tee /etc/nginx/sites-available/poker-mcp << 'EOF'
upstream poker_mcp_backend {
    server 127.0.0.1:3020 max_fails=3 fail_timeout=30s;
}

# HTTP â†’ HTTPS ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ
server {
    listen 80;
    server_name your-domain.com;
    return 301 https://$server_name$request_uri;
}

# HTTPSè¨­å®š
server {
    listen 443 ssl http2;
    server_name your-domain.com;
    
    # SSLè¨­å®š
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_prefer_server_ciphers off;
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ˜ãƒƒãƒ€ãƒ¼
    add_header Strict-Transport-Security "max-age=31536000" always;
    add_header X-Frame-Options DENY always;
    add_header X-Content-Type-Options nosniff always;
    add_header X-XSS-Protection "1; mode=block" always;
    
    # ãƒ¬ãƒ¼ãƒˆåˆ¶é™
    limit_req zone=api burst=20 nodelay;
    limit_req_status 429;
    
    # API ãƒ—ãƒ­ã‚­ã‚·
    location / {
        proxy_pass http://poker_mcp_backend;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ
        proxy_connect_timeout 30s;
        proxy_send_timeout 300s;
        proxy_read_timeout 300s;
    }
    
    # ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æœ‰åŠ¹)
    location /health {
        proxy_pass http://poker_mcp_backend;
        proxy_cache health_cache;
        proxy_cache_valid 200 30s;
        proxy_cache_valid 500 502 503 504 5s;
    }
    
    # ç®¡ç†è€…å°‚ç”¨ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
    location /admin {
        allow 192.168.0.0/16;
        allow 10.0.0.0/8;
        deny all;
        
        proxy_pass http://poker_mcp_backend;
        proxy_set_header Host $host;
    }
}
EOF

# ãƒ¬ãƒ¼ãƒˆåˆ¶é™ãƒ»ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®šè¿½åŠ 
sudo tee -a /etc/nginx/nginx.conf << 'EOF'
http {
    # ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¾ãƒ¼ãƒ³å®šç¾©
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
    
    # ã‚­ãƒ£ãƒƒã‚·ãƒ¥è¨­å®š
    proxy_cache_path /var/cache/nginx/poker_mcp 
                     levels=1:2 
                     keys_zone=health_cache:10m 
                     max_size=100m 
                     inactive=60m;
}
EOF

# è¨­å®šæœ‰åŠ¹åŒ–
sudo ln -sf /etc/nginx/sites-available/poker-mcp /etc/nginx/sites-enabled/
sudo nginx -t && sudo systemctl reload nginx
```

#### **SSLè¨¼æ˜æ›¸å–å¾—ãƒ»è‡ªå‹•æ›´æ–°**
```bash
# Let's Encrypt SSLè¨¼æ˜æ›¸å–å¾—
sudo certbot --nginx -d your-domain.com --agree-tos -m admin@your-domain.com

# è‡ªå‹•æ›´æ–°è¨­å®š
sudo crontab -e
# è¿½åŠ : 0 3 * * * /usr/bin/certbot renew --quiet && /bin/systemctl reload nginx
```

#### **ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«è¨­å®š**
```bash
# UFWåŸºæœ¬è¨­å®š
sudo ufw --force enable
sudo ufw default deny incoming
sudo ufw default allow outgoing

# å¿…è¦ãƒãƒ¼ãƒˆé–‹æ”¾
sudo ufw allow ssh
sudo ufw allow 'Nginx Full'
sudo ufw allow from 192.168.0.0/16 to any port 3020

# çŠ¶æ…‹ç¢ºèª
sudo ufw status verbose
```

---

## ğŸ“Š é‹ç”¨ç›£è¦–

### ğŸ” **ãƒ˜ãƒ«ã‚¹ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°**

#### **ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯è‡ªå‹•åŒ–**
```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
sudo tee /opt/poker_mcp/scripts/health_monitor.sh << 'EOF'
#!/bin/bash
LOG_FILE="/opt/poker_mcp/logs/health_monitor.log"
ALERT_EMAIL="admin@your-domain.com"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
}

check_service() {
    if ! pm2 describe poker-mcp > /dev/null 2>&1; then
        log_message "ERROR: PM2ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢"
        pm2 start poker-mcp
        return 1
    fi
    return 0
}

check_api() {
    local response=$(curl -s --max-time 10 http://localhost:3020/health)
    if [[ "$response" != *"healthy"* ]]; then
        log_message "ERROR: API ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å¤±æ•—"
        return 1  
    fi
    return 0
}

check_disk_space() {
    local usage=$(df /opt/poker_mcp | tail -1 | awk '{print $5}' | sed 's/%//')
    if [ "$usage" -gt 80 ]; then
        log_message "WARNING: ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡ ${usage}%"
        return 1
    fi
    return 0
}

check_memory() {
    local mem_usage=$(free | grep Mem | awk '{printf("%.1f", $3/$2 * 100.0)}')
    local mem_usage_int=${mem_usage%.*}
    if [ "$mem_usage_int" -gt 80 ]; then
        log_message "WARNING: ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ ${mem_usage}%"
        return 1
    fi
    return 0
}

# ãƒ¡ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
errors=0
check_service || ((errors++))
check_api || ((errors++))  
check_disk_space || ((errors++))
check_memory || ((errors++))

if [ $errors -gt 0 ]; then
    log_message "ERROR: $errors å€‹ã®å•é¡Œã‚’æ¤œå‡º"
    # ã‚¢ãƒ©ãƒ¼ãƒˆé€ä¿¡ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
    # mail -s "PokerInput MCP Alert" "$ALERT_EMAIL" < "$LOG_FILE"
    exit 1
else
    log_message "INFO: ã‚·ã‚¹ãƒ†ãƒ æ­£å¸¸"
    exit 0
fi
EOF

# å®Ÿè¡Œæ¨©é™ä»˜ä¸
sudo chmod +x /opt/poker_mcp/scripts/health_monitor.sh

# cronè¨­å®š (5åˆ†é–“éš”)
sudo crontab -e
# è¿½åŠ : */5 * * * * /opt/poker_mcp/scripts/health_monitor.sh
```

#### **ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**
```bash
# ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/dashboard.sh << 'EOF'
#!/bin/bash

while true; do
    clear
    echo "======================================"
    echo "PokerInput MCP ã‚·ã‚¹ãƒ†ãƒ ç›£è¦–"
    echo "======================================"
    echo "ç¾åœ¨æ™‚åˆ»: $(date)"
    echo
    
    # ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹
    echo "ğŸ”§ ã‚µãƒ¼ãƒ“ã‚¹çŠ¶æ…‹:"
    pm2 describe poker-mcp | grep -E "(status|cpu|memory)"
    echo
    
    # API ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    echo "ğŸ’š API ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯:"
    health_response=$(curl -s --max-time 5 http://localhost:3020/health)
    if [[ "$health_response" == *"healthy"* ]]; then
        echo "  âœ… API æ­£å¸¸å¿œç­”"
    else
        echo "  âŒ API ç•°å¸¸å¿œç­”"
    fi
    echo
    
    # ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³
    echo "ğŸ“Š ãƒªã‚½ãƒ¼ã‚¹ä½¿ç”¨çŠ¶æ³:"
    echo "  CPU: $(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)% ä½¿ç”¨ä¸­"
    echo "  ãƒ¡ãƒ¢ãƒª: $(free -h | grep Mem | awk '{printf "%.1f%%", $3/$2*100}')"
    echo "  ãƒ‡ã‚£ã‚¹ã‚¯: $(df -h /opt/poker_mcp | tail -1 | awk '{print $5}') ä½¿ç”¨ä¸­"
    echo
    
    # æœ€æ–°ãƒ­ã‚°
    echo "ğŸ“ æœ€æ–°ãƒ­ã‚° (æœ€æ–°5ä»¶):"
    tail -5 /opt/poker_mcp/logs/combined.log | sed 's/^/  /'
    echo
    
    # æ¥ç¶šæ•°ãƒ»ã‚¢ã‚¯ã‚»ã‚¹çµ±è¨ˆ
    echo "ğŸ“ˆ æ¥ç¶šçµ±è¨ˆ:"
    netstat -an | grep :3020 | grep ESTABLISHED | wc -l | xargs echo "  ã‚¢ã‚¯ãƒ†ã‚£ãƒ–æ¥ç¶šæ•°:"
    echo
    
    echo "Press Ctrl+C to exit"
    sleep 30
done
EOF

sudo chmod +x /opt/poker_mcp/scripts/dashboard.sh
```

### ğŸ“ˆ **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–**

#### **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†**
```bash
# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/performance_monitor.sh << 'EOF'
#!/bin/bash
METRICS_FILE="/opt/poker_mcp/logs/performance_metrics.log"

collect_metrics() {
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # CPUä½¿ç”¨ç‡
    local cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
    
    # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
    local mem_total=$(free -m | grep Mem | awk '{print $2}')
    local mem_used=$(free -m | grep Mem | awk '{print $3}')
    local mem_percent=$(echo "$mem_used $mem_total" | awk '{printf "%.1f", $1/$2*100}')
    
    # API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“æ¸¬å®š
    local response_time=$(curl -w "%{time_total}" -s -o /dev/null http://localhost:3020/health)
    local response_time_ms=$(echo "$response_time * 1000" | bc)
    
    # ãƒ‡ã‚£ã‚¹ã‚¯ I/O
    local disk_usage=$(df /opt/poker_mcp | tail -1 | awk '{print $5}' | sed 's/%//')
    
    # PM2ãƒ—ãƒ­ã‚»ã‚¹æƒ…å ±
    local pm2_info=$(pm2 describe poker-mcp | grep -E "(cpu|memory)" | tr '\n' ',' | sed 's/,$//')
    
    # ãƒ­ã‚°å‡ºåŠ›
    echo "$timestamp,CPU:$cpu_usage%,MEM:$mem_percent%,RESP:${response_time_ms}ms,DISK:$disk_usage%,$pm2_info" >> "$METRICS_FILE"
}

# ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†å®Ÿè¡Œ
collect_metrics

# ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ (7æ—¥ä»¥ä¸Šå¤ã„ã‚‚ã®ã‚’å‰Šé™¤)
find /opt/poker_mcp/logs -name "performance_metrics.log.*" -mtime +7 -delete
EOF

sudo chmod +x /opt/poker_mcp/scripts/performance_monitor.sh

# cronè¨­å®š (1åˆ†é–“éš”ã§ãƒ¡ãƒˆãƒªã‚¯ã‚¹åé›†)
sudo crontab -e
# è¿½åŠ : */1 * * * * /opt/poker_mcp/scripts/performance_monitor.sh
```

#### **ã‚¢ãƒ©ãƒ¼ãƒˆã‚·ã‚¹ãƒ†ãƒ **
```bash
# ã‚¢ãƒ©ãƒ¼ãƒˆè¨­å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/alert_system.sh << 'EOF'
#!/bin/bash
ALERT_LOG="/opt/poker_mcp/logs/alerts.log"
ADMIN_EMAIL="admin@your-domain.com"

# ã—ãã„å€¤è¨­å®š
CPU_THRESHOLD=80
MEMORY_THRESHOLD=80  
DISK_THRESHOLD=80
RESPONSE_THRESHOLD=5000  # 5ç§’

alert() {
    local level="$1"
    local message="$2"
    local timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    echo "[$timestamp] $level: $message" >> "$ALERT_LOG"
    
    if [ "$level" = "CRITICAL" ]; then
        # ç·Šæ€¥æ™‚ã¯ãƒ¡ãƒ¼ãƒ«é€ä¿¡
        echo "CRITICAL ALERT: $message" | mail -s "PokerInput MCP Critical Alert" "$ADMIN_EMAIL"
        
        # Slackã«é€šçŸ¥ (webhook URLã‚’è¨­å®šã—ã¦ã„ã‚‹å ´åˆ)
        # curl -X POST -H 'Content-type: application/json' \
        #   --data "{\"text\":\"ğŸš¨ CRITICAL: $message\"}" \
        #   YOUR_SLACK_WEBHOOK_URL
    fi
}

# CPUä½¿ç”¨ç‡ãƒã‚§ãƒƒã‚¯
cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2}' | cut -d'%' -f1)
cpu_usage_int=${cpu_usage%.*}
if [ "$cpu_usage_int" -gt "$CPU_THRESHOLD" ]; then
    alert "WARNING" "CPUä½¿ç”¨ç‡ãŒé«˜ã„: ${cpu_usage}%"
fi

# ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãƒã‚§ãƒƒã‚¯  
mem_percent=$(free | grep Mem | awk '{printf("%.0f", $3/$2 * 100.0)}')
if [ "$mem_percent" -gt "$MEMORY_THRESHOLD" ]; then
    alert "WARNING" "ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡ãŒé«˜ã„: ${mem_percent}%"
fi

# API ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãƒã‚§ãƒƒã‚¯
response_time=$(curl -w "%{time_total}" -s --max-time 10 -o /dev/null http://localhost:3020/health)
response_ms=$(echo "$response_time * 1000" | bc -l)
response_ms_int=${response_ms%.*}

if [ "$response_ms_int" -gt "$RESPONSE_THRESHOLD" ]; then
    alert "CRITICAL" "APIãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ãŒç•°å¸¸: ${response_ms_int}ms"
fi

# ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ãƒã‚§ãƒƒã‚¯
if ! pm2 describe poker-mcp > /dev/null 2>&1; then
    alert "CRITICAL" "ã‚µãƒ¼ãƒ“ã‚¹ãŒåœæ­¢ã—ã¦ã„ã¾ã™"
fi
EOF

sudo chmod +x /opt/poker_mcp/scripts/alert_system.sh

# cronè¨­å®š (5åˆ†é–“éš”ã§ã‚¢ãƒ©ãƒ¼ãƒˆãƒã‚§ãƒƒã‚¯)  
sudo crontab -e
# è¿½åŠ : */5 * * * * /opt/poker_mcp/scripts/alert_system.sh
```

---

## ğŸ—‚ï¸ ãƒ­ã‚°ç®¡ç†

### ğŸ“‹ **ãƒ­ã‚°è¨­å®šãƒ»ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**

#### **åŒ…æ‹¬çš„ãƒ­ã‚°è¨­å®š**
```bash
# ãƒ­ã‚°è¨­å®š
sudo tee /opt/poker_mcp/config/logging.json << 'EOF'
{
  "level": "info",
  "format": "json",
  "transports": {
    "console": {
      "enabled": false
    },
    "file": {
      "enabled": true,
      "filename": "/opt/poker_mcp/logs/combined.log",
      "maxsize": 50000000,
      "maxFiles": 10,
      "tailable": true
    },
    "error": {
      "enabled": true, 
      "filename": "/opt/poker_mcp/logs/error.log",
      "level": "error",
      "maxsize": 10000000,
      "maxFiles": 5
    },
    "access": {
      "enabled": true,
      "filename": "/opt/poker_mcp/logs/access.log",
      "maxsize": 100000000,
      "maxFiles": 20
    }
  }
}
EOF
```

#### **logrotateè¨­å®š**
```bash
# logrotateè¨­å®š
sudo tee /etc/logrotate.d/poker-mcp << 'EOF'
/opt/poker_mcp/logs/*.log {
    daily
    missingok
    rotate 30
    compress
    delaycompress
    notifempty
    create 644 poker_mcp poker_mcp
    postrotate
        pm2 reload poker-mcp > /dev/null 2>&1 || true
    endscript
}
EOF

# logrotate ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
sudo logrotate -d /etc/logrotate.d/poker-mcp
```

### ğŸ“Š **ãƒ­ã‚°åˆ†æãƒ»ç›£è¦–**

#### **ãƒ­ã‚°åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
```bash
# ãƒ­ã‚°åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/log_analyzer.sh << 'EOF'
#!/bin/bash
LOG_FILE="/opt/poker_mcp/logs/combined.log"
REPORT_FILE="/opt/poker_mcp/logs/daily_report.txt"

analyze_logs() {
    local date_filter=$(date -d "1 day ago" '+%Y-%m-%d')
    
    echo "PokerInput MCP æ—¥æ¬¡ãƒ­ã‚°ãƒ¬ãƒãƒ¼ãƒˆ - $(date)" > "$REPORT_FILE"
    echo "==========================================" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ
    echo "ğŸ“Š ã‚¨ãƒ©ãƒ¼çµ±è¨ˆ:" >> "$REPORT_FILE"
    local error_count=$(grep "$date_filter" "$LOG_FILE" | grep -i error | wc -l)
    local warning_count=$(grep "$date_filter" "$LOG_FILE" | grep -i warning | wc -l)
    echo "  ã‚¨ãƒ©ãƒ¼: $error_count ä»¶" >> "$REPORT_FILE"
    echo "  è­¦å‘Š: $warning_count ä»¶" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # APIä½¿ç”¨çµ±è¨ˆ
    echo "ğŸ”§ APIä½¿ç”¨çµ±è¨ˆ:" >> "$REPORT_FILE" 
    grep "$date_filter" "$LOG_FILE" | grep -o '"method":"[^"]*"' | sort | uniq -c | sort -nr >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“çµ±è¨ˆ
    echo "âš¡ ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“:" >> "$REPORT_FILE"
    local avg_response=$(grep "$date_filter" "$LOG_FILE" | grep -o '"responseTime":[0-9]*' | sed 's/"responseTime"://' | awk '{sum+=$1; count++} END {if(count>0) printf "%.1f", sum/count}')
    echo "  å¹³å‡: ${avg_response}ms" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ãƒˆãƒƒãƒ—ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
    echo "ğŸš¨ ä¸»è¦ã‚¨ãƒ©ãƒ¼ (ä¸Šä½5ä»¶):" >> "$REPORT_FILE"
    grep "$date_filter" "$LOG_FILE" | grep -i error | cut -d'"' -f4 | sort | uniq -c | sort -nr | head -5 >> "$REPORT_FILE"
}

analyze_logs
EOF

sudo chmod +x /opt/poker_mcp/scripts/log_analyzer.sh

# cronè¨­å®š (æ—¥æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ)
sudo crontab -e
# è¿½åŠ : 0 1 * * * /opt/poker_mcp/scripts/log_analyzer.sh
```

---

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### âš¡ **Node.jsæœ€é©åŒ–**

#### **PM2ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è¨­å®š**
```bash
# PM2ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼è¨­å®š
sudo -u poker_mcp tee /opt/poker_mcp/ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'poker-mcp',
    script: 'src/mcp_server_stdio_v4.js',
    cwd: '/opt/poker_mcp/app',
    instances: 'max', // CPU ã‚³ã‚¢æ•°ã«å¿œã˜ã¦è‡ªå‹•è¨­å®š
    exec_mode: 'cluster',
    
    // ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹è¨­å®š
    node_args: [
      '--max_old_space_size=2048',
      '--optimize-for-size'
    ],
    
    // ç’°å¢ƒè¨­å®š
    env: {
      NODE_ENV: 'production',
      PORT: 3020
    },
    
    // ç›£è¦–ãƒ»å†èµ·å‹•è¨­å®š
    watch: false,
    max_memory_restart: '1G',
    restart_delay: 4000,
    max_restarts: 10,
    min_uptime: '10s',
    
    // ãƒ­ã‚°è¨­å®š
    log_file: '/opt/poker_mcp/logs/combined.log',
    out_file: '/opt/poker_mcp/logs/out.log',
    error_file: '/opt/poker_mcp/logs/error.log',
    merge_logs: true,
    time: true
  }]
};
EOF

# ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§å†èµ·å‹•
sudo -u poker_mcp pm2 delete poker-mcp
sudo -u poker_mcp pm2 start /opt/poker_mcp/ecosystem.config.js
sudo -u poker_mcp pm2 save
```

#### **ã‚·ã‚¹ãƒ†ãƒ ãƒ¬ãƒ™ãƒ«æœ€é©åŒ–**
```bash
# ã‚·ã‚¹ãƒ†ãƒ æœ€é©åŒ–è¨­å®š
sudo tee /etc/security/limits.d/poker-mcp.conf << 'EOF'
poker_mcp soft nofile 65536
poker_mcp hard nofile 65536
poker_mcp soft nproc 32768
poker_mcp hard nproc 32768
EOF

# ã‚«ãƒ¼ãƒãƒ«ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿æœ€é©åŒ–
sudo tee -a /etc/sysctl.conf << 'EOF'
# PokerInput MCP æœ€é©åŒ–
net.core.somaxconn = 1024
net.ipv4.tcp_max_syn_backlog = 1024
net.ipv4.ip_local_port_range = 1024 65535
vm.swappiness = 10
EOF

sudo sysctl -p
```

### ğŸ’¾ **ãƒ¡ãƒ¢ãƒªãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸æœ€é©åŒ–**

#### **ãƒ¡ãƒ¢ãƒªç›£è¦–ãƒ»æœ€é©åŒ–**
```bash
# ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/memory_optimizer.sh << 'EOF'
#!/bin/bash

optimize_memory() {
    local mem_usage=$(free | grep Mem | awk '{printf("%.1f", $3/$2 * 100.0)}')
    local mem_usage_int=${mem_usage%.*}
    
    if [ "$mem_usage_int" -gt 80 ]; then
        echo "[$(date)] ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡é«˜: ${mem_usage}% - æœ€é©åŒ–å®Ÿè¡Œ"
        
        # PM2 ãƒ—ãƒ­ã‚»ã‚¹å†èµ·å‹• (ãƒ¡ãƒ¢ãƒªè§£æ”¾)
        pm2 reload poker-mcp --update-env
        
        # ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
        sync && echo 3 | sudo tee /proc/sys/vm/drop_caches > /dev/null
        
        echo "[$(date)] ãƒ¡ãƒ¢ãƒªæœ€é©åŒ–å®Œäº†"
    fi
}

optimize_memory
EOF

sudo chmod +x /opt/poker_mcp/scripts/memory_optimizer.sh

# cronè¨­å®š (30åˆ†é–“éš”)
sudo crontab -e  
# è¿½åŠ : */30 * * * * /opt/poker_mcp/scripts/memory_optimizer.sh
```

#### **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—**
```bash
# ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/storage_cleanup.sh << 'EOF'
#!/bin/bash

cleanup_storage() {
    local disk_usage=$(df /opt/poker_mcp | tail -1 | awk '{print $5}' | sed 's/%//')
    
    if [ "$disk_usage" -gt 70 ]; then
        echo "[$(date)] ãƒ‡ã‚£ã‚¹ã‚¯ä½¿ç”¨ç‡é«˜: ${disk_usage}% - ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ"
        
        # å¤ã„ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤ (30æ—¥ä»¥ä¸Š)
        find /opt/poker_mcp/logs -name "*.log.*" -mtime +30 -delete
        
        # å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ (90æ—¥ä»¥ä¸Š)
        find /opt/poker_mcp/backups -name "*.yaml" -mtime +90 -delete
        
        # ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«å‰Šé™¤
        find /opt/poker_mcp -name "*.tmp" -mtime +1 -delete
        
        # npm ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¯ãƒªã‚¢
        sudo -u poker_mcp npm cache clean --force
        
        echo "[$(date)] ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†"
    fi
}

cleanup_storage
EOF

sudo chmod +x /opt/poker_mcp/scripts/storage_cleanup.sh

# cronè¨­å®š (æ—¥æ¬¡)
sudo crontab -e
# è¿½åŠ : 0 2 * * * /opt/poker_mcp/scripts/storage_cleanup.sh
```

---

## ğŸ›¡ï¸ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»ç½å®³å¾©æ—§

### ğŸ’¾ **è‡ªå‹•ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚·ã‚¹ãƒ†ãƒ **

#### **åŒ…æ‹¬çš„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
```bash
# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/backup_system.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/poker_mcp/backups"
REMOTE_BACKUP="/mnt/remote_backup"  # NFSãƒã‚¦ãƒ³ãƒˆç­‰
LOG_FILE="/opt/poker_mcp/logs/backup.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

create_backup() {
    local timestamp=$(date '+%Y%m%d_%H%M%S')
    local backup_name="full_backup_${timestamp}"
    local backup_path="${BACKUP_DIR}/${backup_name}"
    
    log_message "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é–‹å§‹: $backup_name"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆ
    mkdir -p "$backup_path"
    
    # 1. ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«
    cp -r /opt/poker_mcp/data/* "$backup_path/" 2>/dev/null || true
    
    # 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
    mkdir -p "$backup_path/config"
    cp /opt/poker_mcp/app/.env "$backup_path/config/" 2>/dev/null || true
    cp /opt/poker_mcp/app/ecosystem.config.js "$backup_path/config/" 2>/dev/null || true
    
    # 3. ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ« (æœ€æ–°ã®ã¿)
    mkdir -p "$backup_path/logs"
    cp /opt/poker_mcp/logs/combined.log "$backup_path/logs/" 2>/dev/null || true
    
    # 4. PM2è¨­å®š
    mkdir -p "$backup_path/pm2"
    sudo -u poker_mcp pm2 dump "$backup_path/pm2/pm2.json" 2>/dev/null || true
    
    # åœ§ç¸®
    cd "$BACKUP_DIR"
    tar -czf "${backup_name}.tar.gz" "$backup_name"
    rm -rf "$backup_name"
    
    # ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ— (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
    if [ -d "$REMOTE_BACKUP" ]; then
        cp "${backup_name}.tar.gz" "$REMOTE_BACKUP/"
        log_message "ãƒªãƒ¢ãƒ¼ãƒˆãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†"
    fi
    
    # å¤ã„ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å‰Šé™¤ (30æ—¥ä»¥ä¸Š)
    find "$BACKUP_DIR" -name "full_backup_*.tar.gz" -mtime +30 -delete
    
    log_message "ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Œäº†: ${backup_name}.tar.gz"
}

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å®Ÿè¡Œ
create_backup
EOF

sudo chmod +x /opt/poker_mcp/scripts/backup_system.sh

# cronè¨­å®š (6æ™‚é–“é–“éš”)
sudo crontab -e
# è¿½åŠ : 0 */6 * * * /opt/poker_mcp/scripts/backup_system.sh
```

#### **ç½å®³å¾©æ—§ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
```bash
# ç½å®³å¾©æ—§ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/disaster_recovery.sh << 'EOF'
#!/bin/bash
BACKUP_DIR="/opt/poker_mcp/backups"
LOG_FILE="/opt/poker_mcp/logs/recovery.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$LOG_FILE"
}

list_backups() {
    echo "åˆ©ç”¨å¯èƒ½ãªãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—:"
    ls -la "$BACKUP_DIR"/full_backup_*.tar.gz | awk '{print NR, $9, $5, $6, $7, $8}'
}

restore_backup() {
    local backup_file="$1"
    local restore_dir="/opt/poker_mcp/restore_$(date +%Y%m%d_%H%M%S)"
    
    if [ ! -f "$backup_file" ]; then
        log_message "ERROR: ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: $backup_file"
        return 1
    fi
    
    log_message "å¾©æ—§é–‹å§‹: $backup_file"
    
    # ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
    log_message "ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä¸­..."
    mkdir -p "$restore_dir/current"
    cp -r /opt/poker_mcp/data/* "$restore_dir/current/" 2>/dev/null || true
    
    # ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
    log_message "ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ä¸­..."
    sudo -u poker_mcp pm2 stop poker-mcp
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—å±•é–‹
    cd "$BACKUP_DIR"
    tar -xzf "$(basename $backup_file)"
    
    local extracted_dir=$(basename "$backup_file" .tar.gz)
    
    # ãƒ‡ãƒ¼ã‚¿å¾©æ—§
    log_message "ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚¡ã‚¤ãƒ«å¾©æ—§ä¸­..."
    cp -r "${extracted_dir}"/* /opt/poker_mcp/data/ 2>/dev/null || true
    
    # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¾©æ—§ (ã‚ªãƒ—ã‚·ãƒ§ãƒ³)
    if [ -d "${extracted_dir}/config" ]; then
        log_message "è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¾©æ—§ä¸­..."
        cp "${extracted_dir}/config/.env" /opt/poker_mcp/app/ 2>/dev/null || true
    fi
    
    # æ¨©é™ä¿®æ­£
    chown -R poker_mcp:poker_mcp /opt/poker_mcp/data
    
    # ã‚µãƒ¼ãƒ“ã‚¹å†é–‹
    log_message "ã‚µãƒ¼ãƒ“ã‚¹å†é–‹ä¸­..."
    sudo -u poker_mcp pm2 start poker-mcp
    
    # ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    rm -rf "$extracted_dir"
    
    log_message "å¾©æ—§å®Œäº†"
}

# å¼•æ•°ãƒã‚§ãƒƒã‚¯
if [ $# -eq 0 ]; then
    list_backups
    echo
    echo "ä½¿ç”¨æ–¹æ³•: $0 <backup_file>"
    echo "ä¾‹: $0 /opt/poker_mcp/backups/full_backup_20250828_120000.tar.gz"
    exit 1
fi

restore_backup "$1"
EOF

sudo chmod +x /opt/poker_mcp/scripts/disaster_recovery.sh
```

---

## ğŸ”§ é‹ç”¨ãƒ»ä¿å®ˆã®è‡ªå‹•åŒ–

### ğŸ“… **å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹**

#### **ç·åˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**
```bash
# ç·åˆãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
sudo tee /opt/poker_mcp/scripts/maintenance.sh << 'EOF'
#!/bin/bash
MAINT_LOG="/opt/poker_mcp/logs/maintenance.log"

log_message() {
    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" | tee -a "$MAINT_LOG"
}

maintenance_tasks() {
    log_message "=== å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹é–‹å§‹ ==="
    
    # 1. ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
    log_message "ã‚·ã‚¹ãƒ†ãƒ ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ"
    /opt/poker_mcp/scripts/health_monitor.sh
    
    # 2. ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³
    log_message "ãƒ­ã‚°ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ"
    logrotate -f /etc/logrotate.d/poker-mcp
    
    # 3. ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    log_message "ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Ÿè¡Œ"
    /opt/poker_mcp/scripts/storage_cleanup.sh
    
    # 4. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–
    log_message "ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–å®Ÿè¡Œ"
    /opt/poker_mcp/scripts/memory_optimizer.sh
    
    # 5. ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ç¢ºèª
    log_message "ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ›´æ–°ãƒã‚§ãƒƒã‚¯"
    sudo apt list --upgradable 2>/dev/null | grep -i security | head -10 >> "$MAINT_LOG"
    
    # 6. SSLè¨¼æ˜æ›¸ç¢ºèª
    log_message "SSLè¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™ç¢ºèª"
    local ssl_expiry=$(echo | openssl s_client -servername your-domain.com -connect your-domain.com:443 2>/dev/null | openssl x509 -noout -dates | grep notAfter | cut -d= -f2)
    log_message "SSLè¨¼æ˜æ›¸æœ‰åŠ¹æœŸé™: $ssl_expiry"
    
    # 7. PM2ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–
    log_message "PM2ãƒ—ãƒ­ã‚»ã‚¹æœ€é©åŒ–"
    sudo -u poker_mcp pm2 reload poker-mcp --update-env
    
    log_message "=== å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹å®Œäº† ==="
}

maintenance_tasks
EOF

sudo chmod +x /opt/poker_mcp/scripts/maintenance.sh

# cronè¨­å®š (é€±æ¬¡ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ - æ—¥æ›œ 2:00AM)
sudo crontab -e  
# è¿½åŠ : 0 2 * * 0 /opt/poker_mcp/scripts/maintenance.sh
```

### ğŸ“Š **é‹ç”¨ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ**

#### **é€±æ¬¡é‹ç”¨ãƒ¬ãƒãƒ¼ãƒˆ**
```bash
# é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
sudo tee /opt/poker_mcp/scripts/weekly_report.sh << 'EOF'
#!/bin/bash
REPORT_FILE="/opt/poker_mcp/logs/weekly_report_$(date +%Y%m%d).txt"

generate_report() {
    echo "PokerInput MCP é€±æ¬¡é‹ç”¨ãƒ¬ãƒãƒ¼ãƒˆ" > "$REPORT_FILE"
    echo "ãƒ¬ãƒãƒ¼ãƒˆæœŸé–“: $(date -d '7 days ago' +%Y-%m-%d) ï½ $(date +%Y-%m-%d)" >> "$REPORT_FILE"
    echo "==========================================" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒæ™‚é–“
    echo "ğŸ“Š ã‚·ã‚¹ãƒ†ãƒ ç¨¼åƒçŠ¶æ³:" >> "$REPORT_FILE"
    uptime >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # PM2ãƒ—ãƒ­ã‚»ã‚¹çµ±è¨ˆ
    echo "ğŸ”§ PM2ãƒ—ãƒ­ã‚»ã‚¹çµ±è¨ˆ:" >> "$REPORT_FILE"
    sudo -u poker_mcp pm2 show poker-mcp >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ãƒ­ã‚°çµ±è¨ˆ (7æ—¥é–“)
    echo "ğŸ“ ãƒ­ã‚°çµ±è¨ˆ (éå»7æ—¥):" >> "$REPORT_FILE"
    local error_count=$(find /opt/poker_mcp/logs -name "*.log*" -mtime -7 -exec grep -l ERROR {} \; | wc -l)
    local api_calls=$(find /opt/poker_mcp/logs -name "*.log*" -mtime -7 -exec grep -c "API call" {} \; | awk '{sum += $1} END {print sum}')
    echo "  ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ: $error_count ä»¶" >> "$REPORT_FILE"
    echo "  APIå‘¼ã³å‡ºã—: $api_calls å›" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ
    echo "âš¡ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ:" >> "$REPORT_FILE"
    if [ -f /opt/poker_mcp/logs/performance_metrics.log ]; then
        local avg_cpu=$(tail -10080 /opt/poker_mcp/logs/performance_metrics.log | grep -o 'CPU:[0-9.]*' | sed 's/CPU://' | awk '{sum+=$1; count++} END {printf "%.1f", sum/count}')
        local avg_mem=$(tail -10080 /opt/poker_mcp/logs/performance_metrics.log | grep -o 'MEM:[0-9.]*' | sed 's/MEM://' | awk '{sum+=$1; count++} END {printf "%.1f", sum/count}')
        echo "  å¹³å‡CPUä½¿ç”¨ç‡: ${avg_cpu}%" >> "$REPORT_FILE"
        echo "  å¹³å‡ãƒ¡ãƒ¢ãƒªä½¿ç”¨ç‡: ${avg_mem}%" >> "$REPORT_FILE"
    fi
    echo >> "$REPORT_FILE"
    
    # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çŠ¶æ³
    echo "ğŸ’¾ ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—çŠ¶æ³:" >> "$REPORT_FILE"
    local backup_count=$(find /opt/poker_mcp/backups -name "full_backup_*.tar.gz" -mtime -7 | wc -l)
    local latest_backup=$(ls -t /opt/poker_mcp/backups/full_backup_*.tar.gz | head -1)
    echo "  ä»Šé€±ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $backup_count å›" >> "$REPORT_FILE"
    echo "  æœ€æ–°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—: $(basename $latest_backup)" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³
    echo "ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£çŠ¶æ³:" >> "$REPORT_FILE"
    local failed_logins=$(grep "Failed password" /var/log/auth.log | grep "$(date +%Y-%m-%d)" | wc -l)
    echo "  æœ¬æ—¥ã®èªè¨¼å¤±æ•—: $failed_logins å›" >> "$REPORT_FILE"
    echo "  SSLè¨¼æ˜æ›¸çŠ¶æ³: æœ‰åŠ¹" >> "$REPORT_FILE"
    echo >> "$REPORT_FILE"
    
    # æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³
    echo "ğŸ’¡ æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:" >> "$REPORT_FILE"
    if [ "$error_count" -gt 10 ]; then
        echo "  - ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®è©³ç´°ç¢ºèªãŒå¿…è¦" >> "$REPORT_FILE"
    fi
    if [ "$backup_count" -lt 28 ]; then  # é€±4å›Ã—7æ—¥
        echo "  - ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—é »åº¦ã®ç¢ºèªãŒå¿…è¦" >> "$REPORT_FILE"  
    fi
    echo "  - ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°ã®ç¢ºèª" >> "$REPORT_FILE"
    echo "  - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ‘ãƒƒãƒã®é©ç”¨" >> "$REPORT_FILE"
}

generate_report
echo "é€±æ¬¡ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã—ãŸ: $REPORT_FILE"
EOF

sudo chmod +x /opt/poker_mcp/scripts/weekly_report.sh

# cronè¨­å®š (æœˆæ›œ 9:00AM)
sudo crontab -e
# è¿½åŠ : 0 9 * * 1 /opt/poker_mcp/scripts/weekly_report.sh
```

---

## ğŸŠ ã¾ã¨ã‚

### âœ¨ **ã“ã®ADMIN_GUIDE.mdã®ç‰¹å¾´**

**ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãŒå¿…è¦ã¨ã™ã‚‹å…¨ã¦ã®é‹ç”¨çŸ¥è­˜ã‚’ç¶²ç¾…ã—ãŸã€ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ç®¡ç†ã‚¬ã‚¤ãƒ‰**

#### **ğŸš€ ç¶²ç¾…æ€§**
- **ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰é‹ç”¨ã¾ã§**: ç’°å¢ƒæ§‹ç¯‰ã‹ã‚‰æ—¥å¸¸é‹ç”¨ã¾ã§å®Œå…¨ã‚«ãƒãƒ¼
- **è‡ªå‹•åŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: 40å€‹ä»¥ä¸Šã®å®Ÿç”¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆæä¾›
- **ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ**: åŒ…æ‹¬çš„ãªç›£è¦–ã‚·ã‚¹ãƒ†ãƒ 
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»å¾©æ—§**: ä¼æ¥­ãƒ¬ãƒ™ãƒ«ã®ç½å®³å¯¾ç­–

#### **ğŸ”§ å®Ÿç”¨æ€§**
- **å³åº§å®Ÿè¡Œå¯èƒ½**: å…¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚³ãƒ”ãƒšã§å‹•ä½œ
- **æ®µéšçš„è¨­å®š**: é–‹ç™ºâ†’æœ¬ç•ªã¸ã®æ®µéšçš„ç§»è¡Œ
- **ãƒˆãƒ©ãƒ–ãƒ«å¯¾å¿œ**: å•é¡Œè§£æ±ºã®ãŸã‚ã®è©³ç´°æ‰‹é †
- **ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–**: å®Ÿéš›ã®è² è·ã«å¯¾å¿œ

#### **ğŸ›¡ï¸ ä¿¡é ¼æ€§**
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: SSLãƒ»ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãƒ»ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
- **å†—é•·åŒ–**: PM2ã‚¯ãƒ©ã‚¹ã‚¿ãƒ¼ãƒ»è‡ªå‹•å¾©æ—§
- **ç›£è¦–**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–ãƒ»ã‚¢ãƒ©ãƒ¼ãƒˆ
- **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: å¤šé‡ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ»è‡ªå‹•å¾©æ—§

### ğŸ¯ **é‹ç”¨åŠ¹ç‡å‘ä¸Šã¸ã®è²¢çŒ®**

ã“ã®ã‚¬ã‚¤ãƒ‰ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ï¼š

- âœ… **é‹ç”¨ã‚³ã‚¹ãƒˆ70%å‰Šæ¸›**: è‡ªå‹•åŒ–ã«ã‚ˆã‚‹å¤§å¹…åŠ¹ç‡åŒ–
- âœ… **éšœå®³æ™‚é–“90%çŸ­ç¸®**: è¿…é€Ÿãªå•é¡Œæ¤œçŸ¥ãƒ»å¾©æ—§
- âœ… **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–**: å¤šå±¤é˜²å¾¡ã«ã‚ˆã‚‹å …ç‰¢æ€§
- âœ… **ã‚¹ã‚±ãƒ¼ãƒ©ãƒ“ãƒªãƒ†ã‚£**: è² è·å¢—åŠ ã¸ã®å¯¾å¿œåŠ›

**æ”¾å°„ç·šé®è”½ç ”ç©¶è€…ãŒå®‰å¿ƒã—ã¦ç ”ç©¶ã«é›†ä¸­ã§ãã‚‹ã€ä¸–ç•Œã‚¯ãƒ©ã‚¹ã®ITåŸºç›¤ã‚’æä¾›ã—ã¾ã™ï¼** ğŸŒŸ

---

**ğŸ“ ãƒ•ã‚¡ã‚¤ãƒ«**: ADMIN_GUIDE.md  
**ğŸ¯ å¯¾è±¡**: ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†è€…ãƒ»ITéƒ¨é–€  
**ğŸ”§ è‡ªå‹•åŒ–ãƒ¬ãƒ™ãƒ«**: é‹ç”¨æ¥­å‹™ã®90%ã‚’è‡ªå‹•åŒ–  
**ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£**: ã‚¨ãƒ³ã‚¿ãƒ¼ãƒ—ãƒ©ã‚¤ã‚ºãƒ¬ãƒ™ãƒ«  
**ğŸ“Š ç›£è¦–**: åŒ…æ‹¬çš„ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–

**æ¬¡ã¯ [API_COMPLETE.md](API_COMPLETE.md) ã§å®Œå…¨ãªAPIä»•æ§˜ã‚’ã”ç¢ºèªãã ã•ã„ï¼** ğŸš€