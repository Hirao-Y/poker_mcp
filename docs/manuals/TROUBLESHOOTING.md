# ⚠️ トラブルシューティング - Poker MCP

**対象**: 全ユーザー（問題解決時）  
**バージョン**: 1.0.0 MCP Edition  
**最終更新**: 2025年9月2日  
**使用方法**: Claude Desktop + MCP通信

---

## 🎯 このガイドの使い方

### 🆘 **緊急時対応設計**
- **症状別索引**: 起こった現象からすぐに解決法を見つける
- **段階的診断**: 簡単なチェックから高度な診断まで
- **即座実行**: Claude Desktopで直接実行可能な指示
- **予防策完備**: 問題を未然に防ぐための対策

### ⚡ **使用手順**
1. **症状から該当セクションを特定**
2. **記載された指示をClaude Desktopで実行**
3. **解決しない場合は次の段階へ進む**
4. **解決後は予防策を実施**

---

## 🚨 第1章: 緊急度別問題分類

### 🔴 **緊急度: 高（即座対応必要）**

#### **問題A1: Claude DesktopでMCPツールが全く認識されない**
```
症状:
- 「放射線遮蔽計算」と言っても無反応
- MCPツールが表示されない
- 「利用可能なツールがない」というメッセージ

即座対応:
「MCPサーバー接続の緊急診断を実行してください：
1. Claude Desktop設定ファイルの存在確認
2. poker-mcpサーバー設定の構文チェック
3. NPXによるサーバー起動テスト
4. Claude Desktopプロセスの完全再起動
5. 接続状態の再診断

各ステップの結果を詳細に報告してください。」

詳細診断:
1. 設定ファイルパス確認:
   - Windows: %APPDATA%\Claude\claude_desktop_config.json
   - macOS: ~/Library/Application Support/Claude/claude_desktop_config.json
   - Linux: ~/.config/claude/claude_desktop_config.json

2. 設定内容確認:
   {
     "mcpServers": {
       "poker-mcp": {
         "command": "npx",
         "args": ["poker-mcp"],
         "env": {}
       }
     }
   }

3. NPX動作確認:
   - ターミナルで `npx poker-mcp` を実行
   - エラーメッセージの確認
```

#### **問題A2: システムが完全に応答しない**
```
症状:
- 全ての指示に対してエラーまたは無反応
- 「システムエラー」の表示
- データアクセス不可

即座対応:
「システム緊急復旧を実行してください：
1. 現在のプロセス状態確認
2. 最新バックアップの特定
3. データ整合性の緊急チェック
4. 最小限構成での復旧試行
5. 基本動作の確認テスト

復旧の各段階で状況を報告してください。」
```

#### **問題A3: 重要データの消失・破損**
```
症状:
- 作業中のモデルデータが消失
- YAMLファイルの読み込み不可
- 「ファイルが見つからない」エラー

即座対応:
「データ緊急復旧を実行してください：
1. 利用可能なバックアップの全確認
2. 最新の健全バックアップの特定
3. データ差分の確認と影響範囲評価
4. 段階的復旧の実行
5. 復旧データの整合性確認

データ損失の範囲と復旧状況を詳細に報告してください。」
```

### 🟡 **緊急度: 中（1時間以内対応）**

#### **問題B1: 立体作成・材料設定でエラー頻発**
```
症状:
- 「球体を作成して」でエラー
- 材料設定が失敗する
- 「パラメータが無効」のメッセージ

段階的対応:
「立体・材料設定の診断を実行してください：

段階1: 基本動作確認
最小パラメータで動作テストを実行してください：
- 立体: SPH、中心(0,0,0)、半径1.0、名前test_sphere
- 材料: CONCRETE、密度2.3

段階2: エラー詳細分析
エラーメッセージの詳細を確認し、以下をチェック：
- パラメータの型（数値/文字列）
- 必須パラメータの不足
- 値の範囲（密度: 0.001-30.0等）

段階3: 段階的復旧
問題のないパラメータから順次追加してください。」
```

#### **問題B2: 計算実行が失敗する**
```
症状:
- POKER計算の実行指示でエラー
- 「計算に必要な条件が不足」
- 結果が取得できない

診断手順:
「計算実行の診断をお願いします：

必須要素チェック:
1. 立体の存在確認
2. 材料設定の完了確認
3. 線源配置の確認
4. 検出器配置の確認
5. データファイルの整合性確認

実行環境チェック:
1. YAMLファイルの構文確認
2. POKER実行環境の確認
3. 出力ディレクトリの権限確認
4. 計算負荷の適正性確認」
```

### 🟢 **緊急度: 低（時間に余裕がある時対応）**

#### **問題C1: 動作が遅い・効率が悪い**
```
症状:
- 応答時間が長い（>10秒）
- メモリ使用量が多い
- 計算に時間がかかりすぎる

最適化対応:
「パフォーマンス最適化を実行してください：

システム最適化:
1. 不要ファイルの清掃
2. メモリ使用量の最適化
3. バックアップ頻度の調整
4. 計算パラメータの最適化

計算効率化:
1. 線源分割数の最適化
2. 検出器配置の効率化
3. カットオフ率の調整
4. 対称性の活用」
```

---

## 🔍 第2章: 症状別詳細診断

### 💻 **Claude Desktop・MCP接続問題**

#### **症状: MCPサーバーが起動しない**
```
エラーパターンと対応:

パターン1: "poker-mcp not found"
対応指示:
「NPX環境の診断をお願いします：
1. Node.js バージョン確認（18.0以上必要）
2. NPX の動作確認
3. poker-mcpパッケージの存在確認
4. 必要に応じて依存関係の再インストール

$ node --version
$ npx --version
$ npx poker-mcp --help」

パターン2: "Permission denied"
対応指示:
「権限問題の解決をお願いします：
1. 実行権限の確認と設定
2. ディレクトリアクセス権限の確認
3. セキュリティソフトの干渉確認
4. 管理者権限での実行試行」

パターン3: "Module not found"
対応指示:
「依存関係の修復をお願いします：
1. node_modules の再構築
2. package.json の整合性確認
3. 個別パッケージの確認・再インストール
4. キャッシュのクリアと再試行

$ npm cache clean --force
$ npm install」
```

#### **症状: Claude Desktopが設定を認識しない**
```
段階的確認指示:
「Claude Desktop設定の段階的確認をお願いします：

段階1: 設定ファイル基本確認
1. 設定ファイルの存在確認
2. JSON構文の妥当性確認（JSON validator使用）
3. 文字エンコーディング確認（UTF-8）
4. ファイルサイズ・権限確認

段階2: 設定内容詳細確認
1. mcpServersセクションの存在確認
2. poker-mcpエントリの構文確認
3. commandとargsの正確性確認
4. パスの絶対/相対指定確認

段階3: Claude Desktop再起動
1. Claude Desktopの完全終了
2. プロセスの確実な停止確認
3. 設定ファイル保存の確認
4. Claude Desktopの再起動」
```

### ⚙️ **API・データ操作問題**

#### **症状: 立体作成でエラーが発生**
```
立体タイプ別診断:

SPH（球体）エラー診断:
「球体作成エラーの診断をお願いします：
必要パラメータ: name, type, center, radius

エラーパターン別対応:
1. "名前重複": 既存立体名との競合確認
2. "中心座標無効": 座標形式(x y z)の確認
3. "半径範囲外": 0.001-10000の範囲確認
4. "型不一致": パラメータの数値/文字列型確認

テスト用最小パラメータ:
{
  "name": "test_sph",
  "type": "SPH", 
  "center": "0 0 0",
  "radius": 1.0
}」

RCC（円柱）エラー診断:
「円柱作成エラーの診断をお願いします：
必要パラメータ: name, type, bottom_center, height_vector, radius

よくあるエラーと対応:
1. "高さベクトル無効": ゼロベクトルでないことを確認
2. "底面中心不正": 座標形式の確認
3. "半径不正": 正の値であることを確認
4. "パラメータ不足": 全必須パラメータの存在確認」

RPP（直方体）エラー診断:
「直方体作成エラーの診断をお願いします：
必要パラメータ: name, type, min, max

よくあるエラーと対応:
1. "最小>最大": min < max の各軸確認
2. "座標形式不正": "x y z" 形式の確認
3. "体積ゼロ": 各軸で異なる値の確認
4. "数値変換エラー": 数値として認識可能な形式確認」
```

#### **症状: 材料設定でエラーが発生**
```
材料エラー別診断:

「材料設定エラーの詳細診断をお願いします：

エラータイプ1: "立体が存在しない"
対応:
1. 対象立体名のスペルチェック
2. 立体作成の完了確認
3. 現在の立体リスト確認
4. 立体名の大文字・小文字確認

エラータイプ2: "材料名が無効"
対応:
1. 標準材料名の確認（CONCRETE, IRON, LEAD等）
2. 大文字・小文字の統一確認
3. スペル間違いの確認
4. サポート材料一覧の確認

エラータイプ3: "密度が範囲外"
対応:
1. 密度値の範囲確認（0.001-30.0 g/cm³）
2. VOIDに密度設定していないか確認
3. 数値形式の確認（文字列でない）
4. 単位の確認（g/cm³）

エラータイプ4: "VOID材料に密度設定"
対応:
1. VOID材料は密度指定不要
2. 密度パラメータを削除して再試行
3. 他の材料との混同確認」
```

### 📊 **計算・結果関連問題**

#### **症状: POKER計算が実行できない**
```
計算実行前診断チェックリスト:
「POKER計算診断を実行してください：

必須コンポーネントチェック:
□ 立体の存在（最低1個以上）
□ 材料設定の完了（立体への割り当て）
□ 線源の配置（最低1個以上）
□ 検出器の配置（最低1個以上）
□ 単位設定の確認
□ データファイルの整合性

システム環境チェック:
□ YAML構文の妥当性
□ ファイルアクセス権限
□ ディスク容量の充足
□ メモリ使用量の適正
□ poker_cui実行可能性

エラー別対応:
1. "入力ファイルエラー": YAML構文の確認と修正
2. "実行権限エラー": ファイル・ディレクトリ権限の確認
3. "メモリ不足": 計算負荷の軽減またはメモリ追加
4. "収束しない": パラメータ調整（カットオフ率等）」
```

#### **症状: 計算結果が異常**
```
結果妥当性診断:
「計算結果の妥当性診断をお願いします：

物理的妥当性チェック:
1. 距離減衰の確認
   - 線源から距離に応じた減衰（概ね1/r²）
   - 遮蔽なしでの距離減衰パターン
   
2. 遮蔽効果の確認
   - 遮蔽材料による減衰効果
   - 材料厚さに応じた指数減衰
   - 遮蔽材料の種類による効果差

3. エネルギー保存の確認
   - 全検出器での積分値の妥当性
   - 線源強度との整合性

数値的妥当性チェック:
1. 収束性の確認
   - 線源分割数依存性
   - 検出器分解能依存性
   - カットオフ率依存性

2. 統計的信頼性
   - 結果の有効桁数
   - 不確かさの評価
   - 再現性の確認」
```

---

## 🛡️ 第3章: 予防策・保守管理

### 💾 **データ保護・バックアップ管理**

#### **日常的なデータ保護**
```
定期保護作業指示:
「データ保護の定期メンテナンスをお願いします：

日次作業:
1. 自動バックアップの動作確認
   - 最新バックアップファイルの確認
   - バックアップサイズの妥当性確認
   - バックアップ時刻の確認

2. データ整合性の確認
   - 主要ファイルの存在確認
   - ファイルサイズの異常確認
   - アクセス権限の確認

週次作業:
1. バックアップからの復旧テスト
   - ランダムにバックアップを選択
   - 復旧処理の実行
   - 復旧データの動作確認

2. 長期保存データの整理
   - 古いバックアップの選別
   - 重要データの長期保存移行
   - 不要ファイルの削除」
```

#### **緊急時復旧計画**
```
復旧計画の準備指示:
「緊急時復旧計画を整備してください：

復旧優先度の設定:
1. 最重要: 進行中の研究データ
2. 重要: 完成済み計算モデル
3. 通常: 設定ファイル・履歴
4. 低優先: 一時ファイル・ログ

復旧手順の確立:
1. 被害状況の迅速評価
2. 利用可能バックアップの特定
3. 段階的復旧の実行
4. 復旧後の整合性確認
5. 原因分析と再発防止

復旧訓練の実施:
- 月次復旧シミュレーション
- 復旧時間の測定・改善
- 手順書の継続更新」
```

### 🔧 **システム保守・最適化**

#### **定期システム保守**
```
システム保守指示:
「定期システム保守を実行してください：

パフォーマンス監視:
1. 応答時間の測定・記録
   - 基本操作の応答時間
   - 計算実行時間
   - ファイルI/O時間

2. リソース使用量の監視
   - メモリ使用量の推移
   - ディスク使用量の確認
   - CPU負荷の監視

システム最適化:
1. 不要ファイルの定期削除
   - 一時ファイルの清掃
   - ログファイルのローテーション
   - キャッシュの最適化

2. 設定の見直し・調整
   - パフォーマンス設定の最適化
   - セキュリティ設定の確認
   - バックアップ設定の調整」
```

#### **品質管理・検証**
```
品質管理指示:
「計算品質の継続管理をお願いします：

精度検証の定期実行:
1. ベンチマーク計算の実行
   - 標準問題での精度確認
   - 解析解との比較
   - 他コードとの比較

2. 結果の妥当性確認
   - 物理的妥当性の自動チェック
   - 統計的信頼性の評価
   - 異常値の検出・報告

品質記録の管理:
1. 計算条件の体系的記録
2. 結果の品質評価記録
3. 問題・改善の履歴管理
4. 品質向上活動の記録」
```

---

## 🎯 第4章: 高度なトラブル対応

### 🔬 **複合問題の診断**

#### **複数要因による問題**
```
複合問題診断指示:
「複合的な問題の系統的診断をお願いします：

診断アプローチ:
1. 問題の分解・整理
   - 症状の詳細な記録
   - 発生タイミングの分析
   - 環境要因の確認
   - 操作履歴の確認

2. 要因の段階的特定
   - 単一要因での再現テスト
   - 要因の組み合わせテスト
   - 環境変更の影響テスト
   - 時間経過の影響テスト

3. 根本原因の特定
   - 直接原因と根本原因の分離
   - 他への影響範囲の評価
   - 再発可能性の評価」
```

#### **パフォーマンス劣化問題**
```
パフォーマンス診断指示:
「システムパフォーマンス劣化の詳細診断をお願いします：

段階的診断:
段階1: ベースライン性能の確認
- 新規環境での性能測定
- 標準的な操作での応答時間測定
- リソース使用量のベースライン確認

段階2: 劣化要因の特定
- メモリリーク等の長期実行問題
- ディスクフラグメンテーション
- ネットワーク遅延（該当する場合）
- プロセス競合・リソース不足

段階3: 最適化の実行
- 特定要因に対する対策実施
- 設定パラメータの調整
- システムリソースの最適化
- 性能改善の効果測定」
```

### 📋 **組織的問題対応**

#### **チーム環境での問題**
```
チーム問題解決指示:
「チーム環境での問題解決をお願いします：

環境統一化:
1. 各メンバーの環境確認
   - OSバージョン・設定の統一
   - Poker MCPバージョンの統一
   - 依存関係の統一

2. 作業手順の標準化
   - 命名規則の統一
   - ディレクトリ構造の標準化
   - バックアップ手順の統一

3. 知識・情報共有の促進
   - 問題・解決事例の共有
   - ベストプラクティスの蓄積
   - スキルレベルの均質化」
```

#### **大規模計算での問題**
```
大規模計算問題対応指示:
「大規模計算での問題解決をお願いします：

計算規模の最適化:
1. 計算負荷の分析・分割
   - 計算領域の効率的分割
   - 対称性の活用
   - 段階的詳細化

2. リソース管理の最適化
   - メモリ使用量の最適化
   - ディスクI/Oの最適化
   - 計算時間の短縮

3. 品質保証の強化
   - 大規模計算での精度確認
   - 結果の妥当性検証
   - 計算途中での品質チェック」
```

---

## 📞 第5章: エスカレーション・サポート体制

### 📋 **問題レベル別対応**

#### **レベル1: 基本操作問題**
```
自己解決範囲:
- 基本的な立体作成・材料設定エラー
- 一般的なパラメータ設定問題
- 単純な計算実行エラー
- 日常的な操作に関する疑問

対応方法:
1. このトラブルシューティングガイド参照
2. QUICK_REFERENCE.mdでの操作確認
3. ESSENTIAL_GUIDE.mdでの基本手順確認

解決指示例:
「基本操作でエラーが発生しています。
該当する操作の標準手順を確認し、
パラメータの設定内容をチェックしてください。」
```

#### **レベル2: 応用・システム問題**
```
中級サポート範囲:
- 複合立体・高度な材料設定問題
- パラメータスタディでの問題
- 計算結果の解釈・妥当性問題
- システム統合での問題

対応方法:
1. 専門マニュアルの参照
   - RESEARCH_WORKFLOWS.md（分野別問題）
   - INTEGRATION_GUIDE.md（統合問題）
   - PHYSICS_REFERENCE.md（物理的問題）

解決指示例:
「複合遮蔽設計で問題が発生しています。
分野別のワークフローを確認し、
物理的妥当性をチェックしてください。」
```

#### **レベル3: システム・緊急問題**
```
上級サポート範囲:
- システム起動・接続問題
- データ破損・復旧問題
- セキュリティ・権限問題
- 大規模システムでの問題

対応方法:
1. 技術マニュアルの詳細参照
   - ADMIN_GUIDE.md（システム管理）
   - API_COMPLETE.md（技術詳細）
2. 緊急復旧手順の実行
3. システム管理者への相談

解決指示例:
「システムレベルの重大な問題が発生しています。
緊急復旧手順を実行し、データの安全性を
最優先に対応してください。」
```

### 🆘 **緊急時連絡・対応**

#### **緊急事態の定義**
```
緊急事態の判定基準:
1. 重要データの消失・破損
2. システムの完全停止
3. セキュリティインシデント
4. 業務継続に重大な支障

緊急時対応手順:
「緊急事態対応を実行してください：

immediate対応（5分以内）:
1. 被害状況の迅速評価
2. 被害拡大防止処置
3. 重要データの緊急保護
4. 関係者への状況報告

短期対応（1時間以内）:
1. 詳細な被害調査
2. 復旧計画の策定
3. 復旧作業の実行
4. 暫定運用の確立

中期対応（24時間以内）:
1. 完全復旧の実行
2. 原因分析の実施
3. 再発防止策の実装
4. 業務正常化の確認」
```

---

## 🎯 まとめ: 問題解決の体系的アプローチ

### ✨ **効果的な問題解決のために**

#### **問題解決の基本プロセス**
1. **症状の正確な把握**: 何が・いつ・どこで・どのように
2. **原因の系統的調査**: 段階的な絞り込み
3. **対策の実行**: 適切な手順での解決
4. **効果の確認**: 解決の確実性確認
5. **再発防止**: 予防策の実装

#### **継続的改善**
このトラブルシューティングガイドは実際の問題解決経験に基づいて継続的に改善されます。新しい問題や効果的な解決法があれば、Claude Desktopで共有してください。

### 🚀 **安心して研究に集中**
適切な問題解決体制により、技術的トラブルに悩まされることなく、本来の放射線遮蔽研究に集中できる環境を実現しましょう。

**🎯 困った時は**: このガイドを参照し、段階的に問題を解決してください。

---

**📚 関連マニュアル**
- [ESSENTIAL_GUIDE.md](ESSENTIAL_GUIDE.md): 基本操作・15分スタート
- [QUICK_REFERENCE.md](QUICK_REFERENCE.md): 日常操作早見表
- [RESEARCH_WORKFLOWS.md](RESEARCH_WORKFLOWS.md): 分野別業務フロー
- [INTEGRATION_GUIDE.md](INTEGRATION_GUIDE.md): システム統合・自動化
- [ADMIN_GUIDE.md](ADMIN_GUIDE.md): システム管理・運用
