<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Poker MCP Interactive Guide - Level 1: Âü∫Á§é‰ΩìÈ®ì</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <style>
        :root {
            --primary-blue: #1e3a8a;
            --primary-green: #059669;
            --warning-orange: #d97706;
            --danger-red: #dc2626;
            --bg-light: #f8fafc;
            --bg-panel: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent-physics: #7c3aed;
            --accent-success: #10b981;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #e2e8f0 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .main-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-physics) 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-container {
            flex: 1;
            max-width: 400px;
            margin: 0 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: var(--accent-success);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .level-indicator {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 300px 1fr 320px;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 140px);
        }

        .instruction-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
        }

        .step-indicator {
            background: linear-gradient(135deg, var(--accent-physics), #9333ea);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .hint-box {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border: 1px solid #f59e0b;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.9rem;
        }

        .hint-box strong {
            color: var(--warning-orange);
        }

        .visualization-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        #threejs-container {
            width: 100%;
            height: 100%;
        }

        .control-overlay {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 0.5rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }

        .control-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
        }

        .parameter-section {
            margin-bottom: 2rem;
        }

        .parameter-section h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
        }

        .parameter-group {
            margin-bottom: 1.5rem;
        }

        .parameter-group label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .parameter-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .parameter-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .slider-container {
            margin: 0.5rem 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-physics));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 1rem 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
        }

        .results-display {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 1px solid var(--primary-green);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: rgba(255, 255, 255, 0.5);
            border-radius: 6px;
        }

        .result-label {
            font-weight: 600;
            color: var(--text-primary);
        }

        .result-value {
            font-weight: bold;
            color: var(--primary-blue);
        }

        .status {
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status.ok {
            background: var(--primary-green);
            color: white;
        }

        .status.warning {
            background: var(--warning-orange);
            color: white;
        }

        .status.danger {
            background: var(--danger-red);
            color: white;
        }

        .navigation-footer {
            background: var(--bg-panel);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .nav-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .nav-btn.secondary {
            background: #e5e7eb;
            color: var(--text-primary);
        }

        .nav-btn:hover {
            transform: translateY(-1px);
        }

        .animation-controls {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .play-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #047857;
            transform: scale(1.05);
        }

        .concept-explanation {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            border: 1px solid var(--accent-physics);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .physics-formula {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1rem;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            text-align: center;
            font-size: 1.1rem;
        }

        .hidden {
            display: none;
        }

        /* „Çπ„ÉÜ„ÉÉ„ÉóÂà•„Çπ„Çø„Ç§„É´ */
        .step-1-1 .visualization-panel { border: 3px solid var(--accent-physics); }
        .step-1-2 .control-panel { border: 3px solid var(--primary-green); }
        .step-1-3 .instruction-panel { border: 3px solid var(--warning-orange); }

        /* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 280px 1fr 300px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
            }
            
            .instruction-panel, .control-panel {
                height: auto;
                max-height: 300px;
            }
        }
    </style>
</head>
<body>
    <!-- „Éò„ÉÉ„ÉÄ„Éº -->
    <header class="main-header">
        <div class="logo">
            üõ°Ô∏è Poker MCP Interactive Guide
        </div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="main-progress" style="width: 0%"></div>
            </div>
            <div class="level-indicator">Level 1 - Âü∫Á§é‰ΩìÈ®ì (15ÂàÜÂÆå‰∫ÜÁõÆÊ®ô)</div>
        </div>
        <div class="current-step" id="current-step-display">Step 1/3</div>
    </header>

    <!-- „É°„Ç§„É≥„Ç≥„É≥„ÉÜ„É≥„ÉÑ -->
    <main class="main-content" id="main-content">
        <!-- Â∑¶„Éë„Éç„É´: Ë™¨Êòé„ÉªÊâãÈ†Ü -->
        <div class="instruction-panel">
            <div class="step-indicator" id="step-indicator">Step 1: ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„Å®„ÅØÔºü</div>
            <div id="instruction-content">
                <h2>üî¨ ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÂü∫Êú¨ÂéüÁêÜ</h2>
                <p>ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„Å®„ÅØ„ÄÅÊîæÂ∞ÑÁ∑ö„Å®Áâ©Ë≥™„ÅÆÁõ∏‰∫í‰ΩúÁî®„Å´„Çà„Çä<strong>ÊîæÂ∞ÑÁ∑öÂº∑Â∫¶„ÇíÊ∏õË°∞„Åï„Åõ„ÇãÁâ©ÁêÜÁèæË±°</strong>„Åß„Åô„ÄÇ</p>
                
                <div class="physics-formula">
                    I = I‚ÇÄ √ó e<sup>(-Œºt)</sup> √ó B(Œºt)
                </div>
                
                <div class="concept-explanation">
                    <strong>üßÆ Âü∫Êú¨Ê∏õË°∞Ê≥ïÂâá„ÅÆÊÑèÂë≥:</strong><br>
                    ‚Ä¢ <strong>I‚ÇÄ</strong>: ÂÖ•Â∞ÑÊîæÂ∞ÑÁ∑öÂº∑Â∫¶<br>
                    ‚Ä¢ <strong>I</strong>: ÈÄèÈÅéÊîæÂ∞ÑÁ∑öÂº∑Â∫¶<br>
                    ‚Ä¢ <strong>Œº</strong>: Á∑öÊ∏õË°∞‰øÇÊï∞<br>
                    ‚Ä¢ <strong>t</strong>: ÈÅÆËîΩÂéö„Åï<br>
                    ‚Ä¢ <strong>B</strong>: „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞
                </div>

                <div class="hint-box">
                    üí° <strong>Âè≥ÂÅ¥„ÅÆ3DÂèØË¶ñÂåñ</strong>„ÅßÂÆüÈöõ„ÅÆÈÅÆËîΩÂäπÊûú„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ<br>
                    Ëµ§„ÅÑÁêÉ„ÅåÁ∑öÊ∫ê„ÄÅÈùí„ÅÑ„Éñ„É≠„ÉÉ„ÇØ„ÅåÈÅÆËîΩÊùê„ÄÅÁ∑ë„ÅÆÁÇπ„ÅåÊ∏¨ÂÆöÁÇπ„Åß„Åô„ÄÇ
                </div>
            </div>
        </div>

        <!-- ‰∏≠Â§Æ: 3DÂèØË¶ñÂåñ„ÉªÊìç‰Ωú„Ç®„É™„Ç¢ -->
        <div class="visualization-panel">
            <div id="threejs-container"></div>
            <div class="control-overlay">
                <button class="control-btn" id="rotate-view" title="Ë¶ñÁÇπÂõûËª¢">üîÑ ÂõûËª¢</button>
                <button class="control-btn" id="zoom-fit" title="ÂÖ®‰ΩìË°®Á§∫">üîç ÂÖ®‰Ωì</button>
                <button class="control-btn" id="reset-view" title="„É™„Çª„ÉÉ„Éà">üè† „É™„Çª„ÉÉ„Éà</button>
            </div>
            <div class="animation-controls">
                <button class="play-btn" id="play-animation">‚ñ∂Ô∏è ÂãïÁîªÂÜçÁîü</button>
                <button class="play-btn" id="pause-animation" style="display: none;">‚è∏Ô∏è ‰∏ÄÊôÇÂÅúÊ≠¢</button>
            </div>
        </div>

        <!-- Âè≥„Éë„Éç„É´: „Ç≥„É≥„Éà„É≠„Éº„É´„ÉªÁµêÊûú -->
        <div class="control-panel">
            <div class="parameter-section">
                <h3>üîß ÈÅÆËîΩ„Éë„É©„É°„Éº„Çø</h3>
                
                <div class="parameter-group">
                    <label>ÈÅÆËîΩÊùêÊñô</label>
                    <select class="parameter-input" id="shield-material">
                        <option value="lead">Èâõ (Pb)</option>
                        <option value="steel">ÈãºÈâÑ (Fe)</option>
                        <option value="concrete" selected>„Ç≥„É≥„ÇØ„É™„Éº„Éà</option>
                        <option value="aluminum">„Ç¢„É´„Éü„Éã„Ç¶„É† (Al)</option>
                    </select>
                </div>

                <div class="parameter-group">
                    <label>Âéö„Åï (cm)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="thickness-slider" 
                               min="0" max="50" value="10" step="1">
                        <span class="slider-value" id="thickness-value">10 cm</span>
                    </div>
                </div>

                <div class="parameter-group">
                    <label>Ë∑ùÈõ¢ (cm)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="distance-slider" 
                               min="50" max="200" value="100" step="10">
                        <span class="slider-value" id="distance-value">100 cm</span>
                    </div>
                </div>

                <div class="parameter-group">
                    <label>Á∑öÊ∫êÊ¥ªÊÄßÂ∫¶ (Bq)</label>
                    <select class="parameter-input" id="source-activity">
                        <option value="3.7e10" selected>3.7√ó10¬π‚Å∞ (1 Ci)</option>
                        <option value="3.7e11">3.7√ó10¬π¬π (10 Ci)</option>
                        <option value="3.7e12">3.7√ó10¬π¬≤ (100 Ci)</option>
                    </select>
                </div>
            </div>

            <button class="primary-btn" id="calculate-btn">‚ö° Ë®àÁÆóÂÆüË°å</button>

            <div class="results-display" id="results-display" style="display: none;">
                <h4>üìä Ë®àÁÆóÁµêÊûú</h4>
                <div class="result-item">
                    <span class="result-label">Á∑öÈáèÁéá:</span>
                    <span class="result-value" id="dose-rate-result">-- ŒºSv/h</span>
                    <span class="status" id="safety-status">--</span>
                </div>
                
                <div class="result-item">
                    <span class="result-label">Ê∏õË°∞Áéá:</span>
                    <span class="result-value" id="attenuation-result">--</span>
                </div>

                <div class="result-item">
                    <span class="result-label">ÂÆâÂÖ®‰ΩôË£ï:</span>
                    <span class="result-value" id="safety-margin">--</span>
                </div>
            </div>
        </div>
    </main>

    <!-- „Éï„ÉÉ„Çø„Éº: „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥ -->
    <footer class="navigation-footer">
        <button class="nav-btn secondary" id="prev-step" disabled>‚Üê Ââç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó</button>
        <div style="display: flex; gap: 1rem;">
            <button class="nav-btn secondary" id="hint-btn">üí° „Éí„É≥„Éà</button>
            <button class="nav-btn secondary" id="restart-btn">üîÑ ÊúÄÂàù„Åã„Çâ</button>
        </div>
        <button class="nav-btn primary" id="next-step">Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó ‚Üí</button>
    </footer>

    <script>
        // „Ç∞„É≠„Éº„Éê„É´Â§âÊï∞
        let scene, camera, renderer, controls;
        let sourceGeometry, shieldGeometry, detectorGeometry;
        let radiationParticles = [];
        let animationId;
        let currentStep = 1;
        let isAnimationPlaying = false;

        // Áâ©ÁêÜÂÆöÊï∞„ÉªÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ
        const materialDatabase = {
            lead: { density: 11.34, muMass: 0.107, color: 0x696969, name: 'Èâõ' },
            steel: { density: 7.87, muMass: 0.0565, color: 0xb0c4de, name: 'ÈãºÈâÑ' },
            concrete: { density: 2.3, muMass: 0.0636, color: 0xd2b48c, name: '„Ç≥„É≥„ÇØ„É™„Éº„Éà' },
            aluminum: { density: 2.70, muMass: 0.0820, color: 0xc0c0c0, name: '„Ç¢„É´„Éü„Éã„Ç¶„É†' }
        };

        // Â≠¶ÁøíÈÄ≤Ë°åÁÆ°ÁêÜ
        class LearningProgressManager {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 3;
                this.completedActions = new Set();
                this.startTime = Date.now();
            }

            updateProgress() {
                const progress = (this.currentStep - 1) / this.totalSteps * 100;
                document.getElementById('main-progress').style.width = progress + '%';
                document.getElementById('current-step-display').textContent = `Step ${this.currentStep}/${this.totalSteps}`;
            }

            nextStep() {
                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.updateStepContent();
                    this.updateProgress();
                    this.trackAction('step_completed', this.currentStep - 1);
                } else {
                    this.completeLevel();
                }
            }

            updateStepContent() {
                const stepContents = {
                    1: {
                        title: 'Step 1: ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„Å®„ÅØÔºü',
                        content: `
                            <h2>üî¨ ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÂü∫Êú¨ÂéüÁêÜ</h2>
                            <p>ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„Å®„ÅØ„ÄÅÊîæÂ∞ÑÁ∑ö„Å®Áâ©Ë≥™„ÅÆÁõ∏‰∫í‰ΩúÁî®„Å´„Çà„Çä<strong>ÊîæÂ∞ÑÁ∑öÂº∑Â∫¶„ÇíÊ∏õË°∞„Åï„Åõ„ÇãÁâ©ÁêÜÁèæË±°</strong>„Åß„Åô„ÄÇ</p>
                            
                            <div class="physics-formula">
                                I = I‚ÇÄ √ó e<sup>(-Œºt)</sup> √ó B(Œºt)
                            </div>
                            
                            <div class="concept-explanation">
                                <strong>üßÆ Âü∫Êú¨Ê∏õË°∞Ê≥ïÂâá„ÅÆÊÑèÂë≥:</strong><br>
                                ‚Ä¢ <strong>I‚ÇÄ</strong>: ÂÖ•Â∞ÑÊîæÂ∞ÑÁ∑öÂº∑Â∫¶<br>
                                ‚Ä¢ <strong>I</strong>: ÈÄèÈÅéÊîæÂ∞ÑÁ∑öÂº∑Â∫¶<br>
                                ‚Ä¢ <strong>Œº</strong>: Á∑öÊ∏õË°∞‰øÇÊï∞<br>
                                ‚Ä¢ <strong>t</strong>: ÈÅÆËîΩÂéö„Åï<br>
                                ‚Ä¢ <strong>B</strong>: „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞
                            </div>

                            <div class="hint-box">
                                üí° <strong>Âè≥ÂÅ¥„ÅÆ3DÂèØË¶ñÂåñ</strong>„ÅßÂÆüÈöõ„ÅÆÈÅÆËîΩÂäπÊûú„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ<br>
                                Ëµ§„ÅÑÁêÉ„ÅåÁ∑öÊ∫ê„ÄÅÈùí„ÅÑ„Éñ„É≠„ÉÉ„ÇØ„ÅåÈÅÆËîΩÊùê„ÄÅÁ∑ë„ÅÆÁÇπ„ÅåÊ∏¨ÂÆöÁÇπ„Åß„Åô„ÄÇ
                            </div>
                        `
                    },
                    2: {
                        title: 'Step 2: ÊùêÊñô„Å´„Çà„ÇãÈÅï„ÅÑ„Çí‰ΩìÈ®ì',
                        content: `
                            <h2>üß™ ÊùêÊñôÁâπÊÄß„Å®ÈÅÆËîΩÂäπÊûú</h2>
                            <p>Áï∞„Å™„ÇãÊùêÊñô„ÅØ<strong>ÂéüÂ≠êÁï™Âè∑</strong>„Å®<strong>ÂØÜÂ∫¶</strong>„Å´„Çà„Çä„ÄÅÈÅÆËîΩÊÄßËÉΩ„ÅåÂ§ß„Åç„ÅèÂ§â„Çè„Çä„Åæ„Åô„ÄÇ</p>
                            
                            <div class="concept-explanation">
                                <strong>üìä ÊùêÊñôÊØîËºÉ (1 MeV„Ç¨„É≥„ÉûÁ∑ö):</strong><br>
                                ‚Ä¢ <strong>Èâõ</strong>: È´òÂØÜÂ∫¶„ÉªÈ´òÊÄßËÉΩ (Œº=0.77 cm‚Åª¬π)<br>
                                ‚Ä¢ <strong>ÈãºÈâÑ</strong>: ‰∏≠ÂØÜÂ∫¶„Éª„Éê„É©„É≥„ÇπÂûã<br>
                                ‚Ä¢ <strong>„Ç≥„É≥„ÇØ„É™„Éº„Éà</strong>: ‰Ωé„Ç≥„Çπ„Éà„ÉªÂ§ßÂûãÈÅÆËîΩÁî®<br>
                                ‚Ä¢ <strong>„Ç¢„É´„Éü„Éã„Ç¶„É†</strong>: ËªΩÈáè„Éª‰ΩéÊÄßËÉΩ
                            </div>

                            <div class="hint-box">
                                üí° <strong>Âè≥ÂÅ¥„ÅÆ„Éë„É©„É°„Éº„Çø</strong>„ÅßÊùêÊñô„ÇÑÂéö„Åï„ÇíÂ§âÊõ¥„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ<br>
                                „É™„Ç¢„É´„Çø„Ç§„É†„ÅßÈÅÆËîΩÂäπÊûú„ÅåÂ§âÂåñ„Åô„Çã„ÅÆ„Åå„Çè„Åã„Çä„Åæ„Åô„ÄÇ
                            </div>

                            <div class="physics-formula">
                                Œº = (Œº/œÅ) √ó œÅ
                            </div>
                            <p style="text-align: center; font-size: 0.9rem; color: #6b7280;">
                                Á∑öÊ∏õË°∞‰øÇÊï∞ = Ë≥™ÈáèÊ∏õË°∞‰øÇÊï∞ √ó ÂØÜÂ∫¶
                            </p>
                        `
                    },
                    3: {
                        title: 'Step 3: ÊúÄÂàù„ÅÆÈÅÆËîΩË®≠Ë®à',
                        content: `
                            <h2>üèóÔ∏è ÂÆüÈöõ„ÅÆÈÅÆËîΩË®≠Ë®à‰ΩìÈ®ì</h2>
                            <p><strong>ÁõÆÊ®ô</strong>: Á∑öÈáèÁéá„ÇíË¶èÂà∂Âü∫Ê∫ñÂÄ§ <strong>2.5 ŒºSv/h ‰ª•‰∏ã</strong> „Å´„Åô„ÇãÈÅÆËîΩ„ÇíË®≠Ë®à„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ</p>
                            
                            <div class="concept-explanation">
                                <strong>üéØ Ë®≠Ë®àÊâãÈ†Ü:</strong><br>
                                1. Á∑öÊ∫êÊù°‰ª∂„ÅÆÁ¢∫Ë™ç (Co-60, 1 Ci)<br>
                                2. Ê∏¨ÂÆöË∑ùÈõ¢„ÅÆË®≠ÂÆö (100 cm)<br>
                                3. ÊùêÊñô„ÉªÂéö„Åï„ÅÆÊúÄÈÅ©Âåñ<br>
                                4. Ë¶èÂà∂Âü∫Ê∫ñ„Å®„ÅÆÊØîËºÉÁ¢∫Ë™ç
                            </div>

                            <div class="hint-box">
                                üí° <strong>Ë®≠Ë®à„ÅÆ„Ç≥„ÉÑ</strong><br>
                                ‚Ä¢ Âéö„Åï„ÇíÂæê„ÄÖ„Å´Â¢ó„ÇÑ„Åó„Å¶Âü∫Ê∫ñÂÄ§‰ª•‰∏ã„Å´<br>
                                ‚Ä¢ ÊùêÊñô„Åî„Å®„ÅÆÁâπÊÄß„ÇíÊ¥ªÁî®<br>
                                ‚Ä¢ ÂÆâÂÖ®‰ΩôË£ï„ÇÇËÄÉÊÖÆ„Åó„Åæ„Åó„Çá„ÅÜ
                            </div>

                            <div class="physics-formula">
                                ÂÆâÂÖ®‰ΩôË£ï = (Âü∫Ê∫ñÂÄ§ - Ë®àÁÆóÂÄ§) / Âü∫Ê∫ñÂÄ§ √ó 100%
                            </div>
                        `
                    }
                };

                const stepData = stepContents[this.currentStep];
                document.getElementById('step-indicator').textContent = stepData.title;
                document.getElementById('instruction-content').innerHTML = stepData.content;

                // „Çπ„ÉÜ„ÉÉ„ÉóÂõ∫Êúâ„ÅÆCSS„ÇØ„É©„ÇπÈÅ©Áî®
                document.getElementById('main-content').className = `main-content step-1-${this.currentStep}`;
            }

            completeLevel() {
                const completionTime = (Date.now() - this.startTime) / 1000;
                alert(`üéâ Level 1 ÂÆå‰∫Ü„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ\n\nÂÆå‰∫ÜÊôÇÈñì: ${Math.round(completionTime)}Áßí\nÂÆüË°å„Åó„ÅüË®àÁÆó: ${this.completedActions.size}Âõû\n\nÊ¨°„ÅØ Level 2: ÂÆüÁî®Ë®≠Ë®à „Å´ÊåëÊà¶„Åó„Åæ„Åó„Çá„ÅÜÔºÅ`);
                
                // Â≠¶Áøí„Éá„Éº„Çø„ÅÆË®òÈå≤ÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØÈÄÅ‰ø°Ôºâ
                console.log('Learning completed:', {
                    level: 1,
                    completionTime: completionTime,
                    actions: Array.from(this.completedActions),
                    totalCalculations: this.completedActions.size
                });
            }

            trackAction(action, data) {
                this.completedActions.add(`${action}_${Date.now()}`);
                console.log('Action tracked:', action, data);
            }
        }

        // 3DÂèØË¶ñÂåñ„Ç∑„Çπ„ÉÜ„É†
        class Radiation3DVisualizer {
            constructor(container) {
                this.container = container;
                this.initializeScene();
                this.createObjects();
                this.animate();
                this.setupEventListeners();
            }

            initializeScene() {
                // „Ç∑„Éº„É≥‰ΩúÊàê
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf8fafc);

                // „Ç´„É°„É©Ë®≠ÂÆö
                camera = new THREE.PerspectiveCamera(75, this.container.clientWidth / this.container.clientHeight, 0.1, 1000);
                camera.position.set(5, 5, 8);
                camera.lookAt(0, 0, 0);

                // „É¨„É≥„ÉÄ„É©„ÉºË®≠ÂÆö
                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.container.appendChild(renderer.domElement);

                // „É©„Ç§„ÉÜ„Ç£„É≥„Ç∞
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(5, 5, 5);
                directionalLight.castShadow = true;
                scene.add(directionalLight);

                // Â∫ßÊ®ôËª∏„ÅÆË°®Á§∫
                const axesHelper = new THREE.AxesHelper(3);
                scene.add(axesHelper);

                // Á∞°Êòì„Ç≥„É≥„Éà„É≠„Éº„É´Ôºà„Éû„Ç¶„Çπ„Åß„ÅÆË¶ñÁÇπÂ§âÊõ¥Ôºâ
                this.setupMouseControls();
            }

            setupMouseControls() {
                let isMouseDown = false;
                let mouseX = 0, mouseY = 0;
                let targetRotationX = 0, targetRotationY = 0;
                let rotationX = 0, rotationY = 0;

                this.container.addEventListener('mousedown', (event) => {
                    isMouseDown = true;
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                this.container.addEventListener('mousemove', (event) => {
                    if (!isMouseDown) return;
                    
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    targetRotationY += deltaX * 0.01;
                    targetRotationX += deltaY * 0.01;
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                this.container.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });

                // „Çπ„É†„Éº„Ç∫„Å™ÂõûËª¢„Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥
                const updateRotation = () => {
                    rotationX += (targetRotationX - rotationX) * 0.05;
                    rotationY += (targetRotationY - rotationY) * 0.05;
                    
                    const radius = 10;
                    camera.position.x = radius * Math.sin(rotationY) * Math.cos(rotationX);
                    camera.position.y = radius * Math.sin(rotationX);
                    camera.position.z = radius * Math.cos(rotationY) * Math.cos(rotationX);
                    camera.lookAt(0, 0, 0);
                    
                    requestAnimationFrame(updateRotation);
                };
                updateRotation();
            }

            createObjects() {
                // Á∑öÊ∫ê (Ëµ§„ÅÑÁêÉ)
                const sourceGeom = new THREE.SphereGeometry(0.3, 32, 32);
                const sourceMat = new THREE.MeshLambertMaterial({ 
                    color: 0xff4444,
                    emissive: 0x220000
                });
                sourceGeometry = new THREE.Mesh(sourceGeom, sourceMat);
                sourceGeometry.position.set(-3, 0, 0);
                sourceGeometry.castShadow = true;
                scene.add(sourceGeometry);

                // ÈÅÆËîΩÊùê (ÂèØÂ§â„Çµ„Ç§„Ç∫„ÉªËâ≤)
                this.updateShield('concrete', 1.0);

                // Ê§úÂá∫Âô® (Á∑ë„ÅÆÁÇπ)
                const detectorGeom = new THREE.SphereGeometry(0.2, 16, 16);
                const detectorMat = new THREE.MeshLambertMaterial({ 
                    color: 0x44ff44,
                    emissive: 0x002200
                });
                detectorGeometry = new THREE.Mesh(detectorGeom, detectorMat);
                detectorGeometry.position.set(3, 0, 0);
                scene.add(detectorGeometry);

                // Ë∑ùÈõ¢„É©„Ç§„É≥
                this.createDistanceLine();

                // Â∫äÈù¢
                const floorGeometry = new THREE.PlaneGeometry(20, 20);
                const floorMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0xf0f0f0,
                    transparent: true,
                    opacity: 0.5
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -2;
                floor.receiveShadow = true;
                scene.add(floor);

                // „É©„Éô„É´‰ΩúÊàê
                this.createLabels();
            }

            createLabels() {
                // WebGL‰∏ä„Åß„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÅØË§áÈõë„Å™„ÅÆ„Åß„ÄÅCSS3D„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Åæ„Åü„ÅØ
                // „Ç≠„É£„É≥„Éê„Çπ„ÉÜ„ÇØ„Çπ„ÉÅ„É£„Çí‰ΩøÁî®„ÄÇ„Åì„Åì„Åß„ÅØÁ∞°Áï•Âåñ„Åó„Å¶ÁúÅÁï•
                console.log('Labels created (simplified)');
            }

            updateShield(material, thickness) {
                // Êó¢Â≠ò„ÅÆÈÅÆËîΩÊùêÂâäÈô§
                if (shieldGeometry) {
                    scene.remove(shieldGeometry);
                }

                if (thickness > 0) {
                    const materialData = materialDatabase[material];
                    const shieldGeom = new THREE.BoxGeometry(thickness, 2, 2);
                    const shieldMat = new THREE.MeshLambertMaterial({ 
                        color: materialData.color,
                        transparent: true,
                        opacity: 0.7
                    });
                    shieldGeometry = new THREE.Mesh(shieldGeom, shieldMat);
                    shieldGeometry.position.set(0, 0, 0);
                    shieldGeometry.castShadow = true;
                    shieldGeometry.receiveShadow = true;
                    scene.add(shieldGeometry);
                }
            }

            updateDetectorPosition(distance) {
                if (detectorGeometry) {
                    detectorGeometry.position.x = distance / 100 * 3; // „Çπ„Ç±„Éº„É´Ë™øÊï¥
                    this.createDistanceLine();
                }
            }

            createDistanceLine() {
                // Êó¢Â≠ò„ÅÆ„É©„Ç§„É≥„ÇíÂâäÈô§
                const existingLine = scene.getObjectByName('distanceLine');
                if (existingLine) scene.remove(existingLine);

                // Êñ∞„Åó„ÅÑ„É©„Ç§„É≥‰ΩúÊàê
                const points = [];
                points.push(sourceGeometry.position.clone());
                points.push(detectorGeometry.position.clone());

                const geometry = new THREE.BufferGeometry().setFromPoints(points);
                const material = new THREE.LineBasicMaterial({ 
                    color: 0x888888,
                    lineDashSize: 0.1,
                    gapSize: 0.1
                });
                const line = new THREE.Line(geometry, material);
                line.name = 'distanceLine';
                scene.add(line);
            }

            createRadiationAnimation() {
                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç∑„Çπ„ÉÜ„É†„ÅßÊîæÂ∞ÑÁ∑ö„ÇíË°®Áèæ
                const particleCount = 50;
                const particles = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                
                for (let i = 0; i < particleCount; i++) {
                    positions[i * 3] = sourceGeometry.position.x;
                    positions[i * 3 + 1] = sourceGeometry.position.y;
                    positions[i * 3 + 2] = sourceGeometry.position.z;
                }
                
                particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const particleMaterial = new THREE.PointsMaterial({
                    color: 0xff6666,
                    size: 0.1,
                    transparent: true,
                    opacity: 0.8
                });
                
                const particleSystem = new THREE.Points(particles, particleMaterial);
                scene.add(particleSystem);
                
                return particleSystem;
            }

            playRadiationAnimation() {
                if (isAnimationPlaying) return;
                
                isAnimationPlaying = true;
                const particles = this.createRadiationAnimation();
                
                // „Ç¢„Éã„É°„Éº„Ç∑„Éß„É≥„É´„Éº„Éó
                const animateParticles = () => {
                    if (!isAnimationPlaying) {
                        scene.remove(particles);
                        return;
                    }
                    
                    const positions = particles.geometry.attributes.position.array;
                    
                    for (let i = 0; i < positions.length; i += 3) {
                        // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„ÇíÁ∑öÊ∫ê„Åã„ÇâÊ§úÂá∫Âô®ÊñπÂêë„Å∏ÁßªÂãï
                        positions[i] += 0.1; // XÊñπÂêë
                        
                        // ÁØÑÂõ≤Â§ñ„Å´„Å™„Å£„Åü„Çâ„É™„Çª„ÉÉ„Éà
                        if (positions[i] > detectorGeometry.position.x) {
                            positions[i] = sourceGeometry.position.x;
                        }
                    }
                    
                    particles.geometry.attributes.position.needsUpdate = true;
                    
                    animationId = requestAnimationFrame(animateParticles);
                };
                
                animateParticles();
            }

            pauseRadiationAnimation() {
                isAnimationPlaying = false;
                if (animationId) {
                    cancelAnimationFrame(animationId);
                }
            }

            animate() {
                const render = () => {
                    requestAnimationFrame(render);
                    
                    // Á∑öÊ∫ê„ÇíÂæÆÁ¥∞„Å´ÂõûËª¢„Åï„Åõ„Çã
                    if (sourceGeometry) {
                        sourceGeometry.rotation.y += 0.01;
                    }
                    
                    renderer.render(scene, camera);
                };
                render();
            }

            setupEventListeners() {
                // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
                window.addEventListener('resize', () => {
                    camera.aspect = this.container.clientWidth / this.container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                });
            }
        }

        // Ë®àÁÆó„Ç®„É≥„Ç∏„É≥ÔºàÁ∞°Áï•ÁâàÔºâ
        class ShieldingCalculator {
            constructor() {
                this.safetyLimit = 2.5; // ŒºSv/h
            }

            calculate(material, thickness, distance, activity) {
                const materialData = materialDatabase[material];
                
                // Á∑öÊ∏õË°∞‰øÇÊï∞
                const mu = materialData.muMass * materialData.density;
                
                // Âü∫Êú¨Ê∏õË°∞
                const attenuation = Math.exp(-mu * thickness);
                
                // „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞ (Á∞°Áï•Âåñ)
                const buildup = 1 + (2.5 - 1) * mu * thickness * Math.exp(-mu * thickness);
                
                // Ë∑ùÈõ¢„ÅÆÈÄÜ‰∫å‰πóÂâá
                const geometricFactor = 1 / (4 * Math.PI * Math.pow(distance, 2));
                
                // „Ç¨„É≥„ÉûÁ∑öÂÆöÊï∞ (Co-60: 1.32 R¬∑cm¬≤/h¬∑mCi at 1cm)
                const gammaConstant = 1.32 * 10; // ŒºSv/hÊèõÁÆó
                
                // Á∑öÈáèÁéáË®àÁÆó
                const doseRate = (activity / 3.7e10) * gammaConstant * geometricFactor * attenuation * buildup;
                
                // ÁµêÊûú„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà
                return {
                    doseRate: Math.max(doseRate, 0.001), // ÊúÄÂ∞èÂÄ§Ë®≠ÂÆö
                    attenuation: attenuation,
                    buildup: buildup,
                    safetyStatus: doseRate <= this.safetyLimit,
                    safetyMargin: doseRate <= this.safetyLimit ? 
                        ((this.safetyLimit - doseRate) / this.safetyLimit * 100) : 0
                };
            }
        }

        // „É°„Ç§„É≥ÂàùÊúüÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            // „Ç∑„Çπ„ÉÜ„É†ÂàùÊúüÂåñ
            const progressManager = new LearningProgressManager();
            const calculator = new ShieldingCalculator();
            let visualizer;

            // 3DÂèØË¶ñÂåñÂàùÊúüÂåñ
            setTimeout(() => {
                const container = document.getElementById('threejs-container');
                visualizer = new Radiation3DVisualizer(container);
                
                // ÂàùÊúü„Éë„É©„É°„Éº„Çø„ÅÆÂèçÊò†
                updateVisualization();
            }, 100);

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„ÉºË®≠ÂÆö
            setupEventListeners();

            function setupEventListeners() {
                // „Éë„É©„É°„Éº„ÇøÂ§âÊõ¥„Ç§„Éô„É≥„Éà
                document.getElementById('shield-material').addEventListener('change', updateVisualization);
                document.getElementById('thickness-slider').addEventListener('input', function() {
                    document.getElementById('thickness-value').textContent = this.value + ' cm';
                    updateVisualization();
                });
                document.getElementById('distance-slider').addEventListener('input', function() {
                    document.getElementById('distance-value').textContent = this.value + ' cm';
                    updateVisualization();
                });

                // Ë®àÁÆóÂÆüË°å
                document.getElementById('calculate-btn').addEventListener('click', performCalculation);

                // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
                document.getElementById('next-step').addEventListener('click', () => {
                    progressManager.nextStep();
                });
                
                document.getElementById('prev-step').addEventListener('click', () => {
                    if (progressManager.currentStep > 1) {
                        progressManager.currentStep--;
                        progressManager.updateStepContent();
                        progressManager.updateProgress();
                    }
                });

                // 3DÂà∂Âæ°
                document.getElementById('play-animation').addEventListener('click', function() {
                    if (visualizer) {
                        visualizer.playRadiationAnimation();
                        this.style.display = 'none';
                        document.getElementById('pause-animation').style.display = 'block';
                    }
                });

                document.getElementById('pause-animation').addEventListener('click', function() {
                    if (visualizer) {
                        visualizer.pauseRadiationAnimation();
                        this.style.display = 'none';
                        document.getElementById('play-animation').style.display = 'block';
                    }
                });

                document.getElementById('reset-view').addEventListener('click', function() {
                    if (camera) {
                        camera.position.set(5, 5, 8);
                        camera.lookAt(0, 0, 0);
                    }
                });

                // „Éí„É≥„ÉàË°®Á§∫
                document.getElementById('hint-btn').addEventListener('click', showContextualHint);

                // „É™„Çπ„Çø„Éº„Éà
                document.getElementById('restart-btn').addEventListener('click', function() {
                    progressManager.currentStep = 1;
                    progressManager.updateStepContent();
                    progressManager.updateProgress();
                });
            }

            function updateVisualization() {
                if (!visualizer) return;

                const material = document.getElementById('shield-material').value;
                const thickness = parseFloat(document.getElementById('thickness-slider').value);
                const distance = parseFloat(document.getElementById('distance-slider').value);

                // 3DÊõ¥Êñ∞
                visualizer.updateShield(material, thickness / 10); // „Çπ„Ç±„Éº„É´Ë™øÊï¥
                visualizer.updateDetectorPosition(distance);

                // „É™„Ç¢„É´„Çø„Ç§„É†Ë®àÁÆóË°®Á§∫Ôºà„Ç™„Éó„Ç∑„Éß„É≥Ôºâ
                if (document.getElementById('results-display').style.display !== 'none') {
                    performCalculation();
                }
            }

            function performCalculation() {
                const material = document.getElementById('shield-material').value;
                const thickness = parseFloat(document.getElementById('thickness-slider').value);
                const distance = parseFloat(document.getElementById('distance-slider').value);
                const activity = parseFloat(document.getElementById('source-activity').value);

                // Ë®àÁÆóÂÆüË°å
                const results = calculator.calculate(material, thickness, distance, activity);

                // ÁµêÊûúË°®Á§∫
                displayResults(results);
                
                // Â≠¶ÁøíËøΩË∑°
                progressManager.trackAction('calculation_performed', {
                    material, thickness, distance, activity, results: results.doseRate
                });

                // ÁµêÊûú„Å´Âü∫„Å•„Åè„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ
                provideFeedback(results);
            }

            function displayResults(results) {
                const resultsPanel = document.getElementById('results-display');
                resultsPanel.style.display = 'block';

                // Á∑öÈáèÁéá
                document.getElementById('dose-rate-result').textContent = 
                    results.doseRate.toFixed(2) + ' ŒºSv/h';

                // ÂÆâÂÖ®Áä∂ÊÖã
                const safetyStatus = document.getElementById('safety-status');
                if (results.safetyStatus) {
                    safetyStatus.textContent = '‚úÖ Âü∫Ê∫ñÂÜÖ';
                    safetyStatus.className = 'status ok';
                } else {
                    safetyStatus.textContent = '‚ö†Ô∏è Âü∫Ê∫ñË∂ÖÈÅé';
                    safetyStatus.className = 'status danger';
                }

                // Ê∏õË°∞Áéá
                document.getElementById('attenuation-result').textContent = 
                    (results.attenuation * 100).toFixed(1) + '%';

                // ÂÆâÂÖ®‰ΩôË£ï
                document.getElementById('safety-margin').textContent = 
                    results.safetyMargin.toFixed(1) + '%';

                // ÁµêÊûú„Å´Âü∫„Å•„ÅÑ„Å¶Ë¶ñË¶öÂäπÊûú
                updateVisualFeedback(results);
            }

            function updateVisualFeedback(results) {
                // Ê§úÂá∫Âô®„ÅÆËâ≤„ÇíÁµêÊûú„Å´Âü∫„Å•„ÅÑ„Å¶Â§âÊõ¥
                if (detectorGeometry) {
                    const color = results.safetyStatus ? 0x44ff44 : 0xff4444;
                    detectorGeometry.material.color.setHex(color);
                    detectorGeometry.material.emissive.setHex(
                        results.safetyStatus ? 0x002200 : 0x220000
                    );
                }
            }

            function provideFeedback(results) {
                const material = document.getElementById('shield-material').value;
                const materialName = materialDatabase[material].name;
                
                let feedback = '';
                
                if (results.safetyStatus) {
                    if (results.safetyMargin > 50) {
                        feedback = `üéâ Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ${materialName}„ÅßÂçÅÂàÜ„Å™ÂÆâÂÖ®‰ΩôË£ï„ÇíÁ¢∫‰øù„Åß„Åç„Åæ„Åó„Åü„ÄÇ„Ç≥„Çπ„ÉàÊúÄÈÅ©Âåñ„ÇÇËÄÉÊÖÆ„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                    } else {
                        feedback = `‚úÖ Ë¶èÂà∂Âü∫Ê∫ñ„Çí„ÇØ„É™„Ç¢ÔºÅÂÆâÂÖ®‰ΩôË£ï„ÅØ${results.safetyMargin.toFixed(1)}%„Åß„Åô„ÄÇ`;
                    }
                } else {
                    if (results.doseRate > calculator.safetyLimit * 2) {
                        feedback = `‚ö†Ô∏è Á∑öÈáèÁéá„ÅåÈ´ò„Åô„Åé„Åæ„Åô„ÄÇÂéö„Åï„ÇíÂ¢óÂä†„Åô„Çã„Åã„ÄÅ„Çà„ÇäÂäπÊûúÁöÑ„Å™ÊùêÊñô„ÇíÊ§úË®é„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                    } else {
                        feedback = `üìè „ÇÇ„ÅÜÂ∞ë„Åó„Åß„ÅôÔºÅÂéö„Åï„Çí${Math.ceil((results.doseRate - calculator.safetyLimit) / calculator.safetyLimit * 10)}cmÂ¢óÂä†„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                    }
                }

                // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫ÔºàÁ∞°Êòì„Ç¢„É©„Éº„ÉàÔºâ
                setTimeout(() => {
                    if (feedback) alert(feedback);
                }, 500);
            }

            function showContextualHint() {
                const hints = {
                    1: "üí° ÊîæÂ∞ÑÁ∑ö„ÅØË∑ùÈõ¢„ÅÆ2‰πó„Å´ÂèçÊØî‰æã„Åó„Å¶Ê∏õË°∞„Åó„Åæ„Åô„ÄÇË∑ùÈõ¢„Çí2ÂÄç„Å´„Åô„Çã„Å®Âº∑Â∫¶„ÅØ1/4„Å´„Å™„Çä„Åæ„ÅôÔºÅ",
                    2: "üí° Èâõ„ÅØÂØÜÂ∫¶„ÅåÈ´ò„ÅÑ„Åü„ÇÅÂ∞ë„Å™„ÅÑÂéö„Åï„ÅßÂäπÊûúÁöÑ„Åß„Åô„Åå„ÄÅÈáçÈáè„Å®„Ç≥„Çπ„Éà„ÇÇËÄÉÊÖÆ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ",
                    3: "üí° Ë®≠Ë®àÁõÆÊ®ô„ÅØ2.5 ŒºSv/h‰ª•‰∏ã„Åß„Åô„ÄÇÂÆâÂÖ®‰ΩôË£ï10-20%„ÇíÁ¢∫‰øù„Åô„Çã„ÅÆ„Åå‰∏ÄËà¨ÁöÑ„Åß„Åô„ÄÇ"
                };
                
                alert(hints[progressManager.currentStep] || "üí° Âè≥ÂÅ¥„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíË™øÊï¥„Åó„Å¶„ÄÅÁµêÊûú„Åå„Å©„ÅÜÂ§â„Çè„Çã„ÅãË¶≥ÂØü„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ");
            }

            // ÂàùÊúüÁä∂ÊÖãË®≠ÂÆö
            progressManager.updateProgress();
            
            // „Ç¶„Çß„É´„Ç´„É†„É°„ÉÉ„Çª„Éº„Ç∏
            setTimeout(() => {
                alert("üõ°Ô∏è Poker MCP Interactive Guide Level 1 „Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ\n\n15ÂàÜ„ÅßÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÂü∫Êú¨„Çí„Éû„Çπ„Çø„Éº„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ\n\nÂè≥ÂÅ¥„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíÂ§âÊõ¥„Åó„Å™„Åå„Çâ„ÄÅ3DÂèØË¶ñÂåñ„ÅßÈÅÆËîΩÂäπÊûú„Çí‰ΩìÊÑü„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ");
            }, 1000);
        });
    </script>
</body>
</html>