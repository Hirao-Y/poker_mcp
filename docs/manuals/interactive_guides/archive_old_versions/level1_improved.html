<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üõ°Ô∏è Poker MCP Interactive Guide - Level 1: Âü∫Á§éÁøíÂæó</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        :root {
            --primary-blue: #1e3a8a;
            --primary-green: #059669;
            --warning-orange: #d97706;
            --danger-red: #dc2626;
            --bg-light: #f8fafc;
            --bg-panel: #ffffff;
            --text-primary: #1f2937;
            --text-secondary: #6b7280;
            --accent-physics: #7c3aed;
            --accent-success: #10b981;
            --accent-medical: #ec4899;
            --accent-nuclear: #f59e0b;
            --accent-research: #06b6d4;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--bg-light) 0%, #e2e8f0 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        .main-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--accent-physics) 100%);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .progress-container {
            flex: 1;
            max-width: 400px;
            margin: 0 2rem;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: var(--accent-success);
            transition: width 0.5s ease;
            border-radius: 4px;
        }

        .level-indicator {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        .main-content {
            display: grid;
            grid-template-columns: 320px 1fr 340px;
            gap: 1rem;
            padding: 1rem;
            height: calc(100vh - 140px);
        }

        .instruction-panel, .control-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            padding: 1.5rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            overflow-y: auto;
        }

        .visualization-panel {
            background: var(--bg-panel);
            border-radius: 12px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .step-indicator {
            background: linear-gradient(135deg, var(--accent-physics), #9333ea);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 1rem;
            text-align: center;
        }

        .concept-box {
            background: linear-gradient(135deg, #ede9fe, #ddd6fe);
            border: 2px solid var(--accent-physics);
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
        }

        .physics-formula {
            background: #1f2937;
            color: #f3f4f6;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            margin: 1rem 0;
            text-align: center;
            font-size: 1.2rem;
            letter-spacing: 1px;
        }

        .key-insight {
            background: linear-gradient(135deg, #fef3c7, #fbbf24);
            border: 2px solid var(--warning-orange);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
            border-left: 5px solid var(--warning-orange);
        }

        .research-context {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px solid var(--primary-green);
            border-radius: 10px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .parameter-section {
            margin-bottom: 2rem;
            border-bottom: 1px solid #e5e7eb;
            padding-bottom: 1.5rem;
        }

        .parameter-section:last-child {
            border-bottom: none;
        }

        .parameter-section h3 {
            color: var(--primary-blue);
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .parameter-group {
            margin-bottom: 1.5rem;
        }

        .parameter-group label {
            display: block;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
        }

        .parameter-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            transition: border-color 0.3s ease;
        }

        .parameter-input:focus {
            outline: none;
            border-color: var(--primary-blue);
        }

        .slider-container {
            margin: 0.5rem 0;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #e5e7eb;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-blue);
            cursor: pointer;
        }

        .slider-value {
            display: inline-block;
            background: var(--primary-blue);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-left: 0.5rem;
            font-weight: 600;
        }

        .primary-btn {
            background: linear-gradient(135deg, var(--primary-blue), var(--accent-physics));
            color: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            width: 100%;
            margin: 1rem 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.15);
        }

        .primary-btn:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .results-display {
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border: 2px solid var(--primary-green);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
            display: none;
        }

        .result-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-top: 1rem;
        }

        .result-card {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .result-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--primary-blue);
            margin: 0.5rem 0;
        }

        .result-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .result-status {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 0.5rem;
            display: inline-block;
        }

        .result-status.excellent {
            background: var(--primary-green);
            color: white;
        }

        .result-status.good {
            background: var(--accent-success);
            color: white;
        }

        .result-status.warning {
            background: var(--warning-orange);
            color: white;
        }

        .result-status.danger {
            background: var(--danger-red);
            color: white;
        }

        .comparison-table {
            background: white;
            border-radius: 8px;
            margin: 1rem 0;
            overflow: hidden;
            border: 1px solid #e5e7eb;
        }

        .comparison-table table {
            width: 100%;
            border-collapse: collapse;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 0.75rem;
            text-align: center;
            border-bottom: 1px solid #e5e7eb;
            font-size: 0.85rem;
        }

        .comparison-table th {
            background: var(--primary-blue);
            color: white;
            font-weight: 600;
        }

        .comparison-table tr:hover {
            background: #f8fafc;
        }

        .navigation-footer {
            background: var(--bg-panel);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.05);
        }

        .nav-btn {
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .nav-btn.primary {
            background: var(--primary-blue);
            color: white;
        }

        .nav-btn.secondary {
            background: #e5e7eb;
            color: var(--text-primary);
        }

        .nav-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }

        .nav-btn:disabled {
            background: #d1d5db;
            color: #9ca3af;
            cursor: not-allowed;
            transform: none;
        }

        #threejs-container {
            width: 100%;
            height: 100%;
        }

        .control-overlay {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.9);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-weight: 600;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 1);
            transform: scale(1.05);
        }

        .animation-controls {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            display: flex;
            gap: 0.5rem;
        }

        .play-btn {
            background: var(--primary-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .play-btn:hover {
            background: #047857;
            transform: scale(1.05);
        }

        .material-properties {
            background: linear-gradient(135deg, #fef2f2, #fee2e2);
            border: 2px solid var(--danger-red);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            font-size: 0.85rem;
        }

        .hvl-display {
            background: #1f2937;
            color: #10b981;
            font-family: 'Courier New', monospace;
            padding: 1rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            font-size: 0.9rem;
            text-align: center;
        }

        .educational-note {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border-left: 4px solid var(--warning-orange);
            padding: 1rem;
            margin: 1rem 0;
            border-radius: 0 8px 8px 0;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 300px 1fr 320px;
            }
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: auto 1fr auto;
                height: auto;
            }
            
            .instruction-panel, .control-panel {
                height: auto;
                max-height: 400px;
            }
            
            .result-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <header class="main-header">
        <div class="logo">
            üõ°Ô∏è Poker MCP Level 1: Âü∫Á§éÁøíÂæó
        </div>
        <div class="progress-container">
            <div class="progress-bar">
                <div class="progress" id="main-progress" style="width: 0%"></div>
            </div>
            <div class="level-indicator">ÁêÜË´ñÁêÜËß£ ‚Üí ‰ΩìÈ®ìÂ≠¶Áøí ‚Üí ÂÆüË∑µÂøúÁî® (15ÂàÜÁõÆÊ®ô)</div>
        </div>
        <div class="current-step" id="current-step-display">Step 1/4</div>
    </header>

    <main class="main-content">
        <div class="instruction-panel">
            <div class="step-indicator" id="step-indicator">Step 1: ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÁâ©ÁêÜÂ≠¶ÂéüÁêÜ</div>
            <div id="instruction-content">
                <h2>üî¨ ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÂü∫Êú¨Ê≥ïÂâá</h2>
                
                <div class="concept-box">
                    <h3>üìê Ê∏õË°∞„ÅÆÊåáÊï∞Ê≥ïÂâá</h3>
                    <p>ÊîæÂ∞ÑÁ∑ö„ÅÆÂº∑Â∫¶„ÅØÈÅÆËîΩÊùê„ÅÆÂéö„Åï„Å´ÂØæ„Åó„Å¶<strong>ÊåáÊï∞Èñ¢Êï∞ÁöÑ„Å´Ê∏õË°∞</strong>„Åó„Åæ„Åô„ÄÇ</p>
                    
                    <div class="physics-formula">
                        I = I‚ÇÄ √ó e^(-Œºt) √ó B(Œºt)
                    </div>
                    
                    <div style="margin-top: 1rem;">
                        <strong>üßÆ ÂêÑÈ†Ö„ÅÆÁâ©ÁêÜÁöÑÊÑèÂë≥:</strong><br>
                        ‚Ä¢ <strong>I‚ÇÄ</strong>: ÂÖ•Â∞ÑÁ∑öÈáèÁéá [Gy/s]<br>
                        ‚Ä¢ <strong>I</strong>: ÈÄèÈÅéÁ∑öÈáèÁéá [Gy/s]<br>
                        ‚Ä¢ <strong>Œº</strong>: Á∑öÊ∏õË°∞‰øÇÊï∞ [cm‚Åª¬π]<br>
                        ‚Ä¢ <strong>t</strong>: ÈÅÆËîΩÂéö„Åï [cm]<br>
                        ‚Ä¢ <strong>B(Œºt)</strong>: „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞ [-]
                    </div>
                </div>

                <div class="key-insight">
                    <strong>üí° Á†îÁ©∂ËÄÖ„Å´„Å®„Å£„Å¶ÈáçË¶Å„Å™„Éù„Ç§„É≥„Éà</strong><br>
                    Á∑öÊ∏õË°∞‰øÇÊï∞Œº„ÅØÊùêÊñô„ÅÆ<strong>ÂØÜÂ∫¶„Å®ÂéüÂ≠êÁï™Âè∑</strong>„Å´‰æùÂ≠ò„Åó„Åæ„Åô„ÄÇ<br>
                    Œº = (Œº/œÅ) √ó œÅ<br>
                    Ë≥™ÈáèÊ∏õË°∞‰øÇÊï∞„ÅØÊùêÊñôÂõ∫Êúâ„ÄÅÁ∑öÊ∏õË°∞‰øÇÊï∞„ÅØÂØÜÂ∫¶„ÇíÂê´„ÇÄÂÆüÂäπÂÄ§„Åß„Åô„ÄÇ
                </div>

                <div class="research-context">
                    <strong>üî¨ Áèæ‰ª£„ÅÆÁ†îÁ©∂ÂãïÂêë (2024Âπ¥)</strong><br>
                    ‚Ä¢ <strong>„É¢„É≥„ÉÜ„Ç´„É´„É≠Ê≥ï</strong>: PHITS„ÉªGeant4„Å´„Çà„ÇãÈ´òÁ≤æÂ∫¶Ë®àÁÆó<br>
                    ‚Ä¢ <strong>AIÊúÄÈÅ©Âåñ</strong>: Ê©üÊ¢∞Â≠¶Áøí„Å´„Çà„ÇãÈÅÆËîΩË®≠Ë®àËá™ÂãïÂåñ<br>
                    ‚Ä¢ <strong>Êñ∞ÊùêÊñô</strong>: „Éä„Éé„Ç≥„É≥„Éù„Ç∏„ÉÉ„Éà„ÉªË§áÂêàÈÅÆËîΩÊùê„ÅÆÈñãÁô∫<br>
                    ‚Ä¢ <strong>„É™„Ç¢„É´„Çø„Ç§„É†Ëß£Êûê</strong>: GPU‰∏¶ÂàóË®àÁÆó„Å´„Çà„ÇãÂç≥Â∫ßË©ï‰æ°
                </div>
            </div>
        </div>

        <div class="visualization-panel">
            <div id="threejs-container"></div>
            <div class="control-overlay">
                <button class="control-btn" id="view-3d" title="3DË°®Á§∫ÂàáÊõø">üîÑ 3DÂõûËª¢</button>
                <button class="control-btn" id="view-cross" title="Êñ≠Èù¢Ë°®Á§∫">üìè Êñ≠Èù¢Âõ≥</button>
                <button class="control-btn" id="reset-view" title="Ë¶ñÁÇπ„É™„Çª„ÉÉ„Éà">üè† „É™„Çª„ÉÉ„Éà</button>
            </div>
            <div class="animation-controls">
                <button class="play-btn" id="play-animation">‚ñ∂Ô∏è ÊîæÂ∞ÑÁ∑öÈ£õË∑°</button>
                <button class="play-btn" id="pause-animation" style="display: none;">‚è∏Ô∏è ÂÅúÊ≠¢</button>
                <button class="play-btn" id="show-field">üåä Á∑öÈáèÂàÜÂ∏É</button>
            </div>
        </div>

        <div class="control-panel">
            <div class="parameter-section">
                <h3>üß™ ÈÅÆËîΩÊùêÊñôÁâπÊÄß</h3>
                
                <div class="parameter-group">
                    <label>ÊùêÊñôÈÅ∏Êäû</label>
                    <select class="parameter-input" id="shield-material">
                        <option value="lead">Èâõ (Pb) - Z=82</option>
                        <option value="steel">ÈâÑ„ÉªÈãºÈâÑ (Fe) - Z=26</option>
                        <option value="concrete" selected>„Ç≥„É≥„ÇØ„É™„Éº„Éà - Ë§áÂêàÊùê</option>
                        <option value="aluminum">„Ç¢„É´„Éü„Éã„Ç¶„É† (Al) - Z=13</option>
                        <option value="tungsten">„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥ (W) - Z=74</option>
                        <option value="barite">„Éê„É©„Ç§„Éà„Ç≥„É≥„ÇØ„É™„Éº„Éà</option>
                    </select>
                </div>

                <div class="material-properties" id="material-properties">
                    <strong>„Ç≥„É≥„ÇØ„É™„Éº„Éà „ÅÆÁâπÊÄß:</strong><br>
                    ‚Ä¢ ÂØÜÂ∫¶: 2.3 g/cm¬≥<br>
                    ‚Ä¢ Ë≥™ÈáèÊ∏õË°∞‰øÇÊï∞: 0.0636 cm¬≤/g<br>
                    ‚Ä¢ Á∑öÊ∏õË°∞‰øÇÊï∞: 0.146 cm‚Åª¬π<br>
                    ‚Ä¢ Âçä‰æ°Â±§Âéö: 4.7 cm
                </div>

                <div class="parameter-group">
                    <label>Âéö„Åï (cm)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="thickness-slider" 
                               min="0" max="100" value="10" step="1">
                        <span class="slider-value" id="thickness-value">10 cm</span>
                    </div>
                    
                    <div class="hvl-display" id="hvl-display">
                        ÁèæÂú®„ÅÆÂéö„Åï: 2.1 HVL (Ê∏õË°∞Áéá: 76.9%)
                    </div>
                </div>
            </div>

            <div class="parameter-section">
                <h3>üìè Âπæ‰ΩïÂ≠¶ÁöÑÈÖçÁΩÆ</h3>
                
                <div class="parameter-group">
                    <label>Á∑öÊ∫ê-ÈÅÆËîΩ‰ΩìË∑ùÈõ¢ (cm)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="source-distance" 
                               min="10" max="100" value="50" step="5">
                        <span class="slider-value" id="source-distance-value">50 cm</span>
                    </div>
                </div>

                <div class="parameter-group">
                    <label>ÈÅÆËîΩ‰Ωì-Ê§úÂá∫Âô®Ë∑ùÈõ¢ (cm)</label>
                    <div class="slider-container">
                        <input type="range" class="slider" id="detector-distance" 
                               min="10" max="100" value="50" step="5">
                        <span class="slider-value" id="detector-distance-value">50 cm</span>
                    </div>
                </div>
            </div>

            <div class="parameter-section">
                <h3>‚ò¢Ô∏è Á∑öÊ∫êË®≠ÂÆö</h3>
                
                <div class="parameter-group">
                    <label>Ê†∏Á®Æ„Éª„Ç®„Éç„É´„ÇÆ„Éº</label>
                    <select class="parameter-input" id="radiation-source">
                        <option value="cs137" selected>Cs-137 (662 keV)</option>
                        <option value="co60">Co-60 (1.25 MeVÂπ≥Âùá)</option>
                        <option value="ir192">Ir-192 (380 keVÂπ≥Âùá)</option>
                        <option value="generic_1mev">Ê±éÁî® (1 MeV)</option>
                    </select>
                </div>

                <div class="parameter-group">
                    <label>ÊîæÂ∞ÑËÉΩ (Bq)</label>
                    <select class="parameter-input" id="source-activity">
                        <option value="3.7e9">3.7√ó10‚Åπ (100 mCi)</option>
                        <option value="3.7e10" selected>3.7√ó10¬π‚Å∞ (1 Ci)</option>
                        <option value="3.7e11">3.7√ó10¬π¬π (10 Ci)</option>
                        <option value="3.7e12">3.7√ó10¬π¬≤ (100 Ci)</option>
                    </select>
                </div>
            </div>

            <button class="primary-btn" id="calculate-btn">‚ö° È´òÁ≤æÂ∫¶ÈÅÆËîΩË®àÁÆóÂÆüË°å</button>

            <div class="results-display" id="results-display">
                <h4 style="text-align: center; margin-bottom: 1rem; color: var(--primary-blue);">üìä Ë®àÁÆóÁµêÊûú</h4>
                
                <div class="result-grid">
                    <div class="result-card">
                        <div class="result-label">ÈÄèÈÅéÁ∑öÈáèÁéá</div>
                        <div class="result-value" id="dose-rate-result">-- ŒºSv/h</div>
                        <div class="result-status" id="safety-status">--</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Ê∏õË°∞Áéá</div>
                        <div class="result-value" id="attenuation-result">-- %</div>
                        <div class="result-status" id="attenuation-status">--</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">„Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞</div>
                        <div class="result-value" id="buildup-result">--</div>
                        <div class="result-status" id="buildup-status">--</div>
                    </div>
                    
                    <div class="result-card">
                        <div class="result-label">Âçä‰æ°Â±§ÂéöÊØî</div>
                        <div class="result-value" id="hvl-ratio">-- HVL</div>
                        <div class="result-status" id="hvl-status">--</div>
                    </div>
                </div>

                <div class="comparison-table" id="comparison-table" style="display: none;">
                    <table>
                        <thead>
                            <tr>
                                <th>ÊùêÊñô</th>
                                <th>ÂØÜÂ∫¶<br>[g/cm¬≥]</th>
                                <th>Œº/œÅ<br>[cm¬≤/g]</th>
                                <th>HVL<br>[cm]</th>
                                <th>Áõ∏ÂØæÂäπÁéá</th>
                            </tr>
                        </thead>
                        <tbody id="comparison-tbody">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </main>

    <footer class="navigation-footer">
        <button class="nav-btn secondary" id="prev-step" disabled>‚Üê Ââç„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó</button>
        <div style="display: flex; gap: 1rem;">
            <button class="nav-btn secondary" id="hint-btn">üí° Áâ©ÁêÜËß£Ë™¨</button>
            <button class="nav-btn secondary" id="compare-materials">üìä ÊùêÊñôÊØîËºÉ</button>
            <button class="nav-btn secondary" id="restart-btn">üîÑ „É™„Çª„ÉÉ„Éà</button>
        </div>
        <button class="nav-btn primary" id="next-step">Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó ‚Üí</button>
    </footer>

    <script>
        // ÊîπËâØ„Åï„Çå„ÅüÁâ©ÁêÜÂÆöÊï∞„ÉªÊùêÊñô„Éá„Éº„Çø„Éô„Éº„Çπ (2024Âπ¥ÊúÄÊñ∞„Éá„Éº„Çø)
        const materialDatabase = {
            lead: { 
                density: 11.34, 
                muMass: 0.107, 
                color: 0x696969, 
                name: 'Èâõ',
                atomicNumber: 82,
                cost: 8.5, // Áõ∏ÂØæ„Ç≥„Çπ„Éà
                applications: 'ÂåªÁôÇÈÅÆËîΩ„ÉªÂ∑•Ê•≠Ê§úÊüª'
            },
            steel: { 
                density: 7.87, 
                muMass: 0.0565, 
                color: 0x708090, 
                name: 'ÈâÑ„ÉªÈãºÈâÑ',
                atomicNumber: 26,
                cost: 2.0,
                applications: 'ÊßãÈÄ†Êùê„Éª‰∫åÊ¨°ÈÅÆËîΩ'
            },
            concrete: { 
                density: 2.3, 
                muMass: 0.0636, 
                color: 0xd2b48c, 
                name: '„Ç≥„É≥„ÇØ„É™„Éº„Éà',
                atomicNumber: 11.6, // ÂÆüÂäπÂéüÂ≠êÁï™Âè∑
                cost: 1.0,
                applications: 'Âª∫ÁØâÈÅÆËîΩ„ÉªÂ§ßÂûãÊñΩË®≠'
            },
            aluminum: { 
                density: 2.70, 
                muMass: 0.0820, 
                color: 0xc0c0c0, 
                name: '„Ç¢„É´„Éü„Éã„Ç¶„É†',
                atomicNumber: 13,
                cost: 3.2,
                applications: 'ËªΩÈáèÈÅÆËîΩ„ÉªËà™Á©∫ÂÆáÂÆô'
            },
            tungsten: { 
                density: 19.25, 
                muMass: 0.0947, 
                color: 0x404040, 
                name: '„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥',
                atomicNumber: 74,
                cost: 25.0,
                applications: 'È´òÊÄßËÉΩÈÅÆËîΩ„ÉªÂåªÁôÇ'
            },
            barite: { 
                density: 4.2, 
                muMass: 0.0620, 
                color: 0x8b7355, 
                name: '„Éê„É©„Ç§„Éà„Ç≥„É≥„ÇØ„É™„Éº„Éà',
                atomicNumber: 16.2,
                cost: 2.8,
                applications: 'ÂåªÁôÇÊñΩË®≠„ÉªÈáçÈÅÆËîΩ'
            }
        };

        const sourceDatabase = {
            cs137: { energy: 0.662, name: 'Cs-137', gammaConstant: 0.325 },
            co60: { energy: 1.25, name: 'Co-60', gammaConstant: 1.32 },
            ir192: { energy: 0.38, name: 'Ir-192', gammaConstant: 0.48 },
            generic_1mev: { energy: 1.0, name: '1 MeV Œ≥Á∑ö', gammaConstant: 0.85 }
        };

        let scene, camera, renderer;
        let shieldGeometry, sourceGeometry, detectorGeometry;
        let currentStep = 1;
        let isAnimationPlaying = false;
        let particleSystem = null;

        // ÊîπËâØ„Åï„Çå„ÅüÂ≠¶ÁøíÈÄ≤Ë°åÁÆ°ÁêÜ„Ç∑„Çπ„ÉÜ„É†
        class AdvancedLearningManager {
            constructor() {
                this.currentStep = 1;
                this.totalSteps = 4;
                this.completedActions = new Set();
                this.startTime = Date.now();
                this.interactionCount = 0;
                this.calculationCount = 0;
            }

            updateProgress() {
                const progress = Math.max(0, (this.currentStep - 1) / (this.totalSteps - 1) * 100);
                document.getElementById('main-progress').style.width = progress + '%';
                document.getElementById('current-step-display').textContent = `Step ${this.currentStep}/${this.totalSteps}`;
            }

            nextStep() {
                if (this.currentStep < this.totalSteps) {
                    this.currentStep++;
                    this.updateStepContent();
                    this.updateProgress();
                } else {
                    this.completeLevel1();
                }
            }

            previousStep() {
                if (this.currentStep > 1) {
                    this.currentStep--;
                    this.updateStepContent();
                    this.updateProgress();
                }
            }

            updateStepContent() {
                const stepContents = {
                    1: {
                        title: 'Step 1: ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÁâ©ÁêÜÂ≠¶ÂéüÁêÜ',
                        content: `
                            <h2>üî¨ ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÂü∫Êú¨Ê≥ïÂâá</h2>
                            
                            <div class="concept-box">
                                <h3>üìê Ê∏õË°∞„ÅÆÊåáÊï∞Ê≥ïÂâá</h3>
                                <p>ÊîæÂ∞ÑÁ∑ö„ÅÆÂº∑Â∫¶„ÅØÈÅÆËîΩÊùê„ÅÆÂéö„Åï„Å´ÂØæ„Åó„Å¶<strong>ÊåáÊï∞Èñ¢Êï∞ÁöÑ„Å´Ê∏õË°∞</strong>„Åó„Åæ„Åô„ÄÇ</p>
                                
                                <div class="physics-formula">
                                    I = I‚ÇÄ √ó e^(-Œºt) √ó B(Œºt)
                                </div>
                                
                                <div style="margin-top: 1rem;">
                                    <strong>üßÆ ÂêÑÈ†Ö„ÅÆÁâ©ÁêÜÁöÑÊÑèÂë≥:</strong><br>
                                    ‚Ä¢ <strong>I‚ÇÄ</strong>: ÂÖ•Â∞ÑÁ∑öÈáèÁéá [Gy/s]<br>
                                    ‚Ä¢ <strong>I</strong>: ÈÄèÈÅéÁ∑öÈáèÁéá [Gy/s]<br>
                                    ‚Ä¢ <strong>Œº</strong>: Á∑öÊ∏õË°∞‰øÇÊï∞ [cm‚Åª¬π]<br>
                                    ‚Ä¢ <strong>t</strong>: ÈÅÆËîΩÂéö„Åï [cm]<br>
                                    ‚Ä¢ <strong>B(Œºt)</strong>: „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞ [-]
                                </div>
                            </div>

                            <div class="key-insight">
                                <strong>üí° Á†îÁ©∂ËÄÖ„Å´„Å®„Å£„Å¶ÈáçË¶Å„Å™„Éù„Ç§„É≥„Éà</strong><br>
                                Á∑öÊ∏õË°∞‰øÇÊï∞Œº„ÅØÊùêÊñô„ÅÆ<strong>ÂØÜÂ∫¶„Å®ÂéüÂ≠êÁï™Âè∑</strong>„Å´‰æùÂ≠ò„Åó„Åæ„Åô„ÄÇ<br>
                                Œº = (Œº/œÅ) √ó œÅ<br>
                                Ë≥™ÈáèÊ∏õË°∞‰øÇÊï∞„ÅØÊùêÊñôÂõ∫Êúâ„ÄÅÁ∑öÊ∏õË°∞‰øÇÊï∞„ÅØÂØÜÂ∫¶„ÇíÂê´„ÇÄÂÆüÂäπÂÄ§„Åß„Åô„ÄÇ
                            </div>

                            <div class="research-context">
                                <strong>üî¨ Áèæ‰ª£„ÅÆÁ†îÁ©∂ÂãïÂêë (2024Âπ¥)</strong><br>
                                ‚Ä¢ <strong>„É¢„É≥„ÉÜ„Ç´„É´„É≠Ê≥ï</strong>: PHITS„ÉªGeant4„Å´„Çà„ÇãÈ´òÁ≤æÂ∫¶Ë®àÁÆó<br>
                                ‚Ä¢ <strong>AIÊúÄÈÅ©Âåñ</strong>: Ê©üÊ¢∞Â≠¶Áøí„Å´„Çà„ÇãÈÅÆËîΩË®≠Ë®àËá™ÂãïÂåñ<br>
                                ‚Ä¢ <strong>Êñ∞ÊùêÊñô</strong>: „Éä„Éé„Ç≥„É≥„Éù„Ç∏„ÉÉ„Éà„ÉªË§áÂêàÈÅÆËîΩÊùê„ÅÆÈñãÁô∫<br>
                                ‚Ä¢ <strong>„É™„Ç¢„É´„Çø„Ç§„É†Ëß£Êûê</strong>: GPU‰∏¶ÂàóË®àÁÆó„Å´„Çà„ÇãÂç≥Â∫ßË©ï‰æ°
                            </div>
                        `
                    },
                    2: {
                        title: 'Step 2: ÊùêÊñôÁâπÊÄß„ÅÆÂÆöÈáèÁöÑÁêÜËß£',
                        content: `
                            <h2>üß™ ÊùêÊñô„Å´„Çà„ÇãÈÅÆËîΩÊÄßËÉΩ„ÅÆÈÅï„ÅÑ</h2>
                            
                            <div class="concept-box">
                                <h3>üìä ÊùêÊñôÈÅ∏Êäû„ÅÆÁßëÂ≠¶ÁöÑÊ†πÊã†</h3>
                                <p>ÈÅÆËîΩÂäπÊûú„ÅØ<strong>ÂéüÂ≠êÁï™Âè∑Z„Å®ÂØÜÂ∫¶œÅ</strong>„Å´„Çà„Å£„Å¶Ê±∫„Åæ„Çä„Åæ„Åô„ÄÇ</p>
                                
                                <div class="physics-formula">
                                    Œº/œÅ ‚àù Z^n / A
                                </div>
                                
                                <p style="text-align: center; margin-top: 0.5rem; color: #6b7280;">
                                    n„ÅØ3-5ÔºàÂÖâÈõªÂäπÊûúÂÑ™Âã¢È†òÂüüÔºâ„ÄÅA„ÅØÂéüÂ≠êË≥™Èáè
                                </p>
                            </div>

                            <div class="key-insight">
                                <strong>üí° ÂÆüÁî®ÁöÑ„Å™ÊùêÊñôÈÅ∏ÊäûÊåáÈáù</strong><br>
                                ‚Ä¢ <strong>Èâõ„Éª„Çø„É≥„Ç∞„Çπ„ÉÜ„É≥</strong>: Â∞è„Çπ„Éö„Éº„Çπ„ÉªÈ´òÊÄßËÉΩ„ÅåÂøÖË¶Å<br>
                                ‚Ä¢ <strong>„Ç≥„É≥„ÇØ„É™„Éº„Éà</strong>: Â§ßÂûãÊñΩË®≠„Éª„Ç≥„Çπ„ÉàÈáçË¶ñ<br>
                                ‚Ä¢ <strong>Ë§áÂêàÊùê</strong>: ÁâπÂÆöÁî®ÈÄî„Å∏„ÅÆÊúÄÈÅ©Âåñ
                            </div>

                            <div class="educational-note">
                                <strong>üéØ Âè≥ÂÅ¥„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíÂ§âÊõ¥„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</strong><br>
                                ÊùêÊñô„ÇíÂ§âÊõ¥„Åó„Å¶„ÄÅÂçä‰æ°Â±§Âéö„ÇÑÊ∏õË°∞Áéá„ÅÆÂ§âÂåñ„ÇíË¶≥ÂØü„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                                Ë®àÁÆóÂÆüË°å„Éú„Çø„É≥„ÅßÂÆöÈáèÁöÑ„Å™ÁµêÊûú„ÇÇÁ¢∫Ë™ç„Åß„Åç„Åæ„Åô„ÄÇ
                            </div>
                        `
                    },
                    3: {
                        title: 'Step 3: Âπæ‰ΩïÂ≠¶ÁöÑË¶ÅÂõ†„Å®Ë∑ùÈõ¢ÂäπÊûú',
                        content: `
                            <h2>üìè Ë∑ùÈõ¢„Å®ÂΩ¢Áä∂„ÅÆÂΩ±Èüø</h2>
                            
                            <div class="concept-box">
                                <h3>üìê Ë∑ùÈõ¢„ÅÆÈÄÜ‰∫å‰πóÂâá</h3>
                                <p>ÁÇπÁ∑öÊ∫ê„Åã„Çâ„ÅÆÁ∑öÈáèÁéá„ÅØ<strong>Ë∑ùÈõ¢„ÅÆ‰∫å‰πó„Å´ÂèçÊØî‰æã</strong>„Åó„Åæ„Åô„ÄÇ</p>
                                
                                <div class="physics-formula">
                                    ·∏ä = ·∏ä‚ÇÄ √ó (r‚ÇÄ/r)¬≤
                                </div>
                                
                                <p style="text-align: center; margin-top: 0.5rem; color: #6b7280;">
                                    Ë∑ùÈõ¢„Çí2ÂÄç„Å´„Åô„Çã„Å®Á∑öÈáèÁéá„ÅØ1/4„Å´Ê∏õÂ∞ë
                                </p>
                            </div>

                            <div class="key-insight">
                                <strong>üí° ÂÆüÈöõ„ÅÆË®≠Ë®à„Åß„ÅÆËÄÉÊÖÆ‰∫ãÈ†Ö</strong><br>
                                ‚Ä¢ <strong>Êï£‰π±Á∑ö</strong>: 1Ê¨°Á∑ö„Å®„ÅØÁï∞„Å™„ÇãËßíÂ∫¶ÂàÜÂ∏É<br>
                                ‚Ä¢ <strong>„Éì„É´„Éâ„Ç¢„ÉÉ„Éó</strong>: Âéö„ÅÑÈÅÆËîΩ„Åß„ÅÆÊï£‰π±Á∑öËìÑÁ©ç<br>
                                ‚Ä¢ <strong>ÂΩ¢Áä∂Âõ†Â≠ê</strong>: Á∑öÊ∫ê„ÉªÊ§úÂá∫Âô®„ÅÆÂ§ß„Åç„Åï„Å®ÂΩ¢Áä∂
                            </div>

                            <div class="educational-note">
                                <strong>üéØ Ë∑ùÈõ¢„Éë„É©„É°„Éº„Çø„ÇíË™øÊï¥„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜÔºÅ</strong><br>
                                Á∑öÊ∫ê-ÈÅÆËîΩ‰Ωì„ÄÅÈÅÆËîΩ‰Ωì-Ê§úÂá∫Âô®„ÅÆË∑ùÈõ¢„ÇíÂ§â„Åà„Å¶„ÄÅ
                                ÂÖ®‰Ωì„ÅÆÈÅÆËîΩÂäπÊûú„Åå„Å©„ÅÜÂ§âÂåñ„Åô„Çã„Åã„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                            </div>
                        `
                    },
                    4: {
                        title: 'Step 4: ÂÆüÁî®Ë®≠Ë®à„Å∏„ÅÆÂøúÁî®',
                        content: `
                            <h2>üèóÔ∏è ÂÆüÈöõ„ÅÆÈÅÆËîΩË®≠Ë®àÊâãÈ†Ü</h2>
                            
                            <div class="concept-box">
                                <h3>üéØ Ë®≠Ë®àÁõÆÊ®ô„ÅÆË®≠ÂÆö</h3>
                                <p>Ë¶èÂà∂Ë¶ÅÊ±ÇÂÄ§„ÇíÊ∫Ä„Åü„ÅôÈÅÆËîΩÂéö„ÇíÂäπÁéáÁöÑ„Å´Ê±∫ÂÆö„Åó„Åæ„Åô„ÄÇ</p>
                                
                                <div class="physics-formula">
                                    t = ln(I‚ÇÄ/I_target) / Œº
                                </div>
                                
                                <p style="text-align: center; margin-top: 0.5rem; color: #6b7280;">
                                    Á∞°Áï•ÂåñÔºà„Éì„É´„Éâ„Ç¢„ÉÉ„ÉóÁÑ°Ë¶ñÊôÇÔºâ„ÅÆËøë‰ººÂºè
                                </p>
                            </div>

                            <div class="key-insight">
                                <strong>üí° ÂÆüÁî®Ë®≠Ë®à„ÅÆ„Éù„Ç§„É≥„Éà</strong><br>
                                ‚Ä¢ <strong>ÂÆâÂÖ®‰øÇÊï∞</strong>: Ë®àÁÆóÂÄ§„ÅÆ1.5-2ÂÄçÁ®ãÂ∫¶<br>
                                ‚Ä¢ <strong>ÁµåÊ∏àÊÄßË©ï‰æ°</strong>: ÊùêÊñô„Ç≥„Çπ„Éà„ÉªÊñΩÂ∑•ÊÄß„Éª‰øùÂÆàÊÄß<br>
                                ‚Ä¢ <strong>Ê≥ïË¶èÂà∂ÂØæÂøú</strong>: ÂêÑÂàÜÈáé„ÅÆË¶èÂà∂Âü∫Ê∫ñÂÄ§ÈÅµÂÆà
                            </div>

                            <div class="research-context">
                                <strong>üî¨ ÊúÄÊñ∞„ÅÆË®≠Ë®àÊâãÊ≥ï</strong><br>
                                ‚Ä¢ <strong>ÊúÄÈÅ©Âåñ„Ç¢„É´„Ç¥„É™„Ç∫„É†</strong>: Â§öÁõÆÁöÑÊúÄÈÅ©Âåñ„Å´„Çà„ÇãË®≠Ë®à<br>
                                ‚Ä¢ <strong>‰∏çÁ¢∫ÂÆüÊÄßËß£Êûê</strong>: „É¢„É≥„ÉÜ„Ç´„É´„É≠Ê≥ï„Å´„Çà„Çã‰ø°È†ºÂå∫Èñì<br>
                                ‚Ä¢ <strong>„Éá„Ç∏„Çø„É´„ÉÑ„Ç§„É≥</strong>: „É™„Ç¢„É´„Çø„Ç§„É†Áõ£Ë¶ñ„Éª‰∫àÊ∏¨
                            </div>

                            <div class="educational-note">
                                <strong>üéâ Level 1 ÂÆå‰∫ÜÊ∫ñÂÇô</strong><br>
                                Êßò„ÄÖ„Å™„Éë„É©„É°„Éº„Çø„ÇíË©¶„Åó„Å¶„ÄÅÈÅÆËîΩË®≠Ë®à„ÅÆÊÑüË¶ö„ÇíÊé¥„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ
                                Ê¨°„ÅÆLevel 2„Åß„ÅØ„ÄÅÂÆüÈöõ„ÅÆÊñΩË®≠Ë®≠Ë®à„Çí‰ΩìÈ®ì„Åó„Åæ„ÅôÔºÅ
                            </div>
                        `
                    }
                };

                const stepData = stepContents[this.currentStep];
                document.getElementById('step-indicator').textContent = stepData.title;
                document.getElementById('instruction-content').innerHTML = stepData.content;

                // „Çπ„ÉÜ„ÉÉ„Éó„Å´Âøú„Åò„Åü„Éú„Çø„É≥Áä∂ÊÖã
                document.getElementById('prev-step').disabled = this.currentStep === 1;
                document.getElementById('next-step').textContent = 
                    this.currentStep === this.totalSteps ? 'Level 2„Å∏ÈÄ≤„ÇÄ ‚Üí' : 'Ê¨°„ÅÆ„Çπ„ÉÜ„ÉÉ„Éó ‚Üí';
            }

            completeLevel1() {
                const completionTime = (Date.now() - this.startTime) / 1000;
                const completionData = {
                    level: 1,
                    completionTime: completionTime,
                    interactionCount: this.interactionCount,
                    calculationCount: this.calculationCount,
                    completedAt: new Date().toISOString(),
                    finalStep: this.currentStep
                };

                // „É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„Å´‰øùÂ≠ò
                localStorage.setItem('poker_mcp_level1_completion', JSON.stringify(completionData));
                localStorage.setItem('poker_mcp_level1_completed', 'true');

                alert(`üéâ Level 1 Âü∫Á§éÁøíÂæóÂÆå‰∫Ü„Åä„ÇÅ„Åß„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„ÅôÔºÅ\n\n` +
                      `ÂÆå‰∫ÜÊôÇÈñì: ${Math.round(completionTime)}Áßí\n` +
                      `Êìç‰ΩúÂõûÊï∞: ${this.interactionCount}Âõû\n` +
                      `Ë®àÁÆóÂÆüË°å: ${this.calculationCount}Âõû\n\n` +
                      `Level 2: ÂÆüÁî®Ë®≠Ë®à „ÅßÊõ¥„Å™„Çã„Çπ„Ç≠„É´„ÇíÁøíÂæó„Åó„Åæ„Åó„Çá„ÅÜÔºÅ`);

                // Level 2„Å∏„ÅÆ„É™„ÉÄ„Ç§„É¨„ÇØ„ÉàÔºàÂÆüÈöõ„ÅÆ„Ç∑„Çπ„ÉÜ„É†„Åß„ÅØÔºâ
                if (confirm('Level 2: ÂÆüÁî®Ë®≠Ë®à„Å´ÈÄ≤„Åø„Åæ„Åô„ÅãÔºü')) {
                    window.location.href = 'interactive_guide_level2.html';
                }
            }

            trackInteraction(type, data) {
                this.interactionCount++;
                this.completedActions.add(`${type}_${Date.now()}`);
                console.log('Interaction tracked:', type, data);
            }

            trackCalculation(results) {
                this.calculationCount++;
                this.trackInteraction('calculation', results);
            }
        }

        // È´òÂ∫¶„Å™3DÂèØË¶ñÂåñ„Ç∑„Çπ„ÉÜ„É†
        class Advanced3DVisualizer {
            constructor(container) {
                this.container = container;
                this.initializeScene();
                this.createObjects();
                this.setupControls();
                this.animate();
            }

            initializeScene() {
                scene = new THREE.Scene();
                scene.background = new THREE.Color(0xf0f4f8);

                camera = new THREE.PerspectiveCamera(75, 
                    this.container.clientWidth / this.container.clientHeight, 0.1, 1000);
                camera.position.set(8, 6, 12);
                camera.lookAt(0, 0, 0);

                renderer = new THREE.WebGLRenderer({ antialias: true });
                renderer.setSize(this.container.clientWidth, this.container.clientHeight);
                renderer.shadowMap.enabled = true;
                renderer.shadowMap.type = THREE.PCFSoftShadowMap;
                this.container.appendChild(renderer.domElement);

                // ÊîπËâØ„Åï„Çå„Åü„É©„Ç§„ÉÜ„Ç£„É≥„Ç∞
                const ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
                scene.add(ambientLight);

                const directionalLight = new THREE.DirectionalLight(0xffffff, 0.8);
                directionalLight.position.set(10, 20, 10);
                directionalLight.castShadow = true;
                directionalLight.shadow.mapSize.width = 2048;
                directionalLight.shadow.mapSize.height = 2048;
                scene.add(directionalLight);

                // Â∫ßÊ®ôÁ≥ª„Å®„Ç∞„É™„ÉÉ„Éâ
                const axesHelper = new THREE.AxesHelper(5);
                scene.add(axesHelper);

                const gridHelper = new THREE.GridHelper(20, 20, 0xcccccc, 0xeeeeee);
                scene.add(gridHelper);
            }

            createObjects() {
                this.createSource();
                this.createShield();
                this.createDetector();
                this.createEnvironment();
                this.updatePositions();
            }

            createSource() {
                const sourceGeom = new THREE.SphereGeometry(0.3, 32, 32);
                const sourceMat = new THREE.MeshLambertMaterial({ 
                    color: 0xff4444,
                    emissive: 0x330000
                });
                sourceGeometry = new THREE.Mesh(sourceGeom, sourceMat);
                sourceGeometry.position.set(-5, 1, 0);
                sourceGeometry.castShadow = true;
                scene.add(sourceGeometry);

                // Á∑öÊ∫ê„É©„Éô„É´ÔºàÁ∞°Áï•ÂåñÔºâ
                this.addObjectLabel(sourceGeometry, '‚ò¢Ô∏è Á∑öÊ∫ê', 0xff4444);
            }

            createShield() {
                // ÂàùÊúüÈÅÆËîΩÊùê‰ΩúÊàêÔºàÂæå„ÅßÊõ¥Êñ∞Ôºâ
                this.updateShield('concrete', 1.0);
            }

            updateShield(material, thickness) {
                if (shieldGeometry) {
                    scene.remove(shieldGeometry);
                }

                if (thickness > 0) {
                    const materialData = materialDatabase[material];
                    const shieldGeom = new THREE.BoxGeometry(thickness, 4, 3);
                    const shieldMat = new THREE.MeshLambertMaterial({ 
                        color: materialData.color,
                        transparent: true,
                        opacity: 0.7
                    });
                    shieldGeometry = new THREE.Mesh(shieldGeom, shieldMat);
                    shieldGeometry.position.set(0, 2, 0);
                    shieldGeometry.castShadow = true;
                    shieldGeometry.receiveShadow = true;
                    scene.add(shieldGeometry);

                    this.addObjectLabel(shieldGeometry, 
                        `üõ°Ô∏è ${materialData.name}\n${thickness.toFixed(1)} cm`, 
                        materialData.color);
                }
            }

            createDetector() {
                const detectorGeom = new THREE.SphereGeometry(0.25, 24, 24);
                const detectorMat = new THREE.MeshLambertMaterial({ 
                    color: 0x44ff44,
                    emissive: 0x002200
                });
                detectorGeometry = new THREE.Mesh(detectorGeom, detectorMat);
                detectorGeometry.position.set(5, 1, 0);
                detectorGeometry.castShadow = true;
                scene.add(detectorGeometry);

                this.addObjectLabel(detectorGeometry, 'üì° Ê§úÂá∫Âô®', 0x44ff44);
            }

            createEnvironment() {
                // Â∫äÈù¢
                const floorGeometry = new THREE.PlaneGeometry(30, 20);
                const floorMaterial = new THREE.MeshLambertMaterial({ 
                    color: 0xf5f5f5,
                    transparent: true,
                    opacity: 0.3
                });
                const floor = new THREE.Mesh(floorGeometry, floorMaterial);
                floor.rotation.x = -Math.PI / 2;
                floor.position.y = -1;
                floor.receiveShadow = true;
                scene.add(floor);
            }

            addObjectLabel(object, text, color) {
                // Á∞°Áï•Âåñ„Åï„Çå„Åü„É©„Éô„É´Ë°®Á§∫ÔºàÂÆüÈöõ„Å´„ÅØCSS3D„Å™„Å©„Çí‰ΩøÁî®Ôºâ
                console.log(`Label for ${object.constructor.name}: ${text}`);
            }

            updatePositions() {
                const sourceDistance = parseFloat(document.getElementById('source-distance')?.value || 50);
                const detectorDistance = parseFloat(document.getElementById('detector-distance')?.value || 50);
                
                if (sourceGeometry) {
                    sourceGeometry.position.x = -(sourceDistance / 10);
                }
                
                if (detectorGeometry) {
                    detectorGeometry.position.x = detectorDistance / 10;
                }

                this.createRadiationPaths();
            }

            createRadiationPaths() {
                // ÊîæÂ∞ÑÁ∑öÁµåË∑Ø„ÅÆÂèØË¶ñÂåñ
                const pathMaterial = new THREE.LineBasicMaterial({ 
                    color: 0xff6666,
                    transparent: true,
                    opacity: 0.6
                });

                // Êó¢Â≠ò„ÅÆ„Éë„Çπ„ÇíÂâäÈô§
                scene.children.forEach(child => {
                    if (child.userData.isRadiationPath) {
                        scene.remove(child);
                    }
                });

                // Êñ∞„Åó„ÅÑ„Éë„Çπ‰ΩúÊàê
                const points = [];
                points.push(sourceGeometry.position.clone());
                points.push(detectorGeometry.position.clone());

                const pathGeometry = new THREE.BufferGeometry().setFromPoints(points);
                const pathLine = new THREE.Line(pathGeometry, pathMaterial);
                pathLine.userData.isRadiationPath = true;
                scene.add(pathLine);
            }

            setupControls() {
                let isMouseDown = false;
                let mouseX = 0, mouseY = 0;
                let targetRotationX = 0.2, targetRotationY = 0.5;
                let currentDistance = 15;

                this.container.addEventListener('mousedown', (event) => {
                    isMouseDown = true;
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                this.container.addEventListener('mousemove', (event) => {
                    if (!isMouseDown) return;
                    
                    const deltaX = event.clientX - mouseX;
                    const deltaY = event.clientY - mouseY;
                    
                    targetRotationY += deltaX * 0.01;
                    targetRotationX += deltaY * 0.01;
                    targetRotationX = Math.max(-Math.PI/2, Math.min(Math.PI/2, targetRotationX));
                    
                    mouseX = event.clientX;
                    mouseY = event.clientY;
                });

                this.container.addEventListener('mouseup', () => {
                    isMouseDown = false;
                });

                this.container.addEventListener('wheel', (event) => {
                    event.preventDefault();
                    currentDistance += event.deltaY * 0.02;
                    currentDistance = Math.max(5, Math.min(30, currentDistance));
                });

                // „Ç´„É°„É©‰ΩçÁΩÆÊõ¥Êñ∞
                const updateCamera = () => {
                    const x = currentDistance * Math.sin(targetRotationY) * Math.cos(targetRotationX);
                    const y = currentDistance * Math.sin(targetRotationX) + 3;
                    const z = currentDistance * Math.cos(targetRotationY) * Math.cos(targetRotationX);
                    
                    camera.position.x = x;
                    camera.position.y = y;
                    camera.position.z = z;
                    camera.lookAt(0, 2, 0);
                    
                    requestAnimationFrame(updateCamera);
                };
                updateCamera();
            }

            animate() {
                const render = () => {
                    requestAnimationFrame(render);
                    
                    if (sourceGeometry) {
                        sourceGeometry.rotation.y += 0.02;
                    }
                    
                    renderer.render(scene, camera);
                };
                render();
            }

            playRadiationAnimation() {
                if (isAnimationPlaying || !sourceGeometry || !detectorGeometry) return;
                
                isAnimationPlaying = true;
                
                // „Éë„Éº„ÉÜ„Ç£„ÇØ„É´„Ç∑„Çπ„ÉÜ„É†„ÅÆ‰ΩúÊàê
                const particleCount = 20;
                const particles = new THREE.BufferGeometry();
                const positions = new Float32Array(particleCount * 3);
                
                for (let i = 0; i < particleCount; i++) {
                    positions[i * 3] = sourceGeometry.position.x;
                    positions[i * 3 + 1] = sourceGeometry.position.y;
                    positions[i * 3 + 2] = sourceGeometry.position.z;
                }
                
                particles.setAttribute('position', new THREE.BufferAttribute(positions, 3));
                
                const particleMaterial = new THREE.PointsMaterial({
                    color: 0xff6666,
                    size: 0.2,
                    transparent: true,
                    opacity: 0.8
                });
                
                particleSystem = new THREE.Points(particles, particleMaterial);
                scene.add(particleSystem);
                
                this.animateParticles();
            }

            animateParticles() {
                if (!isAnimationPlaying || !particleSystem) return;
                
                const positions = particleSystem.geometry.attributes.position.array;
                const sourcePos = sourceGeometry.position;
                const detectorPos = detectorGeometry.position;
                const direction = detectorPos.clone().sub(sourcePos).normalize();
                
                for (let i = 0; i < positions.length; i += 3) {
                    positions[i] += direction.x * 0.1;
                    positions[i + 1] += direction.y * 0.1;
                    positions[i + 2] += direction.z * 0.1;
                    
                    // „É™„Çª„ÉÉ„ÉàÊù°‰ª∂
                    if (positions[i] > detectorPos.x) {
                        positions[i] = sourcePos.x;
                        positions[i + 1] = sourcePos.y;
                        positions[i + 2] = sourcePos.z;
                    }
                }
                
                particleSystem.geometry.attributes.position.needsUpdate = true;
                
                setTimeout(() => this.animateParticles(), 50);
            }

            stopRadiationAnimation() {
                isAnimationPlaying = false;
                if (particleSystem) {
                    scene.remove(particleSystem);
                    particleSystem = null;
                }
            }
        }

        // È´òÁ≤æÂ∫¶Ë®àÁÆó„Ç®„É≥„Ç∏„É≥
        class AdvancedShieldingCalculator {
            constructor() {
                this.safetyLimits = {
                    general: 2.5, // ŒºSv/h
                    occupational: 25.0, // ŒºSv/h
                    medical: 10.0 // ŒºSv/h
                };
            }

            calculate(materialKey, thickness, sourceDistance, detectorDistance, sourceKey, activity) {
                const material = materialDatabase[materialKey];
                const source = sourceDatabase[sourceKey];
                
                // Á∑öÊ∏õË°∞‰øÇÊï∞
                const mu = material.muMass * material.density;
                
                // „Ç®„Éç„É´„ÇÆ„Éº‰æùÂ≠òÊÄß„ÇíËÄÉÊÖÆÔºàÁ∞°Áï•ÂåñÔºâ
                const energyFactor = this.getEnergyDependence(source.energy, material.atomicNumber);
                const effectiveMu = mu * energyFactor;
                
                // Âü∫Êú¨Ê∏õË°∞
                const basicAttenuation = Math.exp(-effectiveMu * thickness);
                
                // „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞ÔºàBerger-SeltzerËøë‰ººÔºâ
                const buildup = this.calculateBuildup(effectiveMu, thickness);
                
                // Ë∑ùÈõ¢„Å´„Çà„ÇãÂπæ‰ΩïÂ≠¶ÁöÑÊ∏õË°∞
                const totalDistance = sourceDistance + detectorDistance;
                const geometricFactor = Math.pow(totalDistance / 100, -2); // 1mÂü∫Ê∫ñ
                
                // Á∑öÈáèÁéáË®àÁÆó
                const gammaConstant = source.gammaConstant; // R¬∑cm¬≤/h¬∑Ci
                const activityCi = activity / 3.7e10;
                
                const unshieldedRate = activityCi * gammaConstant * geometricFactor * 10; // ŒºSv/hÊèõÁÆó
                const shieldedRate = unshieldedRate * basicAttenuation * buildup;
                
                // Âçä‰æ°Â±§ÂéöÔºàHVLÔºâ
                const hvl = Math.log(2) / effectiveMu;
                const hvlRatio = thickness / hvl;
                
                return {
                    unshieldedRate: unshieldedRate,
                    shieldedRate: Math.max(shieldedRate, 0.001),
                    basicAttenuation: basicAttenuation,
                    buildup: buildup,
                    totalAttenuation: basicAttenuation * buildup,
                    attenuationPercent: (1 - basicAttenuation * buildup) * 100,
                    hvl: hvl,
                    hvlRatio: hvlRatio,
                    geometricFactor: geometricFactor,
                    safetyStatus: this.evaluateSafety(shieldedRate),
                    materialEfficiency: this.calculateEfficiency(material, thickness)
                };
            }

            getEnergyDependence(energy, atomicNumber) {
                // Á∞°Áï•Âåñ„Åï„Çå„Åü„Ç®„Éç„É´„ÇÆ„Éº‰æùÂ≠òÊÄß
                // ÂÆüÈöõ„Å´„ÅØNIST„Éá„Éº„Çø„Éô„Éº„Çπ„Å™„Å©„ÇíÂèÇÁÖß
                const photoelectricFactor = Math.pow(atomicNumber, 3.8) / Math.pow(energy, 3.2);
                const comptonFactor = 1 / energy;
                return Math.max(0.1, photoelectricFactor + comptonFactor);
            }

            calculateBuildup(mu, thickness) {
                // Taylor-BergerËøë‰ºº
                const muT = mu * thickness;
                if (muT < 0.01) return 1.0;
                
                const a = 1.0;
                const b = 1.5;
                return 1 + a * muT * Math.exp(-b * muT) + (muT - 1 + Math.exp(-muT)) / 2;
            }

            evaluateSafety(doseRate) {
                if (doseRate <= this.safetyLimits.general) {
                    return { level: 'excellent', text: '‚úì Âü∫Ê∫ñÂÄ§‰ª•‰∏ã' };
                } else if (doseRate <= this.safetyLimits.medical) {
                    return { level: 'good', text: '‚ñ≥ Ë¶ÅÊ§úË®é' };
                } else if (doseRate <= this.safetyLimits.occupational) {
                    return { level: 'warning', text: '‚ö† Âü∫Ê∫ñË∂ÖÈÅé' };
                } else {
                    return { level: 'danger', text: '‚úó Âç±Èô∫' };
                }
            }

            calculateEfficiency(material, thickness) {
                // Âéö„Åï„ÉªÈáçÈáè„Éª„Ç≥„Çπ„Éà„ÇíËÄÉÊÖÆ„Åó„ÅüÂäπÁéáÊåáÊ®ô
                const volume = thickness; // Âçò‰ΩçÈù¢Á©ç„ÅÇ„Åü„Çä
                const weight = volume * material.density;
                const cost = weight * material.cost;
                
                return {
                    volume: volume,
                    weight: weight,
                    cost: cost,
                    costEfficiency: 1 / cost // ÂçòÁ¥îÂåñ
                };
            }
        }

        // „É°„Ç§„É≥ÂàùÊúüÂåñÂá¶ÁêÜ
        document.addEventListener('DOMContentLoaded', function() {
            const learningManager = new AdvancedLearningManager();
            const calculator = new AdvancedShieldingCalculator();
            let visualizer = null;

            // 3DÂèØË¶ñÂåñ„ÅÆÂàùÊúüÂåñ
            setTimeout(() => {
                const container = document.getElementById('threejs-container');
                if (container) {
                    visualizer = new Advanced3DVisualizer(container);
                    updateAllVisualization();
                }
            }, 100);

            // „Ç§„Éô„É≥„Éà„É™„Çπ„Éä„Éº„ÅÆË®≠ÂÆö
            setupEventListeners();
            
            // ÂàùÊúüÁä∂ÊÖã„ÅÆË®≠ÂÆö
            learningManager.updateProgress();
            updateMaterialProperties();
            updateHVLDisplay();

            // „Ç¶„Çß„É´„Ç´„É†„É°„ÉÉ„Çª„Éº„Ç∏
            setTimeout(() => {
                alert('üõ°Ô∏è Poker MCP Level 1: Âü∫Á§éÁøíÂæó„Å∏„Çà„ÅÜ„Åì„ÅùÔºÅ\n\n' +
                      'üéØ Â≠¶ÁøíÁõÆÊ®ô:\n' +
                      '‚Ä¢ ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅÆÁâ©ÁêÜÂ≠¶ÁöÑÂéüÁêÜ„ÅÆÁêÜËß£\n' +
                      '‚Ä¢ ÊùêÊñôÁâπÊÄß„Å®ÈÅÆËîΩÂäπÊûú„ÅÆÂÆöÈáèÁöÑÈñ¢‰øÇ\n' +
                      '‚Ä¢ ÂÆüÁî®ÁöÑ„Å™ÈÅÆËîΩË®≠Ë®à„ÅÆÂü∫Á§éÁü•Ë≠ò\n\n' +
                      'Âè≥ÂÅ¥„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíË™øÊï¥„Åó„Å™„Åå„Çâ„ÄÅ3DÂèØË¶ñÂåñ„Åß\n' +
                      'ÈÅÆËîΩÂäπÊûú„Çí‰ΩìÊÑü„Åó„Å¶„Åè„Å†„Åï„ÅÑÔºÅ');
            }, 1000);

            function setupEventListeners() {
                // ÊùêÊñôÂ§âÊõ¥
                document.getElementById('shield-material').addEventListener('change', function() {
                    updateMaterialProperties();
                    updateHVLDisplay();
                    updateAllVisualization();
                    learningManager.trackInteraction('material_change', this.value);
                });

                // Âéö„ÅïË™øÊï¥
                document.getElementById('thickness-slider').addEventListener('input', function() {
                    document.getElementById('thickness-value').textContent = this.value + ' cm';
                    updateHVLDisplay();
                    updateAllVisualization();
                    learningManager.trackInteraction('thickness_change', this.value);
                });

                // Ë∑ùÈõ¢Ë™øÊï¥
                document.getElementById('source-distance').addEventListener('input', function() {
                    document.getElementById('source-distance-value').textContent = this.value + ' cm';
                    updateAllVisualization();
                    learningManager.trackInteraction('distance_change', this.value);
                });

                document.getElementById('detector-distance').addEventListener('input', function() {
                    document.getElementById('detector-distance-value').textContent = this.value + ' cm';
                    updateAllVisualization();
                    learningManager.trackInteraction('distance_change', this.value);
                });

                // Á∑öÊ∫ê„ÉªÊîæÂ∞ÑËÉΩÂ§âÊõ¥
                document.getElementById('radiation-source').addEventListener('change', function() {
                    learningManager.trackInteraction('source_change', this.value);
                });

                document.getElementById('source-activity').addEventListener('change', function() {
                    learningManager.trackInteraction('activity_change', this.value);
                });

                // Ë®àÁÆóÂÆüË°å
                document.getElementById('calculate-btn').addEventListener('click', performCalculation);

                // „Éä„Éì„Ç≤„Éº„Ç∑„Éß„É≥
                document.getElementById('next-step').addEventListener('click', function() {
                    if (learningManager.currentStep === learningManager.totalSteps) {
                        learningManager.completeLevel1();
                    } else {
                        learningManager.nextStep();
                    }
                });

                document.getElementById('prev-step').addEventListener('click', function() {
                    learningManager.previousStep();
                });

                // Ë£úÂä©Ê©üËÉΩ
                document.getElementById('hint-btn').addEventListener('click', showPhysicsHint);
                document.getElementById('compare-materials').addEventListener('click', showMaterialComparison);
                document.getElementById('restart-btn').addEventListener('click', resetAllParameters);

                // 3DÂà∂Âæ°
                document.getElementById('play-animation').addEventListener('click', function() {
                    if (visualizer) {
                        visualizer.playRadiationAnimation();
                        this.style.display = 'none';
                        document.getElementById('pause-animation').style.display = 'inline-block';
                        learningManager.trackInteraction('animation_play');
                    }
                });

                document.getElementById('pause-animation').addEventListener('click', function() {
                    if (visualizer) {
                        visualizer.stopRadiationAnimation();
                        this.style.display = 'none';
                        document.getElementById('play-animation').style.display = 'inline-block';
                        learningManager.trackInteraction('animation_pause');
                    }
                });

                document.getElementById('reset-view').addEventListener('click', function() {
                    if (camera) {
                        camera.position.set(8, 6, 12);
                        camera.lookAt(0, 0, 0);
                        learningManager.trackInteraction('view_reset');
                    }
                });
            }

            function updateMaterialProperties() {
                const materialKey = document.getElementById('shield-material').value;
                const material = materialDatabase[materialKey];
                
                const propertiesDiv = document.getElementById('material-properties');
                propertiesDiv.innerHTML = `
                    <strong>${material.name} „ÅÆÁâπÊÄß:</strong><br>
                    ‚Ä¢ ÂéüÂ≠êÁï™Âè∑: Z=${material.atomicNumber}<br>
                    ‚Ä¢ ÂØÜÂ∫¶: ${material.density} g/cm¬≥<br>
                    ‚Ä¢ Ë≥™ÈáèÊ∏õË°∞‰øÇÊï∞: ${material.muMass.toFixed(4)} cm¬≤/g<br>
                    ‚Ä¢ Á∑öÊ∏õË°∞‰øÇÊï∞: ${(material.muMass * material.density).toFixed(3)} cm‚Åª¬π<br>
                    ‚Ä¢ ‰∏ª„Å™Áî®ÈÄî: ${material.applications}
                `;
            }

            function updateHVLDisplay() {
                const materialKey = document.getElementById('shield-material').value;
                const thickness = parseFloat(document.getElementById('thickness-slider').value);
                const material = materialDatabase[materialKey];
                
                const mu = material.muMass * material.density;
                const hvl = Math.log(2) / mu;
                const hvlRatio = thickness / hvl;
                const attenuationPercent = (1 - Math.exp(-mu * thickness)) * 100;
                
                const hvlDisplay = document.getElementById('hvl-display');
                hvlDisplay.innerHTML = `
                    Âéö„Åï: ${hvlRatio.toFixed(1)} HVL<br>
                    Ê∏õË°∞Áéá: ${attenuationPercent.toFixed(1)}%<br>
                    Âçä‰æ°Â±§Âéö: ${hvl.toFixed(1)} cm
                `;
            }

            function updateAllVisualization() {
                if (!visualizer) return;

                const materialKey = document.getElementById('shield-material').value;
                const thickness = parseFloat(document.getElementById('thickness-slider').value) / 10; // „Çπ„Ç±„Éº„É´Ë™øÊï¥
                
                visualizer.updateShield(materialKey, thickness);
                visualizer.updatePositions();
            }

            function performCalculation() {
                const materialKey = document.getElementById('shield-material').value;
                const thickness = parseFloat(document.getElementById('thickness-slider').value);
                const sourceDistance = parseFloat(document.getElementById('source-distance').value);
                const detectorDistance = parseFloat(document.getElementById('detector-distance').value);
                const sourceKey = document.getElementById('radiation-source').value;
                const activity = parseFloat(document.getElementById('source-activity').value);

                // Ë®àÁÆóÂÆüË°å
                const results = calculator.calculate(
                    materialKey, thickness, sourceDistance, detectorDistance, sourceKey, activity
                );

                // ÁµêÊûúË°®Á§∫
                displayResults(results);
                
                // Â≠¶ÁøíËøΩË∑°
                learningManager.trackCalculation(results);

                // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØÊèê‰æõ
                provideFeedback(results, materialKey);
            }

            function displayResults(results) {
                const resultsPanel = document.getElementById('results-display');
                resultsPanel.style.display = 'block';

                // ÈÄèÈÅéÁ∑öÈáèÁéá
                document.getElementById('dose-rate-result').textContent = 
                    results.shieldedRate.toFixed(2) + ' ŒºSv/h';

                // Ê∏õË°∞Áéá
                document.getElementById('attenuation-result').textContent = 
                    results.attenuationPercent.toFixed(1) + '%';

                // „Éì„É´„Éâ„Ç¢„ÉÉ„Éó‰øÇÊï∞
                document.getElementById('buildup-result').textContent = 
                    results.buildup.toFixed(2);

                // HVLÊØî
                document.getElementById('hvl-ratio').textContent = 
                    results.hvlRatio.toFixed(1) + ' HVL';

                // „Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞
                updateResultStatuses(results);
            }

            function updateResultStatuses(results) {
                // ÂÆâÂÖ®Áä∂ÊÖã
                const safetyStatus = document.getElementById('safety-status');
                safetyStatus.textContent = results.safetyStatus.text;
                safetyStatus.className = `result-status ${results.safetyStatus.level}`;

                // Ê∏õË°∞ÁéáË©ï‰æ°
                const attenuationStatus = document.getElementById('attenuation-status');
                if (results.attenuationPercent > 99) {
                    attenuationStatus.textContent = 'ÂÑ™ÁßÄ';
                    attenuationStatus.className = 'result-status excellent';
                } else if (results.attenuationPercent > 90) {
                    attenuationStatus.textContent = 'ËâØÂ•Ω';
                    attenuationStatus.className = 'result-status good';
                } else if (results.attenuationPercent > 50) {
                    attenuationStatus.textContent = 'ÊôÆÈÄö';
                    attenuationStatus.className = 'result-status warning';
                } else {
                    attenuationStatus.textContent = '‰∏çË∂≥';
                    attenuationStatus.className = 'result-status danger';
                }

                // „Éì„É´„Éâ„Ç¢„ÉÉ„ÉóË©ï‰æ°
                const buildupStatus = document.getElementById('buildup-status');
                if (results.buildup < 1.5) {
                    buildupStatus.textContent = '‰Ωé';
                    buildupStatus.className = 'result-status excellent';
                } else if (results.buildup < 3.0) {
                    buildupStatus.textContent = '‰∏≠';
                    buildupStatus.className = 'result-status good';
                } else {
                    buildupStatus.textContent = 'È´ò';
                    buildupStatus.className = 'result-status warning';
                }

                // HVLË©ï‰æ°
                const hvlStatus = document.getElementById('hvl-status');
                if (results.hvlRatio > 5) {
                    hvlStatus.textContent = 'ÂçÅÂàÜ';
                    hvlStatus.className = 'result-status excellent';
                } else if (results.hvlRatio > 2) {
                    hvlStatus.textContent = 'ÈÅ©Âàá';
                    hvlStatus.className = 'result-status good';
                } else {
                    hvlStatus.textContent = '‰∏çË∂≥';
                    hvlStatus.className = 'result-status warning';
                }
            }

            function provideFeedback(results, materialKey) {
                const material = materialDatabase[materialKey];
                let feedback = '';

                if (results.safetyStatus.level === 'excellent') {
                    feedback = `üéâ Á¥†Êô¥„Çâ„Åó„ÅÑÔºÅ${material.name}„Å´„Çà„ÇãÈÅÆËîΩ„ÅåÂäπÊûúÁöÑ„Å´Ê©üËÉΩ„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
                    if (results.hvlRatio > 10) {
                        feedback += '\nüí° Âéö„Åô„Åé„ÇãÂèØËÉΩÊÄß„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ„Ç≥„Çπ„ÉàÊúÄÈÅ©Âåñ„ÇíÊ§úË®é„Åó„Å¶„Åø„Åæ„Åó„Çá„ÅÜ„ÄÇ';
                    }
                } else if (results.safetyStatus.level === 'good') {
                    feedback = `‚úÖ Âü∫Êú¨ÁöÑ„Å™ÈÅÆËîΩ„ÅØÈÅîÊàê„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇÁî®ÈÄî„Å´Âøú„Åò„Å¶„Åï„Çâ„Å™„ÇãÊîπÂñÑ„ÇíÊ§úË®é„Åó„Åæ„Åó„Çá„ÅÜ„ÄÇ`;
                } else if (results.safetyStatus.level === 'warning') {
                    feedback = `‚ö†Ô∏è ÈÅÆËîΩ„Åå‰∏çÂçÅÂàÜ„Åß„Åô„ÄÇÂéö„Åï„ÇíÂ¢óÂä†„Åô„Çã„Åã„ÄÅ„Çà„ÇäÂäπÊûúÁöÑ„Å™ÊùêÊñô„Å∏„ÅÆÂ§âÊõ¥„ÇíÊ§úË®é„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ`;
                } else {
                    feedback = `üö´ Âç±Èô∫„É¨„Éô„É´„Åß„ÅôÔºÅÈÅÆËîΩ„ÅÆÂ§ßÂπÖ„Å™ÊîπÂñÑ„ÅåÂøÖË¶Å„Åß„Åô„ÄÇ`;
                }

                // „Éì„É´„Éâ„Ç¢„ÉÉ„Éó„ÅåÈ´ò„ÅÑÂ†¥Âêà„ÅÆËøΩÂä†„Ç¢„Éâ„Éê„Ç§„Çπ
                if (results.buildup > 3) {
                    feedback += `\nüî¨ „Éì„É´„Éâ„Ç¢„ÉÉ„ÉóÂäπÊûú„ÅåÈ°ïËëó„Åß„Åô„ÄÇÊï£‰π±Á∑ö„ÅÆËìÑÁ©ç„Å´„Çà„Çä„ÄÅÂçòÁ¥îË®àÁÆó„Çà„ÇäÈÄèÈÅé„ÅåÂ¢óÂä†„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`;
                }

                // „Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØË°®Á§∫
                setTimeout(() => {
                    alert(feedback);
                }, 500);
            }

            function showPhysicsHint() {
                const hints = {
                    1: `üî¨ Áâ©ÁêÜÂ≠¶ÁöÑËÉåÊôØ\n\n` +
                       `ÊîæÂ∞ÑÁ∑öÈÅÆËîΩ„ÅØ‰∏ª„Å´3„Å§„ÅÆÁõ∏‰∫í‰ΩúÁî®„ÅßËµ∑„Åì„Çä„Åæ„ÅôÔºö\n` +
                       `‚Ä¢ ÂÖâÈõªÂäπÊûú: ‰Ωé„Ç®„Éç„É´„ÇÆ„ÉºÈ†òÂüü„ÅßÊîØÈÖçÁöÑ\n` +
                       `‚Ä¢ „Ç≥„É≥„Éó„Éà„É≥Êï£‰π±: ‰∏≠„Ç®„Éç„É´„ÇÆ„ÉºÈ†òÂüü\n` +
                       `‚Ä¢ ÈõªÂ≠êÂØæÁîüÊàê: È´ò„Ç®„Éç„É´„ÇÆ„ÉºÈ†òÂüü\n\n` +
                       `ÊùêÊñô„ÅÆÂéüÂ≠êÁï™Âè∑Z„ÅåÈ´ò„ÅÑ„Åª„Å©ÂÖâÈõªÂäπÊûú„ÅåÂº∑„Åè„Å™„Çä„ÄÅ\n` +
                       `‰Ωé„Ç®„Éç„É´„ÇÆ„ÉºŒ≥Á∑ö„Å´ÂØæ„Åó„Å¶ÂäπÊûúÁöÑ„Åß„Åô„ÄÇ`,
                    
                    2: `üß™ ÊùêÊñôÈÅ∏Êäû„ÅÆÁßëÂ≠¶\n\n` +
                       `ÈÅÆËîΩÂäπÁéá„ÅØ‰ª•‰∏ã„ÅßÊ±∫„Åæ„Çä„Åæ„ÅôÔºö\n` +
                       `‚Ä¢ ÂØÜÂ∫¶œÅ: Âçò‰Ωç‰ΩìÁ©ç„ÅÇ„Åü„Çä„ÅÆÂéüÂ≠êÊï∞\n` +
                       `‚Ä¢ ÂéüÂ≠êÁï™Âè∑Z: ÂÖâÈõªÂäπÊûú„Å∏„ÅÆÂΩ±Èüø\n` +
                       `‚Ä¢ ‰æ°Ê†º: ÂÆüÁî®ÊÄß„Å∏„ÅÆÂΩ±Èüø\n\n` +
                       `Èâõ„ÅØÈ´òZ„ÉªÈ´òÂØÜÂ∫¶„ÅßÂÑ™ÁßÄ„Åß„Åô„Åå„ÄÅ\n` +
                       `„Ç≥„É≥„ÇØ„É™„Éº„Éà„ÅØÂÆâ‰æ°„ÅßÂ§ßÂûãÊñΩË®≠„Å´ÈÅ©„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ`,
                    
                    3: `üìè Âπæ‰ΩïÂ≠¶ÁöÑËÄÉÊÖÆ‰∫ãÈ†Ö\n\n` +
                       `Ë∑ùÈõ¢„ÅÆÂäπÊûú„ÅØÈÄÜ‰∫å‰πóÂâá„Å´Âæì„ÅÑ„Åæ„ÅôÔºö\n` +
                       `‚Ä¢ Ë∑ùÈõ¢2ÂÄç ‚Üí Á∑öÈáèÁéá1/4\n` +
                       `‚Ä¢ Ë∑ùÈõ¢3ÂÄç ‚Üí Á∑öÈáèÁéá1/9\n\n` +
                       `„Åü„Å†„ÅóÊï£‰π±Á∑ö„ÇÑ„Éì„É´„Éâ„Ç¢„ÉÉ„Éó„Å´„Çà„Çä„ÄÅ\n` +
                       `ÂÆüÈöõ„ÅÆÊ∏õË°∞„ÅØË§áÈõë„Å´„Å™„Çä„Åæ„Åô„ÄÇ`,
                    
                    4: `üèóÔ∏è ÂÆüÁî®Ë®≠Ë®à„ÅÆ„Éù„Ç§„É≥„Éà\n\n` +
                       `ÂÆüÈöõ„ÅÆË®≠Ë®à„Åß„ÅØ‰ª•‰∏ã„ÇíËÄÉÊÖÆÔºö\n` +
                       `‚Ä¢ Ë¶èÂà∂Âü∫Ê∫ñÂÄ§Ôºà‰∏ÄËà¨ÂÖ¨Ë°Ü: 1mSv/Âπ¥Ôºâ\n` +
                       `‚Ä¢ ÂÆâÂÖ®‰øÇÊï∞ÔºàÈÄöÂ∏∏1.5-2ÂÄçÔºâ\n` +
                       `‚Ä¢ ÁµåÊ∏àÊÄßÔºàÊùêÊñô„ÉªÊñΩÂ∑•„Ç≥„Çπ„ÉàÔºâ\n` +
                       `‚Ä¢ ‰øùÂÆàÊÄßÔºàÁÇπÊ§ú„Éª‰∫§Êèõ„ÅÆÂÆπÊòì„ÅïÔºâ\n\n` +
                       `„É¢„É≥„ÉÜ„Ç´„É´„É≠Ê≥ï„Å´„Çà„ÇãË©≥Á¥∞Ë®àÁÆó„ÇÇÈáçË¶Å„Åß„Åô„ÄÇ`
                };

                alert(hints[learningManager.currentStep] || hints[1]);
            }

            function showMaterialComparison() {
                const comparisonTable = document.getElementById('comparison-table');
                const tbody = document.getElementById('comparison-tbody');
                
                // „ÉÜ„Éº„Éñ„É´ÂÜÖÂÆπ„ÅÆÁîüÊàê
                tbody.innerHTML = '';
                Object.entries(materialDatabase).forEach(([key, material]) => {
                    const mu = material.muMass * material.density;
                    const hvl = Math.log(2) / mu;
                    const efficiency = material.density / material.cost; // Á∞°ÊòìÂäπÁéáÊåáÊ®ô
                    
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td><strong>${material.name}</strong></td>
                        <td>${material.density}</td>
                        <td>${material.muMass.toFixed(4)}</td>
                        <td>${hvl.toFixed(1)}</td>
                        <td>${efficiency.toFixed(2)}</td>
                    `;
                    
                    // ÁèæÂú®ÈÅ∏Êäû„Åï„Çå„Å¶„ÅÑ„ÇãÊùêÊñô„Çí„Éè„Ç§„É©„Ç§„Éà
                    if (key === document.getElementById('shield-material').value) {
                        row.style.backgroundColor = '#e0f2fe';
                        row.style.fontWeight = 'bold';
                    }
                });
                
                comparisonTable.style.display = 'block';
                
                // Â≠¶ÁøíËøΩË∑°
                learningManager.trackInteraction('material_comparison');
                
                setTimeout(() => {
                    alert('üìä ÊùêÊñôÊØîËºÉË°®„ÇíË°®Á§∫„Åó„Åæ„Åó„ÅüÔºÅ\n\n' +
                          'ÂêÑÊùêÊñô„ÅÆÂØÜÂ∫¶„ÄÅË≥™ÈáèÊ∏õË°∞‰øÇÊï∞„ÄÅÂçä‰æ°Â±§Âéö„ÄÅ\n' +
                          'Áõ∏ÂØæÂäπÁéá„ÇíÊØîËºÉ„Åß„Åç„Åæ„Åô„ÄÇ\n\n' +
                          'ÁèæÂú®ÈÅ∏Êäû‰∏≠„ÅÆÊùêÊñô„Åå„Éè„Ç§„É©„Ç§„ÉàË°®Á§∫„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ');
                }, 200);
            }

            function resetAllParameters() {
                if (confirm('„Åô„Åπ„Å¶„ÅÆ„Éë„É©„É°„Éº„Çø„ÇíÂàùÊúüÂÄ§„Å´„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü')) {
                    document.getElementById('shield-material').value = 'concrete';
                    document.getElementById('thickness-slider').value = '10';
                    document.getElementById('source-distance').value = '50';
                    document.getElementById('detector-distance').value = '50';
                    document.getElementById('radiation-source').value = 'cs137';
                    document.getElementById('source-activity').value = '3.7e10';
                    
                    // Ë°®Á§∫Êõ¥Êñ∞
                    document.getElementById('thickness-value').textContent = '10 cm';
                    document.getElementById('source-distance-value').textContent = '50 cm';
                    document.getElementById('detector-distance-value').textContent = '50 cm';
                    
                    // ÁµêÊûú„Éë„Éç„É´ÈùûË°®Á§∫
                    document.getElementById('results-display').style.display = 'none';
                    document.getElementById('comparison-table').style.display = 'none';
                    
                    // Êõ¥Êñ∞Âá¶ÁêÜ
                    updateMaterialProperties();
                    updateHVLDisplay();
                    updateAllVisualization();
                    
                    learningManager.trackInteraction('reset_all');
                }
            }

            // „É™„Çµ„Ç§„Ç∫ÂØæÂøú
            window.addEventListener('resize', function() {
                if (camera && renderer) {
                    const container = document.getElementById('threejs-container');
                    camera.aspect = container.clientWidth / container.clientHeight;
                    camera.updateProjectionMatrix();
                    renderer.setSize(container.clientWidth, container.clientHeight);
                }
            });
        });